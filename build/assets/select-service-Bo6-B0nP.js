import{a as t,aF as k,j as s,bJ as u,an as y,a3 as E,bN as _}from"./index-CPKrhu4T.js";/* empty css              */import{C as B}from"./Chip-DMkwgItY.js";import{A as C}from"./Avatar-Br_zHEGO.js";const L=({orgsChoose:n=[],values:l=[],setValues:x,onChangeService:o})=>{var h;const d=t.useRef(null),j=l.map(e=>e.id),[m,f]=t.useState({data:[],load:!1}),v=e=>{var r,i,a,c;if(n.length>0&&e==="show")return(i=(r=d.current)==null?void 0:r.classList)==null?void 0:i.add("box-services-show");if(e==="hide")return(c=(a=d.current)==null?void 0:a.classList)==null?void 0:c.remove("box-services-show")};window.addEventListener("click",()=>v("hide"));const g=async(e,r)=>{let i=[];for(var a of r){const c=await _.getServicesByOrg({keyword:e,org_id:a==null?void 0:a.id}),w={services:c==null?void 0:c.data.context.data,org:a};i.push(w)}f({data:i,load:!1})},b=t.useCallback(k.debounce((e,r)=>{f({data:[],load:!0}),g(e,r)},1500),[]),N=e=>{n&&n.length>0&&b(e.target.value,n)},S=((h=m.data)==null?void 0:h.map(e=>e.services).flat())??[],p=e=>{if(o){l.findIndex(i=>i.id===e.id)<0?o([...l,e]):o(l.filter(i=>i.id!==e.id));return}if(x){x(r=>r.findIndex(a=>a.id===e.id)<0?(r=[...r,e],r):r.filter(a=>a.id!==e.id));return}};return s.jsxs("div",{className:"select-services",children:[s.jsx("label",{className:"required form-label",children:"Sản phẩm áp dụng"}),s.jsx("div",{onClick:e=>{e.stopPropagation(),v("show")},className:"form-control form-control-solid ser-selected",children:l.map(e=>s.jsx(B,{label:`${e.service_name} | Giá gốc: ${u(e.price)}`,onDelete:()=>p(e),size:"medium",color:"primary",avatar:s.jsx(C,{src:e.image_url})},e.id))}),s.jsxs("div",{onClick:e=>e.stopPropagation(),ref:d,className:"box-services",children:[s.jsxs("div",{className:"box-service-input",children:[m.load&&s.jsx(y,{size:16}),s.jsx("input",{onChange:N,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm dịch vụ..."})]}),s.jsx("div",{className:"services-list",children:s.jsx("ul",{children:S.filter(Boolean).map((e,r)=>s.jsx("li",{children:s.jsxs("div",{style:j.includes(e.id)?{backgroundColor:"var(--kt-gray-200)"}:{},onClick:()=>p(e),className:"service-item",children:[s.jsx("div",{className:"image",children:s.jsx("img",{src:e.image_url,onError:i=>E(i),alt:""})}),s.jsxs("div",{className:"service-detail",children:[s.jsx("p",{className:"service-name",children:e.service_name}),s.jsx("p",{className:"service-price",children:u(e.price)})]})]})},r))})})]})]})};export{L as S};
