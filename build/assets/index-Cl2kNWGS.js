import{e as f,a7 as N,bC as x,S as T,j as e,a8 as C,am as k,a9 as S,bx as L,c7 as E,by as A,bz as j,a as u,ci as D,aa as F,b1 as I,bL as M,L as O,ac as R,ah as p,W as P,bH as y,b4 as v,bR as B,bS as z,bT as Q}from"./index-BHl1vF-Z.js";import{u as _,A as w}from"./index-CqMaASZ6.js";import{u as X}from"./useDebounce-0qalBWG1.js";import{L as Y}from"./LoadingButton-BU6aPnkN.js";function J(){var l;const n=f(),s=N(),t=X(x.parse(n.search),800),{data:a,isLoading:i}=T({queryKey:["ORG",t],queryFn:()=>y.getAll({page:t.page||1,limit:30,is_ecommerce:t.is_ecommerce||"",keyword:t.search,sort:"-created_at"}).then(c=>c.data.context)}),r=c=>{const o={...t,page:c};s({pathname:n.pathname,search:x.stringify(o)})};return e.jsxs(e.Fragment,{children:[e.jsx(C,{title:"Danh sách doanh nghiệp"}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Danh sách doanh nghiệp"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:[a==null?void 0:a.total," doanh nghiệp"]})]})}),e.jsx(G,{data:a}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted bg-light",children:[e.jsx("th",{className:"ps-4 min-w-300px rounded-start",children:"Thông tin"}),e.jsx("th",{className:"min-w-125px",children:"Liên lạc"}),e.jsx("th",{className:"min-w-125px",children:"Lượt thích"}),e.jsx("th",{className:"min-w-200px",children:"Trạng thái TMDT"}),e.jsx("th",{className:"min-w-150px text-end rounded-end"})]})}),e.jsx("tbody",{children:(l=a==null?void 0:a.data)==null?void 0:l.map((c,o)=>e.jsx(q,{org:c},o))})]}),e.jsx(k,{loading:i}),e.jsx(S,{totalPage:(a==null?void 0:a.last_page)??1,onChangePage:r,defaultPage:(t==null?void 0:t.page)??1})]})})]})]})}const q=({org:n})=>{var c;const[s,t]=u.useState(n.is_momo_ecommerce_enable),{resultLoad:a,noti:i,onCloseNoti:r}=_(),l=o=>{t(o),y.updateECommerce(n.id,{is_momo_ecommerce_enable:o}).then(d=>{t(d.data.context.is_momo_ecommerce_enable),a({message:"Cập nhật thành công",color:"success"})}).catch(()=>{t(n.is_momo_ecommerce_enable),a({message:"Có lỗi xảy ra",color:"error"})})};return e.jsxs(e.Fragment,{children:[e.jsx(w,{severity:i.color,message:i.message,open:i.openAlert,close:r}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",style:{cursor:"pointer"},onClick:()=>D(n),children:[e.jsx("div",{className:"symbol symbol-50px me-5",children:e.jsx(F,{src:n.image_url})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary mb-1 fs-6",children:n.name}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:n.full_address})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-7",children:(c=n.telephone)==null?void 0:c.join(", ")})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-6",children:n.favorites_count})}),e.jsx("td",{children:e.jsx(I,{permissions:["v1.organizations.updateECommerce"],children:e.jsx(M,{label:"",value:s,onChange:o=>l(o.target.checked)})})}),e.jsx("td",{className:"text-end",children:e.jsx(O,{to:{pathname:R.ORGANIZATIONS_DETAIL(n.id)+"/services"},className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",children:e.jsx("i",{className:"bi bi-eye fs-4"})})})]})]})},G=({data:n})=>{const s=x.parse(f().search),t=N(),a=f(),i=l=>{const c={...s,page:"",is_ecommerce:l.target.value};t({pathname:a.pathname,search:x.stringify(p.pickBy(c,p.identity))},{replace:!0})},r=l=>{const c=Object.assign(s,{search:l});t({pathname:a.pathname,search:x.stringify(p.pickBy(c,p.identity))},{replace:!0})};return e.jsxs("div",{className:"card-body filter-cnt",children:[e.jsx("div",{className:"search",children:e.jsx("input",{onChange:l=>r(l.target.value),type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm MC"})}),e.jsxs("div",{className:"filter",children:[e.jsx("div",{className:"filter-item",children:e.jsxs(L,{style:{width:"100%"},size:"small",children:[e.jsx(E,{id:"demo-select-small-label",children:"Trạng thái TMDT"}),e.jsxs(A,{labelId:"demo-select-small-label",id:"demo-select-small",label:"Trạng thái TMDT",value:s.is_ecommerce||"",onChange:i,children:[e.jsx(j,{value:"",children:"Tất cả"}),e.jsx(j,{value:"true",children:"Đang mở"}),e.jsx(j,{value:"false",children:"Đang đóng"})]})]})}),e.jsx("div",{className:"filter-item",children:n&&e.jsx(H,{query:s,data:n})})]})]})},H=({query:n,data:s})=>{const[t,a]=u.useState([]),{resultLoad:i,noti:r,onCloseNoti:l}=_(),[c,o]=u.useState(!1),{mutate:d,isLoading:g}=P({mutationFn:m=>y.getAll({page:m,is_ecommerce:n.is_ecommerce||"",sort:"-created_at",limit:30}).then(b=>b.data.context),onSuccess:m=>a(b=>[...b,...m.data])}),h=()=>{o(!0);for(var m=1;m<=(s==null?void 0:s.last_page);m++)d(m)};return u.useEffect(()=>{c&&t.length>0&&t.length===(s==null?void 0:s.total)&&W(t).then(()=>{i({message:"Xuất File thành công",color:"success"}),a([]),o(!1)}),t.length===(s==null?void 0:s.total)&&a([])},[t,s==null?void 0:s.total]),e.jsxs(e.Fragment,{children:[e.jsx(w,{severity:r.color,message:r.message,open:r.openAlert,close:l}),e.jsx(Y,{onClick:h,loading:g,color:"success",variant:"contained",size:"medium",children:"Xuất DS"})]})},W=n=>new Promise(s=>{const t="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",a=".xlsx",r=[["#","ID","Tên MC","Link gian hàng","Subdomain","Trạng thái","Ngày tạo"],...n.map((h,m)=>[m+1,h.id,h.name,`https://beautyx.vn/cua-hang/${h.subdomain}`,h.subdomain,h.is_momo_ecommerce_enable?"Đang mở":"Đang tắt",v(h.created_at).format("DD/MM/YYYY")])],l=B.aoa_to_sheet(r),c=[{wch:5},{wch:10},{wch:75},{wch:45},{wch:25},{wch:25},{wch:25}];l["!cols"]=c;const d=z({Sheets:{data:l},SheetNames:["data"]},{bookType:"xlsx",type:"array"}),g=new Blob([d],{type:t});Q.saveAs(g,`ds_mc_${v().format("DDHHmmss")}`+a),s(!0)});export{J as default};
