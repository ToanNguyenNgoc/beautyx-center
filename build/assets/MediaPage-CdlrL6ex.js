import{Q as b,j as e,a8 as f,at as u,L as N,am as y,a9 as v,a7 as w,a as h,ah as k,au as C,av as j,K as g,aw as _,ax as r,aE as P}from"./index-B7MYsrm1.js";import{u as T}from"./useQueryParams-BiNmewcg.js";import{T as c}from"./trendApi-KdcKOaJv.js";import"./axios.instance-cwQkMhBD.js";const M=()=>{var l;const{query:s,handleQueryString:d}=T(),{data:a,refetch:o,isLoading:n}=b({queryKey:[P.Trend,s],queryFn:()=>c.get({page:(s==null?void 0:s.page)??1,limit:15,append:"media_url|media_thumbnail_url",include:"organization","filter[status]":s["filter[status]"],"filter[organization_id]":s["filter[organization_id]"],sort:s.sort??"-created_at"})}),m=(a==null?void 0:a.context.data)||[],x=t=>_.open({callBack:()=>c.delete(t).then(()=>{r.open({title:"Xóa thành công"}),o()}).catch(()=>r.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"}))});return e.jsxs("div",{children:[e.jsx(f,{element:e.jsx(u,{permissions:["v1.trends.store"],children:e.jsx(N,{to:{pathname:"/pages/medias-form"},className:"btn btn-sm btn-primary",children:"Tạo mới"})}),title:"Danh sách"}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Trends"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:["Over ",((l=a==null?void 0:a.context)==null?void 0:l.total)||0]})]})}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-50px",children:"Độ ưu tiên"}),e.jsx("th",{className:"min-w-150px",children:"Thumbnail & Tiêu đề"}),e.jsx("th",{className:"min-w-140px",children:"Doanh nghiệp"}),e.jsx("th",{className:"min-w-120px",children:"Trạng thái"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-120px",children:"Ngày cập nhật"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsx(D,{trend:t,onDelete:()=>x(t.id)},t.id))})]}),e.jsx(y,{loading:n}),e.jsx(v,{totalPage:(a==null?void 0:a.context.last_page)??1,onChangePage:t=>d("page",t),defaultPage:s.page})]})})]})]})},D=({trend:s,onDelete:d})=>{var p;const a=w(),[o,n]=h.useState(s.status),[m,x]=h.useState(s.priority),l=h.useCallback(k.debounce(i=>c.update(s.id,{priority:i}),1e3),[]),t=i=>{n(i),c.update(s.id,{status:i}).then(()=>r.open({title:"Lưu thành công",type:"success"})).catch(()=>{r.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"}),n(s.status)})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"d-flex align-items-center justify-content-center",children:e.jsx("div",{className:"d-flex justify-content-start flex-column",children:e.jsx("input",{onChange:i=>{l(Number(i.target.value)),x(Number(i.target.value))},value:m,type:"number",className:"form-control",name:"priority"})})})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-100px me-5",children:e.jsx("img",{src:s.media_thumbnail_url,style:{objectFit:"contain"},alt:""})}),e.jsx("div",{className:"d-flex justify-content-start flex-column",children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary fs-6",children:s.title})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block fs-6",children:(p=s.organization)==null?void 0:p.name})}),e.jsx("td",{className:"text-start",children:e.jsx(C,{value:o,label:"",onChange:i=>t(i.target.checked)})}),e.jsx("td",{className:"text-end",children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semobold",children:j(s.created_at,"DD/MM/YYYY HH:mm")})})})}),e.jsx("td",{className:"text-end",children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semobold",children:j(s.updated_at,"DD/MM/YYYY HH:mm")})})})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-end flex-shrink-0",children:[e.jsx(u,{permissions:["v1.trends.update"],children:e.jsx("button",{onClick:()=>a(`/pages/medias-form/${s.id}`),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),e.jsx(u,{permissions:["v1.trends.destroy"],children:e.jsx("button",{"aria-label":"Xóa",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",onClick:d,children:e.jsx(g,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})})]})};export{M as default};
