import{a as x,V as F,aF as _,j as a,bS as z,an as E,aC as I,a7 as L}from"./index-Cy0ECsl2.js";import{F as O}from"./index-B1EJo-OQ.js";import{C as P}from"./Chip-C0m7jgAX.js";import{A as u}from"./Avatar-wG3Cxxyj.js";const M=({label:p="Gắn deal giảm giá",required:j=!1,discounts:s=[],onChangeDiscounts:n,filterAll:v=!0,platform:b="",organization_id:N})=>{var g,f;const i=x.useRef(null),d=e=>{i.current&&(e==="hide"&&i.current.classList.remove("org-search-show"),e==="show"&&(i.current.classList.add("org-search-show"),m("")))};window.addEventListener("click",()=>d("hide"));const{mutate:m,isLoading:S,data:c}=F({mutationFn:e=>L.Discount.get({"filter[keyword]":e,sort:"-created_at","filter[filter_all]":v,"filter[platform]":b,"filter[organization_id]":N})}),w=x.useCallback(_.debounce(e=>m(e),600),[]),C=e=>w(e.target.value),h=e=>{n&&(s.findIndex(r=>r.id===e.id)<0?n([...s,e]):n(s.filter(r=>r.id!==e.id)))};return a.jsxs("div",{className:"col col-org",children:[a.jsxs("label",{className:`${j?"required":""} form-label`,children:[p," (Số lượng: ",s.length,")"]}),a.jsx("div",{onClick:e=>{e.stopPropagation(),d("show")},className:"form-control form-control-solid",children:s.length>0?s.map((e,o)=>{var r,l,t;return a.jsx(P,{variant:"filled",className:"m-1",color:"success",label:e.title+" ["+e.platform+"]",avatar:a.jsx(u,{alt:e.title,src:((r=e==null?void 0:e.items)==null?void 0:r.length)>0?(t=(l=e==null?void 0:e.items[0])==null?void 0:l.productable)==null?void 0:t.image_url:e.title}),onDelete:()=>h(e)},o)}):"Gắn dịch vụ"}),a.jsx(z,{ref:i,sx:{boxShadow:3},className:"org-search",children:a.jsxs("div",{onClick:e=>e.stopPropagation(),children:[a.jsx("input",{autoFocus:!0,onChange:C,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm deal..."}),S&&a.jsx(E,{size:16}),a.jsx("div",{className:"org-list",children:a.jsx("ul",{className:"list",children:(f=(g=c==null?void 0:c.context)==null?void 0:g.data)==null?void 0:f.map((e,o)=>{var l,t;let r=e.title;return e.items.length>0?r=(l=e.items[0].productable)==null?void 0:l.image_url:e.organizations.length>0&&(r=e.organizations[0].image_url),a.jsxs(I,{selected:s.map(k=>k.id).includes(e.id),onClick:()=>h(e),children:[a.jsx(u,{alt:e.title,src:r}),a.jsxs("div",{className:"column item-content",children:[a.jsxs("div",{className:"title",children:[e.title,a.jsx(O,{platForm:e.platform})]}),a.jsx("div",{children:e.organizations.length>0&&a.jsx("span",{children:(t=e.organizations[0])==null?void 0:t.name})})]})]},o)})})})]})})]})};export{M as S};
