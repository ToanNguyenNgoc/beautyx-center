import{j as e,ao as j,an as _,ae as v,aG as b,V as N,ax as g,z as y,s as E,v as T,as as I,a9 as z,at as C,az as S,aH as M,aI as P,Q as w,aE as F}from"./index-Cy0ECsl2.js";import{T as h}from"./trendApi-Bm93p2WU.js";import{S as D}from"./index-BSOh2SEo.js";import{S as L}from"./index-DQsMnMy3.js";import{u as V}from"./usePostMedia-78VWLruB.js";import"./Chip-C0m7jgAX.js";import"./Avatar-wG3Cxxyj.js";import"./index-B1EJo-OQ.js";import"./mediaApi-BnjTuosi.js";const f=n=>{const{id:d,onUpdated:l=()=>null,mediaType:m,value:o,types:c,...p}=n,a=!o||o=="",{isLoading:s,handlePostMedia:r}=V(),u=x=>{r({e:x,callBack(i){i.length>0&&(l==null||l(i[0]))},version:"myspa",resetOriginalResult:!0})};return e.jsxs("div",{className:"media-container",...p,children:[e.jsx("input",{onChange:u,type:"file",accept:c,id:`${d}_input_file`,hidden:!0}),e.jsx("label",{className:"button-icon",htmlFor:`${d}_input_file`,children:e.jsx("i",{className:"bi bi-cloud-upload fs-3",style:{color:"#FFF"}})}),m=="IMAGE"&&e.jsx("img",{src:a?j.imgPlaceHolder:o,alt:"",className:"image-value"}),m=="VIDEO"&&!s&&e.jsx("div",{className:"video-cnt",children:e.jsx("video",{"webkit-playsinline":"webkit-playsinline",muted:!0,controls:!0,className:"video-value",children:e.jsx("source",{type:"video/mp4",src:o})})}),s&&e.jsx("div",{className:"loading-cnt",children:e.jsx(_,{})})]})},G=(n,d)=>w({queryKey:[F.TrendId],queryFn:()=>h.getById(Number(n),{include:"organization|productables|discounts",append:"media_url|media_thumbnail_url"}),enabled:!!n,...d}),$=()=>{const n=v().id,{isBeautyxSite:d}=b(),l=n?"EDIT":"CREATE",{isLoading:m}=G(n,{onSuccess:i=>{const t=i.context;t&&(a("title",t.title),a("content",t.content),a("media_url",t.media_url),a("media_thumbnail_url",t.media_thumbnail_url),a("organization_id",t.organization_id),a("organization",t.organization),a("discounts",t.discounts),a("status",t.status),a("priority",t.priority))}}),o=N({mutationFn:i=>l=="EDIT"?h.update(Number(n),i):h.post(i),onSuccess:()=>g.open({title:"Lưu thành công",type:"success"}),onError:()=>g.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"})}),{handleChange:c,handleSubmit:p,setFieldValue:a,values:s,errors:r,touched:u}=y({initialValues:{title:"",content:"",media_id:void 0,media_url:void 0,media_thumbnail_id:void 0,media_thumbnail_url:void 0,organization:null,discounts:[],status:!0,priority:0},validationSchema:E({title:T().trim().required("Vui lòng nhập nội dung")}),onSubmit:i=>{o.mutate({...i,discounts:i.discounts.map(t=>t.id)})}}),x=i=>{(i==null?void 0:i.id)!==s.organization_id&&(a("organization_id",i==null?void 0:i.id),a("organization",i),a("discounts",[]))};return e.jsx(I,{permissions:l=="EDIT"?["v1.trends.update"]:["v1.trends.store"],showEmpty:!0,children:e.jsxs("div",{className:"card p-4",children:[e.jsx(z,{title:"Trend form"}),e.jsxs("form",{className:"discount-form mb-10 container",autoComplete:"off",onSubmit:p,children:[e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Trạng thái"}),e.jsx(C,{label:"",value:s.status,onChange:i=>a("status",i.target.checked)})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:c,value:s.priority,type:"number",className:"form-control",name:"priority"})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Thumbnail"}),e.jsx("div",{style:{width:200,aspectRatio:9/16},children:e.jsx(f,{id:"image",mediaType:"IMAGE",types:S,value:s.media_thumbnail_url,onUpdated:i=>{a("media_thumbnail_id",i.model_id),a("media_thumbnail_url",i.original_url)}})})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Video"}),e.jsx("div",{style:{width:200,aspectRatio:9/16},children:(l==="CREATE"||!m&&l==="EDIT")&&e.jsx(f,{id:"video",mediaType:"VIDEO",types:M,value:s.media_url,onUpdated:i=>{a("media_id",i.model_id),a("media_url",i.original_url)}})})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tiêu đề"}),e.jsx("input",{onChange:c,value:s.title,className:"form-control",name:"title"}),r.title&&u.title&&e.jsx("span",{className:"text-danger d-block mt-2",children:r.title})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Nội dung"}),e.jsx("input",{onChange:c,value:s.content,className:"form-control",name:"content"}),r.content&&u.content&&e.jsx("span",{className:"text-danger d-block mt-2",children:r.content})]})]}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(D,{organization_id:s.organization_id,origin:s.organization,setOrigin:i=>x(i)})}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(L,{label:d?void 0:"Gắn dịch vụ GMUP",organization_id:s.organization_id,platform:d?void 0:P.GMUP,filterAll:!1,discounts:s.discounts,onChangeDiscounts:i=>a("discounts",i)})}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{className:"btn btn-success",type:"submit",disabled:o.isLoading,children:o.isLoading?"Đang lưu...":"Lưu"})})]})]})})};export{$ as default};
