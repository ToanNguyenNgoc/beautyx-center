import{a as u,bK as q,bL as ee,aF as V,e as W,a7 as H,as as L,Q as se,U as te,V as ae,j as e,a8 as ne,at as O,L as le,bM as _,bN as k,av as F,bO as re,bP as ie,K as U,aH as T,am as oe,a9 as ce,ah as S,aA as M,aB as R,bQ as de,aC as P,bH as me,ax as ue,aE as D}from"./index-CJshWYnI.js";import{F as he}from"./index-C9ji92vU.js";import{A as xe}from"./axios.instance-CXY5zMAg.js";import{d as X}from"./discounts-ZsttU2u6.js";/* empty css              */import{E as fe}from"./export-code-DpjbKQsW.js";import"./LoadingButton-7NcAxfBL.js";const ge=(t,a,n,i)=>{var s,c,f,h;const o=[n,{code:a,...i||{}}];if((c=(s=t==null?void 0:t.services)==null?void 0:s.logger)!=null&&c.forward)return t.services.logger.forward(o,"warn","react-i18next::",!0);E(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),(h=(f=t==null?void 0:t.services)==null?void 0:f.logger)!=null&&h.warn?t.services.logger.warn(...o):console!=null&&console.warn&&console.warn(...o)},K={},G=(t,a,n,i)=>{E(n)&&K[n]||(E(n)&&(K[n]=new Date),ge(t,a,n,i))},J=(t,a)=>()=>{if(t.isInitialized)a();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),a()};t.on("initialized",n)}},Y=(t,a,n)=>{t.loadNamespaces(a,J(t,n))},$=(t,a,n,i)=>{if(E(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(a)>-1)return Y(t,n,i);n.forEach(o=>{t.options.ns.indexOf(o)<0&&t.options.ns.push(o)}),t.loadLanguages(a,J(t,i))},pe=(t,a,n={})=>!a.languages||!a.languages.length?(G(a,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:a.languages}),!0):a.hasLoadedNamespace(t,{lng:n.lng,precheck:(i,o)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&i.services.backendConnector.backend&&i.isLanguageChangingTo&&!o(i.isLanguageChangingTo,t))return!1}}),E=t=>typeof t=="string",je=t=>typeof t=="object"&&t!==null,be=u.createContext();class Ne{constructor(){this.usedNamespaces={}}addUsedNamespaces(a){a.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const ye=(t,a)=>{const n=u.useRef();return u.useEffect(()=>{n.current=t},[t,a]),n.current},Z=(t,a,n,i)=>t.getFixedT(a,n,i),ve=(t,a,n,i)=>u.useCallback(Z(t,a,n,i),[t,a,n,i]),we=(t,a={})=>{var A,z,B,Q;const{i18n:n}=a,{i18n:i,defaultNS:o}=u.useContext(be)||{},s=n||i||q();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new Ne),!s){G(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const m=(b,N)=>E(N)?N:je(N)&&E(N.defaultValue)?N.defaultValue:Array.isArray(b)?b[b.length-1]:b,j=[m,{},!1];return j.t=m,j.i18n={},j.ready=!1,j}(A=s.options.react)!=null&&A.wait&&G(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const c={...ee(),...s.options.react,...a},{useSuspense:f,keyPrefix:h}=c;let d=o||((z=s.options)==null?void 0:z.defaultNS);d=E(d)?[d]:d||["translation"],(Q=(B=s.reportNamespaces).addUsedNamespaces)==null||Q.call(B,d);const r=(s.isInitialized||s.initializedStoreOnce)&&d.every(m=>pe(m,s,c)),g=ve(s,a.lng||null,c.nsMode==="fallback"?d:d[0],h),I=()=>g,y=()=>Z(s,a.lng||null,c.nsMode==="fallback"?d:d[0],h),[l,p]=u.useState(I);let v=d.join();a.lng&&(v=`${a.lng}${v}`);const C=ye(v),x=u.useRef(!0);u.useEffect(()=>{const{bindI18n:m,bindI18nStore:j}=c;x.current=!0,!r&&!f&&(a.lng?$(s,a.lng,d,()=>{x.current&&p(y)}):Y(s,d,()=>{x.current&&p(y)})),r&&C&&C!==v&&x.current&&p(y);const b=()=>{x.current&&p(y)};return m&&(s==null||s.on(m,b)),j&&(s==null||s.store.on(j,b)),()=>{x.current=!1,s&&m&&(m==null||m.split(" ").forEach(N=>s.off(N,b))),j&&s&&j.split(" ").forEach(N=>s.store.off(N,b))}},[s,v]),u.useEffect(()=>{x.current&&r&&p(I)},[s,h,r]);const w=[l,s,r];if(w.t=l,w.i18n=s,w.ready=r,r||!r&&!f)return w;throw new Promise(m=>{a.lng?$(s,a.lng,d,()=>m()):Y(s,d,()=>m())})};function Te(){const{t,i18n:a}=we(),n=s=>t(s),i={vi:{value:"vi",icon:"",label:n("Vietnamese")},en:{value:"en",icon:"",label:n("English")}};return{t:n,onChangeLang:s=>a.changeLanguage(s),list:Object.values(i),currentLang:a.language}}function ke(){const{rootSite:t,isBeautyxSite:a,isGmupSite:n}=V(),i=W(),o=H(),s=L.parse(i.search),{data:c,isLoading:f}=se({queryKey:[D.DISCOUNT_PAGE,s],queryFn:()=>X.getAll({page:(s==null?void 0:s.page)??1,limit:15,"filter[keyword]":s["filter[keyword]"],"filter[filter_all]":!0,"filter[platform]":a?s["filter[platform]"]:T.GMUP,"filter[discount_type]":s["filter[discount_type]"],sort:s.sort??"-created_at",include:n?"gmup_tags":void 0})}),h=(c==null?void 0:c.data)??[],d=l=>{const p={...s,page:l};o({pathname:i.pathname,search:L.stringify(p)})},r=te(),{mutate:g}=ae({mutationFn:l=>X.deleteById(l),onSuccess:()=>{r.invalidateQueries([D.DISCOUNT_PAGE,s])},onError:()=>ue.open({title:y("An error occurred Please try again!"),type:"error"})}),I=async()=>{xe({version:"v4"}).get("/tags")};u.useEffect(()=>{I()},[]);const{t:y}=Te();return e.jsxs(e.Fragment,{children:[e.jsx(ne,{element:e.jsx(O,{permissions:["v1.discounts.store"],children:e.jsx(le,{to:{pathname:"/pages/discounts-form"},className:"btn btn-sm btn-primary",style:{marginLeft:12},children:y("Create new")})}),title:y("List")}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:t==_.BEAUTYX?"Mã giảm giá":"Dịch vụ GMUP"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:["Số lượng : ",(c==null?void 0:c.total)??1]})]})}),e.jsx(Ee,{query:s}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tiêu đề"}),e.jsx("th",{className:"min-w-80px",children:"Ưu tiên"}),e.jsx("th",{className:"min-w-150px",children:a?"Giá giảm":"Giá bán"}),e.jsx(k,{site:_.GMUP,children:e.jsx("th",{className:"min-w-100px",children:"Tag"})}),e.jsx("th",{className:"min-w-100px",children:"Từ ngày"}),e.jsx("th",{className:"min-w-100px",children:"Đến ngày"}),e.jsxs(k,{site:_.BEAUTYX,children:[e.jsx("th",{className:"min-w-150px",children:"Hình thức giảm"}),e.jsx("th",{className:"min-w-100px text-end",children:"Nền tảng"}),e.jsx("th",{className:"min-w-100px text-end",children:"Số lượng mã"}),e.jsx("th",{className:"min-w-150px text-end",children:"Sử dụng/1 khách"})]}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:h.map((l,p)=>{var v,C,x,w;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx("img",{src:(C=(v=l.items[0])==null?void 0:v.productable)==null?void 0:C.image_url,alt:""})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary fs-6",children:l.title}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:F(l.created_at)})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark text-center fw-bold d-block mb-1 fs-7",children:l.priority})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column w-100 me-2",children:[re(l.discount_value||0),l.discount_type==="PERCENT"?"%":"đ"]})}),e.jsx(k,{site:_.GMUP,children:e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:(w=(x=l.gmup_tags)==null?void 0:x.map(A=>A.name))==null?void 0:w.join(", ")})})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:F(l.valid_from)})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:F(l.valid_util)})}),e.jsxs(k,{site:_.BEAUTYX,children:[e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx(ie,{TYPE:l.discount_type})})}),e.jsx("td",{children:e.jsx(he,{platForm:l.platform})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:l.total??"Không giới hạn"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted text-end fw-semobold text-muted d-block fs-7",children:l.limit??"Không giới hạn"})})]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-end flex-shrink-0 tb-control",children:[e.jsx(O,{permissions:["v1.discounts.update"],children:e.jsx("button",{onClick:()=>o(`/pages/discounts-form/${l.uuid}`,{state:l}),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(U,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),(l.platform==="SHOPEE"||l.platform==="VINID"||l.platform==="BEAUTYX"||l.platform===T.VIETTEL_MONEY||l.platform===T.LIVWELL||l.platform===T.TAPTAP)&&e.jsx("button",{className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",onClick:()=>o(`/pages/discounts/${l.uuid}`),children:e.jsx(U,{path:"/media/icons/duotune/general/gen019.svg",className:"svg-icon-3"})}),(l.platform==="SHOPEE"||l.platform==="VINID"||l.platform==="BEAUTYX"||l.platform===T.VIETTEL_MONEY||l.platform===T.LIVWELL||l.platform===T.TAPTAP)&&e.jsx(fe,{title:"",size:"small",discount:l}),e.jsx(O,{permissions:["v1.discounts.destroy"],children:e.jsx("button",{onClick:()=>g(l.id),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(U,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})})]},p)})})]}),e.jsx(oe,{loading:f}),e.jsx(ce,{totalPage:(c==null?void 0:c.last_page)??1,onChangePage:d,defaultPage:(s==null?void 0:s.page)??1})]})})]})]})}const Ee=({query:t})=>{const{isBeautyxSite:a}=V();let n=[{sort:"-created_at",title:"Ngày tạo"},{sort:"-total",title:"Số lượng mã"},{sort:"-priority",title:"Độ ưu tiên"}];a||(n=[{sort:"-created_at",title:"Ngày tạo"}]);const i=H(),o=W(),s=u.useCallback(S.debounce(r=>i(r.trim()===""?`${o.pathname}`:`${o.pathname}?filter[keyword]=${r}`,{replace:!0}),600),[]),c=r=>s(r.target.value),f=r=>{const g={...t,page:1,"filter[platform]":r.target.value!==""?r.target.value:""};i({pathname:o.pathname,search:L.stringify(S.pickBy(g,S.identity))})},h=r=>{const g={...t,page:1,"filter[discount_type]":r.target.value!==""?r.target.value:""};i({pathname:o.pathname,search:L.stringify(S.pickBy(g,S.identity))})},d=r=>{const g={...t,sort:r.target.value};i({pathname:o.pathname,search:L.stringify(g)})};return e.jsxs("div",{className:"d-flex justify-content-between filter-cnt",children:[e.jsxs("div",{children:[e.jsx("label",{className:"filter-row_label",children:"Tìm kiếm"}),e.jsx("input",{type:"text",onChange:c,className:"form-control form-control-solid py-2 px-6",placeholder:"Tiêu đề..."})]}),e.jsxs("div",{className:"filter-row",children:[a&&e.jsxs(u.Fragment,{children:[e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Type"}),e.jsx(M,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(R,{labelId:"demo-select-small-label",id:"demo-select-small",value:t["filter[discount_type]"]??"",onChange:h,children:[e.jsx(P,{value:"",children:e.jsx("em",{children:"Tất cả"})}),de.map(r=>e.jsx(P,{value:r.TYPE,children:r.title},r.id))]})})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Nền tảng"}),e.jsx(M,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(R,{labelId:"demo-select-small-label",id:"demo-select-small",value:t["filter[platform]"]??"",onChange:f,children:[e.jsx(P,{value:"",children:e.jsx("em",{children:"Tất cả"})}),me.map(r=>e.jsx(P,{value:r,children:r},r))]})})]})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Sắp xếp theo"}),e.jsx(M,{sx:{m:1,minWidth:150},size:"small",children:e.jsx(R,{labelId:"demo-select-small-label",id:"demo-select-small",value:t.sort??n[0].sort,onChange:d,children:n.map(r=>e.jsx(P,{value:r.sort,children:r.title},r.sort))})})]})]})]})};export{ke as default};
