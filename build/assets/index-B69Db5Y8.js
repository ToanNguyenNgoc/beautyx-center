import{aE as A,a as D,V as q,bQ as H,ah as $,j as e,bR as U,ao as X,aC as C,aD as _,a7 as Q,z as K,s as W,aG as b,bS as J,v as d,bT as R,bL as Y,au as Z,aB as S,bI as ee,bO as ae,bU as le,bV as p,bW as j,bM as se,bX as te,e as ie,ad as re,Q as ne,ay as oe,at as ce,a8 as me,am as ue}from"./index-BuiS39ZH.js";/* empty css              */import{F as de}from"./index-DGoIgz2e.js";import{u as pe,A as he}from"./index-CnJP7hhu.js";import{d as V}from"./discounts--DetIpQu.js";import{C as ge}from"./Chip-B5qCQMpp.js";import{A as xe}from"./Avatar-ZghSeTi1.js";import{S as ve}from"./select-service-B6jEEs64.js";import{E as fe}from"./export-code-B-EFS65z.js";import{L as _e}from"./LoadingButton-rOVndUJg.js";const je=({label:x="Gắn doanh nghiệp",origins:i=[],onChangeOrigin:n})=>{var o;const{isBeautyxSite:u}=A(),a=D.useRef(null),r=t=>{a.current&&(t==="hide"&&a.current.classList.remove("org-search-show"),t==="show"&&a.current.classList.add("org-search-show"))};window.addEventListener("click",()=>r("hide"));const{data:m,mutate:I,isLoading:v}=q({mutationFn:t=>H.getAll(u?{keyword:t,is_ecommerce:!0}:{keyword:t,is_gmup:!0}).then(g=>g.data.context)}),T=D.useCallback($.debounce(t=>I(t),600),[]),h=t=>T(t.target.value),N=t=>{n&&(i.findIndex(f=>f.id===t.id)<0?n([...i,t]):n(i.filter(f=>f.id!==t.id)))};return e.jsxs("div",{className:"col col-org",children:[e.jsx("label",{className:"required filter-row_label mb-2",children:x}),e.jsx("div",{onClick:t=>{t.stopPropagation(),r("show")},className:"form-control form-control-solid",children:i.length>0?i.map(t=>e.jsx(ge,{className:"m-1",color:"primary",label:t.name,avatar:e.jsx(xe,{alt:t.subdomain,src:t.image_url}),onDelete:()=>N(t)},t.id)):"Gắn doanh nghiệp"}),e.jsx(U,{ref:a,sx:{boxShadow:3},className:"org-search",children:e.jsxs("div",{onClick:t=>t.stopPropagation(),children:[e.jsx("input",{onChange:h,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm..."}),v&&e.jsx(X,{size:16}),e.jsx("div",{className:"org-list",children:e.jsx("ul",{className:"list",children:(o=m==null?void 0:m.data)==null?void 0:o.map(t=>e.jsx(C,{selected:i.map(g=>g.id).includes(t.id),onClick:()=>N(t),children:t.name},t.id))})})]})})]})};function Ne(x){var F,P,M;const{rootSite:i,isBeautyxSite:n}=A(),u=_().format("MMDDss"),{discount:a,isForm:r}=x,{resultLoad:m,onCloseNoti:I,noti:v}=pe(),T=Q(),[h,N]=D.useState((a==null?void 0:a.is_campaign)??!1),[o,t]=D.useState(r==="EDIT"?a==null?void 0:a.items.map(s=>s.productable):[]),{mutate:g,isLoading:f}=q({mutationFn:s=>a?V.putDiscount(a.id,s):V.postDiscount(s),onSuccess:()=>{m({message:a?"Cập nhật thành công":"Tạo thành công",color:"success"}),setTimeout(()=>T(-1),2e3)},onError:(s,c,O)=>{m({message:"Có lỗi xảy ra",color:"error"})}}),l=K({initialValues:{priority:r==="EDIT"?a==null?void 0:a.priority:0,coupon_code:n?r==="EDIT"?a==null?void 0:a.coupon_code:"":`GMUP-${new Date().getTime()}`,title:r==="EDIT"?a==null?void 0:a.title:"",description:r==="EDIT"?a==null?void 0:a.description:"",platform:n?r==="EDIT"&&(a!=null&&a.platform)?(P=(F=a==null?void 0:a.platform)==null?void 0:F.split("|"))==null?void 0:P.filter(Boolean):[]:[b.GMUP],discount_type:r==="EDIT"?a==null?void 0:a.discount_type:"",discount_unit:r==="EDIT"?a==null?void 0:a.discount_unit:"",discount_value:r==="EDIT"?a==null?void 0:a.discount_value:"",organizations:r==="EDIT"?a==null?void 0:a.organizations:[],total:r==="EDIT"&&(a!=null&&a.total)?a==null?void 0:a.total:"",valid_from:r==="EDIT"&&(a!=null&&a.valid_from)?a==null?void 0:a.valid_from:_().format("YYYY-MM-DD HH:mm:ss"),valid_util:r==="EDIT"&&(a!=null&&a.valid_util)?a==null?void 0:a.valid_util:_().format("YYYY-MM-DD HH:mm:ss"),minimum_order_value:r==="EDIT"&&(a!=null&&a.maximum_discount_value)?a==null?void 0:a.maximum_discount_value:"",limit:r==="EDIT"&&(a!=null&&a.limit)?a==null?void 0:a.limit:""},validationSchema:W({coupon_code:d().required("Vui lòng nhập Mã giảm giá"),title:d().required("Vui lòng nhập tên chương trình khuyến mại"),description:d().required("Vui lòng nhập mô tả chương trình khuyến mại"),discount_type:d().required("Vui lòng chọn hình thức giảm giá"),discount_unit:d().required("Vui lòng chọn loại giảm giá "),discount_value:d().required("Vui lòng nhập giá trị giảm"),platform:R().min(1,"Vui lòng chọn nền tảng áp dụng"),organizations:R().min(1,"Vui lòng chọn Doanh nghiệp"),total:h?J().min(0,"Số lượng mã tối đa 4000 mã").max(4e3,"Số lượng mã tối đa 4000 mã").required("Vui lòng nhập số lượng mã"):d()}),onSubmit:s=>{var L;const c=s,O={...c,organizations:(L=s.organizations)==null?void 0:L.map(E=>E.id)[0],items:o.map(E=>E.id),platform:n?c.platform[0]??"MOMO":b.GMUP,is_campaign:h?1:0,limit:Number(s.limit)};o.length>0&&g(O)}}),w=Math.min.apply(null,o.map(s=>s==null?void 0:s.price));let y=0;o.length>0&&(y=(M=o==null?void 0:o.map(s=>s==null?void 0:s.price))==null?void 0:M.reduce((s,c)=>s+c));const k=s=>{l.values.discount_unit===j.PERCENT?(parseInt(s.target.value)<100||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value):l.values.discount_unit===j.PRICE&&(l.values.discount_type===p.PRODUCTS&&(parseInt(s.target.value)<w||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value),l.values.discount_type===p.SUB_TOTAL&&(parseInt(s.target.value)<y||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value),l.values.discount_type===p.FINAL_PRICE&&(parseInt(s.target.value)<w||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value))},z=s=>{(s.target.value>0||s.target.value==="")&&(l.setFieldValue("total",s.target.value),l.setFieldValue("limit",""))},G=s=>{l.values.discount_type===p.SUB_TOTAL&&l.values.discount_value===""&&l.setFieldValue("minimum_order_value",s.target.value)},B=s=>{const c=parseInt(`${l.values.total}`);if(l.values.total===""||typeof c=="number"&&parseInt(s.target.value)<c||s.target.value==="")return l.setFieldValue("limit",s.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(he,{severity:v.color,message:v.message,open:v.openAlert,close:I}),e.jsxs("form",{className:"discount-form",onSubmit:l.handleSubmit,autoComplete:"off",children:[i==Y.BEAUTYX&&e.jsx("div",{className:"flex-row-sp align-items-center input-wrap",children:e.jsx("div",{className:"wrap-item",children:e.jsx(Z,{value:h,onChange:s=>N(s.target.checked),label:"Is campaign (Áp dụng mã giảm giá Shopee, VinId, Viettel Money, Livwell)"})})}),e.jsx("div",{className:"flex-row-sp input-wrap",children:e.jsxs("div",{className:"wrap-item",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:l.handleChange,value:l.values.priority,name:"priority",type:"number",className:"form-control form-control-solid",placeholder:"Độ ưu tiên"})]})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item",children:[r==="ADD"?e.jsx("label",{className:"required form-label",children:n?`Mã giảm giá (org subdomain + ${u})`:"Code"}):e.jsx("label",{className:"required form-label",children:"Mã giảm giá"}),e.jsx("input",{onChange:l.handleChange,value:l.values.coupon_code,name:"coupon_code",type:"text",className:"form-control form-control-solid",placeholder:`Example:ORG${u}`}),l.errors.coupon_code&&l.touched.coupon_code&&e.jsx("span",{className:"text-danger",children:l.errors.coupon_code})]}),e.jsxs("div",{className:"wrap-item",children:[e.jsx("label",{className:"required form-label",children:"Tên"}),e.jsx("input",{onChange:l.handleChange,value:l.values.title,name:"title",type:"text",className:"form-control form-control-solid",placeholder:"Chương trình khuyến mại"}),l.errors.title&&l.touched.title&&e.jsx("span",{className:"text-danger",children:l.errors.title})]})]}),e.jsxs("div",{className:"input-wrap",children:[e.jsx("label",{className:"required form-label",children:"Mô tả"}),e.jsx("input",{onChange:l.handleChange,value:l.values.description,name:"description",type:"text",className:"form-control form-control-solid",placeholder:"Mô tả chương trình khuyến mại"}),l.errors.description&&l.touched.description&&e.jsx("span",{className:"text-danger",children:l.errors.description})]}),i===Y.BEAUTYX&&e.jsxs("div",{className:"flex-col input-wrap",children:[e.jsx("label",{className:"required form-label",children:"Áp dụng cho nền tảng"}),e.jsx(S,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:l.values.platform,onChange:l.handleChange,name:"platform",renderValue:s=>e.jsx(U,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s==null?void 0:s.map(c=>e.jsx(de,{platForm:c},c))}),children:ee.map(s=>e.jsx(C,{value:s,children:s},s))}),l.errors.platform&&l.touched.platform&&e.jsx("span",{className:"text-danger",children:l.errors.platform})]}),e.jsxs("div",{className:"flex-col input-wrap",children:[e.jsx(je,{label:"Doanh nghiệp được áp dụng",origins:l.values.organizations,onChangeOrigin:s=>{t([]),l.setFieldValue("organizations",s)}}),l.errors.organizations&&l.touched.organizations&&e.jsx("span",{className:"text-danger",children:l.errors.organizations})]}),e.jsx("div",{className:"flex-col input-wrap",children:e.jsx(ve,{values:o,setValues:t,orgsChoose:l.values.organizations})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"flex-col wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"required form-label",children:"Hình thức giảm giá "}),e.jsx(S,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.values.discount_type,onChange:l.handleChange,name:"discount_type",children:ae.map(s=>e.jsx(C,{value:s.TYPE,children:s.title},s.id))}),l.errors.discount_type&&l.touched.discount_type&&e.jsx("span",{className:"text-danger",children:l.errors.discount_type})]}),e.jsxs("div",{className:"flex-col wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"required form-label",children:"Giảm giá theo"}),e.jsx(S,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.values.discount_unit,onChange:s=>{l.setFieldValue("discount_value",""),l.setFieldValue("discount_unit",s.target.value)},name:"discount_unit",children:le.map(s=>e.jsx(C,{value:s.TYPE,children:s.title},s.id))}),l.errors.discount_unit&&l.touched.discount_unit&&e.jsx("span",{className:"text-danger",children:l.errors.discount_unit})]}),e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsxs("label",{className:"required form-label",children:[l.values.discount_type===p.FINAL_PRICE?"Giảm giá còn":"Giá trị giảm giá",l.values.discount_unit===j.PERCENT&&"(%)",l.values.discount_unit===j.PRICE&&"(VNĐ)"]}),e.jsx("input",{onChange:k,value:l.values.discount_value,name:"discount_value",type:"text",className:"form-control form-control-solid",placeholder:l.values.discount_unit===j.PRICE?`Giá trị giảm tối đa ${se(l.values.discount_type===p.SUB_TOTAL?y:w)}đ`:"Giảm giá"}),l.errors.discount_value&&l.touched.discount_value&&e.jsx("span",{className:"text-danger",children:l.errors.discount_value})]})]}),e.jsx("div",{className:"flex-row-sp input-wrap",children:e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"form-label",children:"Giá trị đơn hàng tối thiểu"}),e.jsx("input",{onChange:G,value:l.values.minimum_order_value,name:"minimum_order_value",disabled:l.values.discount_type===p.PRODUCTS,type:"text",className:"form-control form-control-solid",placeholder:"Giá áp dụng"})]})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:`${h?"required":""} form-label`,children:"Số lượng"}),e.jsx("input",{value:l.values.total,onChange:z,name:"total",type:"text",className:"form-control form-control-solid",placeholder:""}),l.errors.total&&l.touched.total&&e.jsx("span",{className:"text-danger",children:l.errors.total})]}),e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"form-label",children:"Lượt sử dụng mỗi khách hàng "}),e.jsx("input",{value:l.values.limit,onChange:B,name:"limit",type:"number",className:"form-control form-control-solid",placeholder:""})]}),e.jsx("div",{className:"wrap-item wrap-item-col-4",children:e.jsx(te,{minDate:new Date,startDate:new Date(l.values.valid_from),endDate:new Date(l.values.valid_util),onChange:s=>{l.setFieldValue("valid_from",_(s.selection.startDate).format("YYYY-MM-DD HH:mm:ss")),l.setFieldValue("valid_util",_(s.selection.endDate).format("YYYY-MM-DD HH:mm:ss"))}})})]}),e.jsxs("div",{className:"input-form__bot",children:[e.jsx(_e,{loading:f,type:"submit",variant:"contained",size:"large",color:"success",children:"Lưu thay đổi"}),a&&(a.platform===b.SHOPEE||a.platform===b.VINID)&&e.jsx(fe,{discount:a})]})]})]})}function Fe(){const x=ie(),i=re();let n="ADD";i&&i.id&&(n="EDIT");const{data:u,refetch:a,isLoading:r}=ne({queryKey:[[oe.DISCOUNT,i.id]],queryFn:()=>V.getDiscountDetail({id:i.id}),enabled:!!i.id}),m=(u==null?void 0:u.context)||x.state;return e.jsxs(ce,{permissions:i!=null&&i.id?["v1.discounts.update"]:["v1.discounts.store"],showEmpty:!0,children:[e.jsx(me,{title:i!=null&&i.id?"Chỉnh thông tin giảm giá":"Tạo mới mã giảm giá"}),e.jsx("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:e.jsxs("div",{className:"container",children:[r&&e.jsx(ue,{}),(n==="ADD"||m)&&e.jsx(Ne,{isForm:n,discount:m,onRestoreFormEdit:a})]})})]})}export{fe as ExportCode,Fe as default};
