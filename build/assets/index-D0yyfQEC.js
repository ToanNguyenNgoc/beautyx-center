import{a as f,aT as de,aS as ue,aK as te,bP as _e,aP as M,aU as pe,j as e,aW as me,aX as ge,aY as J,aZ as he,bv as Ce,aG as xe,V as fe,bQ as ye,aF as Ne,bR as ve,bS as E,an as Te,aC as W,bm as re,ak as z,bz as ie,bF as Be,aD as Y,a8 as De,z as Ee,s as Ie,bT as O,bU as w,aI as H,v as R,bV as $e,bW as oe,bK as S,at as we,aA as Re,aB as K,bE as Se,bL as k,bO as Me,bX as Pe,bM as ze,bY as Oe,a7 as ae,ae as ke,Q as Fe,aE as Ae,as as Ve,a9 as Le,al as Ge}from"./index-B-8ZwVwN.js";/* empty css              */import{u as Ue,A as Ye}from"./index-CofMJZIV.js";import{u as We}from"./useGetGmupTags-BAwV1AhY.js";import{F as qe}from"./index-CYPFytSd.js";import{A as Xe}from"./Avatar-Kn6OQjuO.js";import{S as He}from"./select-service-DHY3cz4r.js";import{E as Ke}from"./export-code-GU8wsFy1.js";import{a as Q}from"./colorManipulator-CeTzr_L5.js";import{T as Z}from"./Tooltip-hAocn3Us.js";import{L as Qe}from"./LoadingButton-CddcXNEg.js";import"./Popper-CqAISdK9.js";function Ze(a){return f.Children.toArray(a).filter(r=>f.isValidElement(r))}function Je(a){return ue("MuiToggleButton",a)}const F=de("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),be=f.createContext({}),je=f.createContext(void 0);function et(a,r){return r===void 0||a===void 0?!1:Array.isArray(r)?r.indexOf(a)>=0:a===r}const tt=["value"],at=["children","className","color","disabled","disableFocusRipple","fullWidth","onChange","onClick","selected","size","value"],lt=a=>{const{classes:r,fullWidth:i,selected:u,disabled:m,size:t,color:d}=a,h={root:["root",u&&"selected",m&&"disabled",i&&"fullWidth",`size${J(t)}`,d]};return he(h,Je,r)},st=me(Ce,{name:"MuiToggleButton",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:i}=a;return[r.root,r[`size${J(i.size)}`]]}})(({theme:a,ownerState:r})=>{let i=r.color==="standard"?a.palette.text.primary:a.palette[r.color].main,u;return a.vars&&(i=r.color==="standard"?a.vars.palette.text.primary:a.vars.palette[r.color].main,u=r.color==="standard"?a.vars.palette.text.primaryChannel:a.vars.palette[r.color].mainChannel),M({},a.typography.button,{borderRadius:(a.vars||a).shape.borderRadius,padding:11,border:`1px solid ${(a.vars||a).palette.divider}`,color:(a.vars||a).palette.action.active},r.fullWidth&&{width:"100%"},{[`&.${F.disabled}`]:{color:(a.vars||a).palette.action.disabled,border:`1px solid ${(a.vars||a).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:a.vars?`rgba(${a.vars.palette.text.primaryChannel} / ${a.vars.palette.action.hoverOpacity})`:Q(a.palette.text.primary,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${F.selected}`]:{color:i,backgroundColor:a.vars?`rgba(${u} / ${a.vars.palette.action.selectedOpacity})`:Q(i,a.palette.action.selectedOpacity),"&:hover":{backgroundColor:a.vars?`rgba(${u} / calc(${a.vars.palette.action.selectedOpacity} + ${a.vars.palette.action.hoverOpacity}))`:Q(i,a.palette.action.selectedOpacity+a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:a.vars?`rgba(${u} / ${a.vars.palette.action.selectedOpacity})`:Q(i,a.palette.action.selectedOpacity)}}}},r.size==="small"&&{padding:7,fontSize:a.typography.pxToRem(13)},r.size==="large"&&{padding:15,fontSize:a.typography.pxToRem(15)})}),rt=f.forwardRef(function(r,i){const u=f.useContext(be),{value:m}=u,t=te(u,tt),d=f.useContext(je),h=_e(M({},t,{selected:et(r.value,m)}),r),C=pe({props:h,name:"MuiToggleButton"}),{children:_,className:x,color:v="standard",disabled:y=!1,disableFocusRipple:o=!1,fullWidth:n=!1,onChange:c,onClick:p,selected:D,size:l="medium",value:N}=C,I=te(C,at),$=M({},C,{color:v,disabled:y,disableFocusRipple:o,fullWidth:n,size:l}),V=lt($),T=B=>{p&&(p(B,N),B.defaultPrevented)||c&&c(B,N)},b=d||"";return e.jsx(st,M({className:ge(t.className,V.root,x,b),disabled:y,focusRipple:!o,ref:i,onClick:T,onChange:c,value:N,ownerState:$,"aria-pressed":D},I,{children:_}))});function it(a){return ue("MuiToggleButtonGroup",a)}const g=de("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),ot=["children","className","color","disabled","exclusive","fullWidth","onChange","orientation","size","value"],nt=a=>{const{classes:r,orientation:i,fullWidth:u,disabled:m}=a,t={root:["root",i==="vertical"&&"vertical",u&&"fullWidth"],grouped:["grouped",`grouped${J(i)}`,m&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return he(t,it,r)},ct=me("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(a,r)=>{const{ownerState:i}=a;return[{[`& .${g.grouped}`]:r.grouped},{[`& .${g.grouped}`]:r[`grouped${J(i.orientation)}`]},{[`& .${g.firstButton}`]:r.firstButton},{[`& .${g.lastButton}`]:r.lastButton},{[`& .${g.middleButton}`]:r.middleButton},r.root,i.orientation==="vertical"&&r.vertical,i.fullWidth&&r.fullWidth]}})(({ownerState:a,theme:r})=>M({display:"inline-flex",borderRadius:(r.vars||r).shape.borderRadius},a.orientation==="vertical"&&{flexDirection:"column"},a.fullWidth&&{width:"100%"},{[`& .${g.grouped}`]:M({},a.orientation==="horizontal"?{[`&.${g.selected} + .${g.grouped}.${g.selected}`]:{borderLeft:0,marginLeft:0}}:{[`&.${g.selected} + .${g.grouped}.${g.selected}`]:{borderTop:0,marginTop:0}})},a.orientation==="horizontal"?{[`& .${g.firstButton},& .${g.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${g.lastButton},& .${g.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0}}:{[`& .${g.firstButton},& .${g.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${g.lastButton},& .${g.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0}},a.orientation==="horizontal"?{[`& .${g.lastButton}.${F.disabled},& .${g.middleButton}.${F.disabled}`]:{borderLeft:"1px solid transparent"}}:{[`& .${g.lastButton}.${F.disabled},& .${g.middleButton}.${F.disabled}`]:{borderTop:"1px solid transparent"}})),dt=f.forwardRef(function(r,i){const u=pe({props:r,name:"MuiToggleButtonGroup"}),{children:m,className:t,color:d="standard",disabled:h=!1,exclusive:C=!1,fullWidth:_=!1,onChange:x,orientation:v="horizontal",size:y="medium",value:o}=u,n=te(u,ot),c=M({},u,{disabled:h,fullWidth:_,orientation:v,size:y}),p=nt(c),D=f.useCallback((T,b)=>{if(!x)return;const B=o&&o.indexOf(b);let P;o&&B>=0?(P=o.slice(),P.splice(B,1)):P=o?o.concat(b):[b],x(T,P)},[x,o]),l=f.useCallback((T,b)=>{x&&x(T,o===b?null:b)},[x,o]),N=f.useMemo(()=>({className:p.grouped,onChange:C?l:D,value:o,size:y,fullWidth:_,color:d,disabled:h}),[p.grouped,C,l,D,o,y,_,d,h]),I=Ze(m),$=I.length,V=T=>{const b=T===0,B=T===$-1;return b&&B?"":b?p.firstButton:B?p.lastButton:p.middleButton};return e.jsx(ct,M({role:"group",className:ge(p.root,t),ref:i,ownerState:c},n,{children:e.jsx(be.Provider,{value:N,children:I.map((T,b)=>e.jsx(je.Provider,{value:V(b),children:T},b))})}))}),ut=({label:a="Gắn doanh nghiệp",origins:r=[],onChangeOrigin:i})=>{var y;const{isBeautyxSite:u}=xe(),m=f.useRef(null),t=o=>{m.current&&(o==="hide"&&m.current.classList.remove("org-search-show"),o==="show"&&m.current.classList.add("org-search-show"))};window.addEventListener("click",()=>t("hide"));const{data:d,mutate:h,isLoading:C}=fe({mutationFn:o=>ye.getAll(u?{keyword:o,is_ecommerce:!0}:{keyword:o,is_gmup:!0}).then(n=>n.data.context)}),_=f.useCallback(Ne.debounce(o=>h(o),600),[]),x=o=>_(o.target.value),v=o=>{i&&(r.findIndex(c=>c.id===o.id)<0?i([...r,o]):i(r.filter(c=>c.id!==o.id)))};return e.jsxs("div",{className:"col col-org",children:[e.jsx("label",{className:"required filter-row_label mb-2",children:a}),e.jsx("div",{onClick:o=>{o.stopPropagation(),t("show")},className:"form-control form-control-solid",children:r.length>0?r.map(o=>e.jsx(ve,{className:"m-1",color:"primary",label:o.name,avatar:e.jsx(Xe,{alt:o.subdomain,src:o.image_url}),onDelete:()=>v(o)},o.id)):"Gắn doanh nghiệp"}),e.jsx(E,{ref:m,sx:{boxShadow:3},className:"org-search",children:e.jsxs("div",{onClick:o=>o.stopPropagation(),children:[e.jsx("input",{onChange:x,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm..."}),C&&e.jsx(Te,{size:16}),e.jsx("div",{className:"org-list",children:e.jsx("ul",{className:"list",children:(y=d==null?void 0:d.data)==null?void 0:y.map(o=>e.jsx(W,{selected:r.map(n=>n.id).includes(o.id),onClick:()=>v(o),children:o.name},o.id))})})]})})]})},q=[{start:"08:00",end:"12:00"},{start:"13:00",end:"17:30"}],ne=[{label:"CN",value:0},{label:"T2",value:1},{label:"T3",value:2},{label:"T4",value:3},{label:"T5",value:4},{label:"T6",value:5},{label:"T7",value:6}];function A(a){const[r,i]=a.split(":").map(Number);return r*60+i}function ce(a){const r=String(Math.floor(a/60)).padStart(2,"0"),i=String(a%60).padStart(2,"0");return`${r}:${i}`}function pt(a,r){return`${ce(a)}-${ce(r)}`}function mt(a=60,r=30){const i=[];for(const u of q){let m=A(u.start);const t=A(u.end);for(;m+a<=t;)i.push(pt(m,m+a)),m+=r}return Array.from(new Set(i))}function gt({value:a,onChange:r}){var o;const[i,u]=f.useState(1),m=f.useMemo(()=>mt(60,30),[]),t=(n=a,c=i)=>{const p={...n};return p[c]||(p[c]={}),p},d=n=>{let c=t();c[i][n]?delete c[i][n]:c[i][n]=1,r({...c})},h=(n,c)=>{let p=t();c<=0?delete p[i][n]:p[i][n]=c,r({...p})},C=(n,c=1)=>{let p=t();const D={morning:q[0],afternoon:q[1],allday:{start:q[0].start,end:q[1].end}}[n];m.filter(N=>{const[I,$]=N.split("-");return A(I)>=A(D.start)&&A($)<=A(D.end)}).forEach(N=>{p[i][N]=c}),r({...p})},_=(a==null?void 0:a[i])??{},x=Object.keys((a==null?void 0:a[i])||{}).length,v=Object.values(a||{}).reduce((n,c)=>n+Object.keys(c||{}).length,0),y=n=>{let c={...a};n==="day"?c[i]&&(c[i]={}):c={},r(c)};return e.jsxs(E,{sx:{border:"1px solid #E5E7EB",borderRadius:2,p:2},children:[e.jsx(dt,{value:i,exclusive:!0,onChange:(n,c)=>{c!==null&&u(c)},sx:{mb:2,flexWrap:"wrap"},children:ne.map(n=>e.jsx(rt,{color:"primary",value:n.value,size:"small",children:n.label},n.value))}),e.jsxs(E,{sx:{display:"flex",gap:1,alignItems:"center",mb:2,flexWrap:"wrap"},children:[e.jsx(re,{variant:"body2",children:"Áp dụng nhanh:"}),e.jsx(z,{size:"small",variant:"outlined",onClick:()=>C("morning",1),children:"Sáng (x1)"}),e.jsx(z,{size:"small",variant:"outlined",onClick:()=>C("afternoon",1),children:"Chiều (x1)"}),e.jsx(z,{size:"small",variant:"outlined",onClick:()=>C("allday",1),children:"Cả ngày (x1)"}),e.jsxs(E,{sx:{display:"inline-flex",alignItems:"center",gap:1,ml:"auto",flexWrap:"wrap"},children:[e.jsx(Z,{title:`Xoá tất cả slot của ngày đang chọn (${x})`,children:e.jsx("span",{children:e.jsxs(z,{size:"small",variant:"outlined",color:"error",disabled:x===0,onClick:()=>y("day"),children:["Xoá ngày (",x,")"]})})}),e.jsx(Z,{title:`Xoá tất cả mọi lựa chọn (${v})`,children:e.jsx("span",{children:e.jsxs(z,{size:"small",variant:"contained",color:"error",disabled:v===0,onClick:()=>y("all"),children:["Xoá tất cả (",v,")"]})})})]})]}),e.jsx(ie,{container:!0,spacing:1,children:m.map(n=>{const c=!!_[n],p=_[n]??0;return e.jsx(ie,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(E,{sx:{p:1,borderRadius:1,border:"1px solid",borderColor:c?"primary.main":"#E5E7EB",bgcolor:c?"primary.50":"background.paper",display:"flex",alignItems:"center",justifyContent:"space-between",gap:1},children:[e.jsx(z,{size:"small",variant:c?"contained":"text",onClick:()=>d(n),children:n}),c?e.jsxs(E,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Z,{title:"Giảm số lượng",children:e.jsx("button",{type:"button",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",onClick:()=>h(n,p-1),children:"-"})}),e.jsx(Be,{size:"small",type:"number",value:p,onChange:D=>h(n,Math.max(1,parseInt(D.target.value||"1"))),inputProps:{min:1},sx:{width:50}}),e.jsx(Z,{title:"Tăng số lượng",children:e.jsx("button",{type:"button",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",onClick:()=>h(n,p+1),children:"+"})})]}):e.jsx(E,{sx:{width:70,textAlign:"right",color:"text.secondary"},children:" "})]})},n)})}),e.jsxs(E,{sx:{mt:2},children:[e.jsxs(re,{variant:"body2",sx:{mb:1},children:["Đã chọn (ngày ",(o=ne.find(n=>n.value===i))==null?void 0:o.label,") •"," ","Ngày: ",x," • Tổng: ",v]}),e.jsx(E,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:Object.entries(_).map(([n,c])=>e.jsx(ve,{color:"primary",label:`${n} × ${c}`,onDelete:()=>h(n,0),sx:{mt:1.5}},n))})]})]})}function ht(a){var B,P,le,se;const{rootSite:r,isBeautyxSite:i}=xe(),{gmupTags:u}=We({limit:100,"filter[is_root]":!1,"filter[status]":!0}),m=Y().format("MMDDss"),{discount:t,isForm:d}=a,{resultLoad:h,onCloseNoti:C,noti:_}=Ue(),x=De(),[v,y]=f.useState((t==null?void 0:t.is_campaign)??!1),[o,n]=f.useState(d==="EDIT"?t==null?void 0:t.items.map(s=>s.productable):[]);function c(s,j){const L=Object.entries(s).map(([G,ee])=>({day:Number(G),time_slots:Object.entries(ee).map(([X,U])=>({time:X,quantity:U}))})).filter(G=>G.time_slots.length>0);return[{[String(j)]:{weekday:L}}]}const{mutate:p,isLoading:D}=fe({mutationFn:s=>t?ae.Discount.put(t.id,s):ae.Discount.post(s),onSuccess:()=>{h({message:t?"Cập nhật thành công":"Tạo thành công",color:"success"}),setTimeout(()=>x(-1),2e3)},onError:(s,j,L)=>{h({message:"Có lỗi xảy ra",color:"error"})}}),l=Ee({initialValues:{priority:d==="EDIT"?t==null?void 0:t.priority:0,coupon_code:i?d==="EDIT"?t==null?void 0:t.coupon_code:"":`GMUP-${new Date().getTime()}`,title:d==="EDIT"?t==null?void 0:t.title:"",description:d==="EDIT"?t==null?void 0:t.description:"",platform:i?d==="EDIT"&&(t!=null&&t.platform)?(P=(B=t==null?void 0:t.platform)==null?void 0:B.split("|"))==null?void 0:P.filter(Boolean):[]:[H.GMUP],discount_type:i?d==="EDIT"?t==null?void 0:t.discount_type:"":w.FINAL_PRICE,discount_unit:i?d==="EDIT"?t==null?void 0:t.discount_unit:"":O.PRICE,discount_value:d==="EDIT"?t==null?void 0:t.discount_value:"",organizations:d==="EDIT"?t==null?void 0:t.organizations:[],total:i?d==="EDIT"&&(t!=null&&t.total)?t==null?void 0:t.total:"":3e3,valid_from:d==="EDIT"&&(t!=null&&t.valid_from)?t==null?void 0:t.valid_from:Y().format("YYYY-MM-DD HH:mm:ss"),valid_util:d==="EDIT"&&(t!=null&&t.valid_util)?t==null?void 0:t.valid_util:Y().format("YYYY-MM-DD HH:mm:ss"),minimum_order_value:i?d==="EDIT"&&(t!=null&&t.maximum_discount_value)?t==null?void 0:t.maximum_discount_value:"":0,limit:i?d==="EDIT"&&(t!=null&&t.limit)?t==null?void 0:t.limit:"":void 0,gmup_tag_ids:d==="EDIT"?(le=t==null?void 0:t.gmup_tags)==null?void 0:le.map(s=>Number(s.id)).filter(Boolean):[],ai_description:d==="EDIT"?(t==null?void 0:t.ai_description)??"":"",schedules_state:{}},validationSchema:Ie({coupon_code:R().required("Vui lòng nhập Mã giảm giá"),title:R().required("Vui lòng nhập tên"),description:R().required("Vui lòng nhập mô tả"),discount_type:R().required("Vui lòng chọn hình thức giảm giá"),discount_unit:R().required("Vui lòng chọn loại giảm giá "),discount_value:R().required("Vui lòng nhập giá trị giảm"),platform:oe().min(1,"Vui lòng chọn nền tảng áp dụng"),organizations:oe().min(1,"Vui lòng chọn Doanh nghiệp"),total:v?$e().min(0,"Số lượng mã tối đa 4000 mã").max(4e3,"Số lượng mã tối đa 4000 mã").required("Vui lòng nhập số lượng mã"):R(),ai_description:R().nullable()}),onSubmit:s=>{var X;const j=s,L=(X=s.organizations)==null?void 0:X.map(U=>U.id)[0],G=c(s.schedules_state,L),ee={...j,organizations:L,items:o.map(U=>U.id),platform:i?j.platform[0]??"MOMO":H.GMUP,is_campaign:v?1:0,limit:Number(s.limit),ai_description:s.ai_description,schedules:G};o.length>0&&p(ee)}}),N=Math.min.apply(null,o.map(s=>s==null?void 0:s.price));let I=0;o.length>0&&(I=(se=o==null?void 0:o.map(s=>s==null?void 0:s.price))==null?void 0:se.reduce((s,j)=>s+j));const $=s=>{l.values.discount_unit===O.PERCENT?(parseInt(s.target.value)<100||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value):l.values.discount_unit===O.PRICE&&(l.values.discount_type===w.PRODUCTS&&(parseInt(s.target.value)<=N||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value),l.values.discount_type===w.SUB_TOTAL&&(parseInt(s.target.value)<I||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value),l.values.discount_type===w.FINAL_PRICE&&(parseInt(s.target.value)<=N||s.target.value==="")&&l.setFieldValue("discount_value",s.target.value))},V=s=>{(s.target.value>0||s.target.value==="")&&(l.setFieldValue("total",s.target.value),l.setFieldValue("limit",""))},T=s=>{l.values.discount_type===w.SUB_TOTAL&&l.values.discount_value===""&&l.setFieldValue("minimum_order_value",s.target.value)},b=s=>{const j=parseInt(`${l.values.total}`);if(l.values.total===""||typeof j=="number"&&parseInt(s.target.value)<j||s.target.value==="")return l.setFieldValue("limit",s.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{severity:_.color,message:_.message,open:_.openAlert,close:C}),e.jsxs("form",{className:"discount-form",onSubmit:l.handleSubmit,autoComplete:"off",children:[r==S.BEAUTYX&&e.jsx("div",{className:"flex-row-sp align-items-center input-wrap",children:e.jsx("div",{className:"wrap-item",children:e.jsx(we,{value:v,onChange:s=>y(s.target.checked),label:"Is campaign (Áp dụng mã giảm giá Shopee, VinId, Viettel Money, Livwell)"})})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:l.handleChange,value:l.values.priority,name:"priority",type:"number",className:"form-control form-control-solid",placeholder:"Độ ưu tiên"})]}),e.jsxs("div",{className:"wrap-item d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tag dịch vụ"}),e.jsx(Re,{sx:{m:1,minWidth:120},size:"small",children:e.jsx(K,{value:l.values.gmup_tag_ids.length>0?l.values.gmup_tag_ids[0]:void 0,onChange:s=>l.setFieldValue("gmup_tag_ids",[s.target.value]),renderValue:()=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:u.filter(s=>{var j;return(j=l.values.gmup_tag_ids)==null?void 0:j.includes(s.id||0)}).map(s=>e.jsx("span",{children:s.name},s.id))}),children:u.map(s=>e.jsx(W,{value:s.id,children:s.name},s.id))})})]})]}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item",children:[d==="ADD"?e.jsx("label",{className:"required form-label",children:i?`Mã giảm giá (org subdomain + ${m})`:"Code"}):e.jsx("label",{className:"required form-label",children:"Mã giảm giá"}),e.jsx("input",{onChange:l.handleChange,value:l.values.coupon_code,name:"coupon_code",type:"text",className:"form-control form-control-solid",placeholder:`Example:ORG${m}`}),l.errors.coupon_code&&l.touched.coupon_code&&e.jsx("span",{className:"text-danger",children:l.errors.coupon_code})]}),e.jsxs("div",{className:"wrap-item",children:[e.jsx("label",{className:"required form-label",children:"Tên"}),e.jsx("input",{onChange:l.handleChange,value:l.values.title,name:"title",type:"text",className:"form-control form-control-solid",placeholder:"Tên"}),l.errors.title&&l.touched.title&&e.jsx("span",{className:"text-danger",children:l.errors.title})]})]}),e.jsxs("div",{className:"input-wrap",children:[e.jsx("label",{className:"required form-label",children:"Mô tả"}),e.jsx("input",{onChange:l.handleChange,value:l.values.description,name:"description",type:"text",className:"form-control form-control-solid",placeholder:"Mô tả "}),l.errors.description&&l.touched.description&&e.jsx("span",{className:"text-danger",children:l.errors.description})]}),r===S.BEAUTYX&&e.jsxs("div",{className:"flex-col input-wrap",children:[e.jsx("label",{className:"required form-label",children:"Áp dụng cho nền tảng"}),e.jsx(K,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:l.values.platform,onChange:l.handleChange,name:"platform",renderValue:s=>e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s==null?void 0:s.map(j=>e.jsx(qe,{platForm:j},j))}),children:Se.map(s=>e.jsx(W,{value:s,children:s},s))}),l.errors.platform&&l.touched.platform&&e.jsx("span",{className:"text-danger",children:l.errors.platform})]}),e.jsxs("div",{className:"flex-col input-wrap",children:[e.jsx(ut,{label:"Doanh nghiệp được áp dụng",origins:l.values.organizations,onChangeOrigin:s=>{n([]),l.setFieldValue("organizations",s)}}),l.errors.organizations&&l.touched.organizations&&e.jsx("span",{className:"text-danger",children:l.errors.organizations})]}),e.jsx("div",{className:"flex-col input-wrap",children:e.jsx(He,{values:o,setValues:n,orgsChoose:l.values.organizations})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsx(k,{site:S.BEAUTYX,children:e.jsxs("div",{className:"flex-col wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"required form-label",children:"Hình thức giảm giá "}),e.jsx(K,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.values.discount_type,onChange:l.handleChange,name:"discount_type",children:Me.map(s=>e.jsx(W,{value:s.TYPE,children:s.title},s.id))}),l.errors.discount_type&&l.touched.discount_type&&e.jsx("span",{className:"text-danger",children:l.errors.discount_type})]})}),e.jsx(k,{site:S.BEAUTYX,children:e.jsxs("div",{className:"flex-col wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"required form-label",children:"Giảm giá theo"}),e.jsx(K,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:l.values.discount_unit,onChange:s=>{l.setFieldValue("discount_value",""),l.setFieldValue("discount_unit",s.target.value)},name:"discount_unit",children:Pe.map(s=>e.jsx(W,{value:s.TYPE,children:s.title},s.id))}),l.errors.discount_unit&&l.touched.discount_unit&&e.jsx("span",{className:"text-danger",children:l.errors.discount_unit})]})}),e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsxs("label",{className:"required form-label",children:[l.values.discount_type===w.FINAL_PRICE?"Giảm giá còn":"Giá trị giảm giá",l.values.discount_unit===O.PERCENT&&"(%)",l.values.discount_unit===O.PRICE&&"(VNĐ)"]}),e.jsx("input",{onChange:$,value:l.values.discount_value,name:"discount_value",type:"text",className:"form-control form-control-solid",placeholder:l.values.discount_unit===O.PRICE?`Giá trị giảm tối đa ${ze(l.values.discount_type===w.SUB_TOTAL?I:N)}đ`:"Giảm giá"}),l.errors.discount_value&&l.touched.discount_value&&e.jsx("span",{className:"text-danger",children:l.errors.discount_value})]})]}),e.jsx("div",{className:"flex-row-sp input-wrap",children:e.jsx(k,{site:S.BEAUTYX,children:e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"form-label",children:"Giá trị đơn hàng tối thiểu"}),e.jsx("input",{onChange:T,value:l.values.minimum_order_value,name:"minimum_order_value",disabled:l.values.discount_type===w.PRODUCTS,type:"text",className:"form-control form-control-solid",placeholder:"Giá áp dụng"})]})})}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsx(k,{site:S.BEAUTYX,children:e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:`${v?"required":""} form-label`,children:"Số lượng"}),e.jsx("input",{value:l.values.total,onChange:V,name:"total",type:"text",className:"form-control form-control-solid",placeholder:""}),l.errors.total&&l.touched.total&&e.jsx("span",{className:"text-danger",children:l.errors.total})]})}),e.jsx(k,{site:S.BEAUTYX,children:e.jsxs("div",{className:"wrap-item wrap-item-col-4",children:[e.jsx("label",{className:"form-label",children:"Lượt sử dụng mỗi khách hàng "}),e.jsx("input",{value:l.values.limit,onChange:b,name:"limit",type:"number",className:"form-control form-control-solid",placeholder:""})]})}),e.jsx("div",{className:"wrap-item wrap-item-col-4",children:e.jsx(Oe,{minDate:new Date,startDate:new Date(l.values.valid_from),endDate:new Date(l.values.valid_util),onChange:s=>{l.setFieldValue("valid_from",Y(s.selection.startDate).format("YYYY-MM-DD HH:mm:ss")),l.setFieldValue("valid_util",Y(s.selection.endDate).format("YYYY-MM-DD HH:mm:ss"))}})})]}),e.jsxs(k,{site:S.GMUP,children:[e.jsxs("div",{className:"input-wrap",children:[e.jsx("label",{className:"form-label",children:"Mô tả AI"}),e.jsx("textarea",{onChange:l.handleChange,value:l.values.ai_description,name:"ai_description",rows:3,className:"form-control form-control-solid",placeholder:"Mô tả cho AI (ngữ cảnh, tone, mục tiêu...)"})]}),e.jsxs("div",{className:"flex-col input-wrap",children:[e.jsx("label",{className:"form-label",children:"Lịch khung giờ"}),e.jsx(gt,{value:l.values.schedules_state,onChange:s=>l.setFieldValue("schedules_state",s)})]})]}),e.jsxs("div",{className:"input-form__bot",children:[e.jsx(Qe,{loading:D,type:"submit",variant:"contained",size:"large",color:"success",children:"Lưu thay đổi"}),t&&(t.platform===H.SHOPEE||t.platform===H.VINID)&&e.jsx(Ke,{discount:t})]})]})]})}function Et(){const a=ke();let r="ADD";a&&a.id&&(r="EDIT");const{data:i,refetch:u,isLoading:m}=Fe({queryKey:[[Ae.DISCOUNT,a.id]],queryFn:()=>ae.Discount.detDetail({id:a.id,include:"gmup_tags"}),enabled:!!a.id}),t=i==null?void 0:i.context;return e.jsxs(Ve,{permissions:a!=null&&a.id?["v1.discounts.update"]:["v1.discounts.store"],showEmpty:!0,children:[e.jsx(Le,{title:a!=null&&a.id?"Chỉnh thông tin giảm giá":"Tạo mới mã giảm giá"}),e.jsx("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:e.jsxs("div",{className:"container",children:[m&&e.jsx(Ge,{}),(r==="ADD"||t)&&e.jsx(ht,{isForm:r,discount:t,onRestoreFormEdit:u})]})})]})}export{Ke as ExportCode,Et as default};
