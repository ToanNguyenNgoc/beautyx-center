import{Q as S,bB as z,j as i,aS as _,aR as E,a as h,aT as T,aJ as $,aO as x,aV as M,aW as R,aX as k,aY as O,cO as q,a_ as D,ce as V,a7 as F,e as L,ad as X,V as G,at as H,a8 as U,ax as N}from"./index-CzmKoHlB.js";import{u as A}from"./useGetRolesAndPermissions-C75sRO7j.js";import{r as j}from"./roleAndPermissionApi-BW8t4dcC.js";import{X as K}from"./index-ClAbqqfo.js";import{T as I}from"./Tooltip-DbuSg8qh.js";import"./LoadingButton-CQgDJbfP.js";import"./Popper-BO2V-fwh.js";function Q(){const{hasEnabled:s}=A(),{data:t}=S({queryKey:["roleAndPermissionApi.permissions"],queryFn:()=>j.permissions().then(e=>e.data),enabled:s("v1.permissions.index")}),n=(t==null?void 0:t.context)||[],a=[{name:"roles",desc:"Phân quyền",permissions:n.filter(e=>e.name.includes("roles"))},{name:"permissions",desc:"Permissions",permissions:n.filter(e=>e.name.includes("permissions"))},{name:"admin.users",desc:"Người dùng",permissions:n.filter(e=>e.name.includes("admin.users"))},{name:"banners",desc:"Banner",permissions:n.filter(e=>e.name.includes("banners"))},{name:"discounts",desc:"Giảm giá",permissions:n.filter(e=>e.name.includes("discounts"))},{name:"promotions",desc:"Promotions",permissions:n.filter(e=>e.name.includes("promotions"))},{name:"beautyx.tips",desc:"BeautyX tips",permissions:n.filter(e=>e.name.includes("beautyx.tips"))},{name:"beautyx.notification",desc:"Push thông báo BeautyX",permissions:n.filter(e=>e.name.includes("beautyx.notification"))},{name:"organizations.updateECommerce",desc:"Cửa hàng",permissions:n.filter(e=>e.name.includes("organizations.updateECommerce"))},{name:"admin.orders",desc:"Danh sách đơn hàng",permissions:n.filter(e=>e.name.includes("admin.orders"))},{name:"admin.comments",desc:"Danh sách bình luận",permissions:n.filter(e=>e.name.includes("admin.comments"))},{name:"versions",desc:"Danh sách phiên bản phần mềm",permissions:n.filter(e=>e.name.includes("versions"))},{name:"brand_apps",desc:"Danh sách phiên bản App thương hiệu",permissions:n.filter(e=>e.name.includes("brand_apps"))},{name:"brand_app_versions",desc:"Danh sách phiên bản Bundle app thương hiệu",permissions:n.filter(e=>e.name.includes("brand_app_versions"))}];return{permissions:n,permissionsGroup:a}}const W=z(i.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),J=z(i.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Y=z(i.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function Z(s){return E("MuiCheckbox",s)}const w=_("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ee=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],se=s=>{const{classes:t,indeterminate:n,color:a,size:e}=s,l={root:["root",n&&"indeterminate",`color${k(a)}`,`size${k(e)}`]},u=O(l,Z,t);return x({},t,u)},ne=M(q,{shouldForwardProp:s=>D(s)||s==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[t.root,n.indeterminate&&t.indeterminate,t[`size${k(n.size)}`],n.color!=="default"&&t[`color${k(n.color)}`]]}})(({theme:s,ownerState:t})=>x({color:(s.vars||s).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:s.vars?`rgba(${t.color==="default"?s.vars.palette.action.activeChannel:s.vars.palette[t.color].mainChannel} / ${s.vars.palette.action.hoverOpacity})`:V.alpha(t.color==="default"?s.palette.action.active:s.palette[t.color].main,s.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${w.checked}, &.${w.indeterminate}`]:{color:(s.vars||s).palette[t.color].main},[`&.${w.disabled}`]:{color:(s.vars||s).palette.action.disabled}})),ie=i.jsx(J,{}),oe=i.jsx(W,{}),te=i.jsx(Y,{}),B=h.forwardRef(function(t,n){var a,e;const l=T({props:t,name:"MuiCheckbox"}),{checkedIcon:u=ie,color:m="primary",icon:f=oe,indeterminate:p=!1,indeterminateIcon:v=te,inputProps:g,size:d="medium",className:b}=l,y=$(l,ee),C=p?v:f,o=p?v:u,r=x({},l,{color:m,indeterminate:p,size:d}),c=se(r);return i.jsx(ne,x({type:"checkbox",inputProps:x({"data-indeterminate":p},g),icon:h.cloneElement(C,{fontSize:(a=C.props.fontSize)!=null?a:d}),checkedIcon:h.cloneElement(o,{fontSize:(e=o.props.fontSize)!=null?e:d}),ownerState:r,ref:n,className:R(c.root,b)},y,{classes:c}))}),xe=()=>{const s=F(),{hasEnabled:t}=A(),n=L().state,a=X(),e=a!=null&&a.id?"update":"store",[l,u]=h.useState(n||""),[m,f]=h.useState([]);S({queryKey:["roleAndPermissionApi.role",a.id],queryFn:()=>j.role(Number(a.id)).then(o=>o.data),enabled:!!(e==="update"&&t("v1.roles.show")),onSuccess:o=>{f(o.context)}});const{mutate:p,isLoading:v}=G({mutationFn:o=>e==="update"?j.roleUpdate(Number(a.id),o):j.roleCreate(o),onSuccess:()=>{N.open({title:"Thành công",type:"success"}),setTimeout(()=>s(-1),1e3)},onError:()=>N.open({title:"Có lỗi xảy ra",type:"error"})}),{permissionsGroup:g}=Q(),d=o=>{Array.isArray(o)?o.forEach(r=>b(r)):b(o)},b=o=>{f(r=>{let c=[...r];return r.findIndex(P=>P.id===o.id)<0?c=[...c,o]:c=c.filter(P=>P.id!==o.id),c})},y=o=>o.filter(r=>m.map(c=>c.name).includes(r.name)).length===o.length,C=()=>{if(l.trim()==="")return N.open({title:"Vui lòng nhập tên",type:"warning"});p({name:n===l?void 0:l,permissions_id:m.map(o=>o.id)})};return i.jsx(H,{permissions:e==="store"?["v1.roles.store"]:["v1.roles.show","v1.roles.patch"],showEmpty:!0,children:i.jsxs("div",{children:[i.jsx(U,{title:e==="store"?"Thêm mới":"Cập nhật"}),i.jsxs("div",{className:"card p-6",children:[i.jsx("div",{className:"flex-row-sp input-wrap w-50",children:i.jsxs("div",{className:"wrap-item mb-4 w-100",children:[i.jsx("label",{className:"form-label fw-bold",children:"Tên quyền"}),i.jsx("input",{onChange:o=>u(o.target.value),value:l,name:"priority",className:"form-control form-control-solid w-100",placeholder:"Tên quyền"})]})}),i.jsx("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:i.jsx("div",{className:"w-100",children:g.map(o=>i.jsxs("div",{className:"mb-4",children:[i.jsx("span",{className:"fw-bold",children:o.desc}),i.jsxs("div",{className:"w-100 d-flex",children:[i.jsx("div",{style:{width:"14.2%",cursor:"pointer"},onClick:()=>{y(o.permissions)?d(o.permissions):d(o.permissions.filter(r=>!m.map(c=>c.name).includes(r.name)))},children:i.jsx(I,{title:"all",placement:"top",arrow:!0,children:i.jsxs("div",{children:[i.jsx(B,{readOnly:!0,checked:y(o.permissions)}),i.jsx("span",{children:"Tất cả"})]})})}),re(o.permissions).map(r=>i.jsx("div",{style:{width:"14.2%",cursor:"pointer"},onClick:()=>d(r),children:i.jsx(I,{title:r.name,placement:"top",arrow:!0,children:i.jsxs("div",{children:[i.jsx(B,{readOnly:!0,checked:!!m.find(c=>c.id===r.id)}),i.jsx(ae,{name:r.name})]})})},r.id))]})]},o.name))})}),i.jsx("div",{className:"d-flex justify-content-end",children:i.jsx(K,{onClick:C,loading:v,title:e==="store"?"Thêm mới":"Cập nhật",color:"success"})})]})]})})},re=s=>["index","show","store","update","patch","destroy","sendNotification"].map(n=>s.find(e=>e.name.includes(n))).filter(Boolean),ae=({name:s})=>{const t=()=>{let n="";return s.includes("index")&&(n="Danh sách"),s.includes("show")&&(n="Chi tiết"),(s.includes("store")||s.includes("sendNotification"))&&(n="Tạo mới"),(s.includes("patch")||s.includes("update"))&&(n="Cập nhật"),s.includes("destroy")&&(n="Xóa"),n};return i.jsx("span",{children:t()})};export{xe as default};
