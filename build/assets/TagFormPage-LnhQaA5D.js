import{j as e,ay as w,an as E,ao as S,ae as _,a as T,V as k,ax as N,aw as m,z as I,s as M,v as Y,a9 as A,az as D,at as y,aA as V,aB as F,aC as P,au as R,as as G,K as H,Q as L,av as O,aD as C,aE as $}from"./index-CPKrhu4T.js";import{u as q}from"./usePostMedia-aQ_2SAoz.js";import"./mediaApi-D174rjEa.js";const K=t=>{const{types:u,value:n,onUpdated:i,mediaType:h="IMAGE",className:x=""}=t,g=!n||n=="",{isLoading:r,handlePostMedia:c}=q(),j=o=>{c({e:{target:{files:[o]}},callBack(d){d.length>0&&(i==null||i(d[0]))},version:"myspa",resetOriginalResult:!0})},f=()=>{let o=e.jsx("img",{src:g?S.imgPlaceHolder:n,alt:"",className:"image-value"});return h=="VIDEO"&&(o=e.jsx("div",{className:"video-cnt",children:e.jsx("video",{"webkit-playsinline":"webkit-playsinline",muted:!0,controls:!0,className:"video-value",children:e.jsx("source",{type:"video/mp4",src:n})})})),o};return e.jsx(w,{className:"form-input-file",multiple:!1,handleChange:j,name:"file",types:u,children:e.jsxs("div",{className:`form-img ${x}`,style:t.style,children:[f(),r&&e.jsx("div",{className:"load-cnt",children:e.jsx(E,{})}),g&&e.jsx("div",{className:"placeholder-cnt",children:"Kéo thả hình ảnh vào đây hoặc Click để chọn hình ảnh"})]})})},z=["ORGANIZATION","SERVICE"],B=(t,u)=>L({queryKey:[$.GmupTagId,t],queryFn:()=>m({version:"v4"}).get(`/tags/${t}`,{params:{include:"media|children|children.media"}}).then(i=>i.data),enabled:!!t,...u}),Z=()=>{const t=_().id,u=t?"EDIT":"CREATE",[n,i]=T.useState([]),h=k({mutationFn:async a=>{const s=u=="CREATE"?await m({version:"v4"}).post("/tags",a).then(l=>l.data):await m({version:"v4"}).put(`/tags/${t}`,a).then(l=>l.data);return s.context.id&&await Promise.all(n.map(async l=>{l.id?m({version:"v4"}).put(`/tags/${l.id}`,Object.assign(l,{parent_id:s.context.id})):m({version:"v4"}).post("/tags",Object.assign(l,{parent_id:s.context.id}))})),s},onSuccess:()=>N.open({title:"Lưu thành công",type:"success"}),onError:()=>N.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"})});B(t,{onSuccess:a=>{const s=a.context;s&&(r("name",s.name),r("group",s.group),r("priority",s.priority),r("status",s.status),i(s.children),s.media.length>0&&r("original_url",s.media[0].original_url))}});const{handleChange:x,handleSubmit:g,setFieldValue:r,values:c,errors:j,touched:f}=I({initialValues:{name:"",group:"",parent_id:"",priority:"",media_id:null,original_url:"",status:!0},validationSchema:M({name:Y().trim().required("Vui lòng nhập nội dung")}),onSubmit:a=>{h.mutate(a)}}),o=()=>{i(a=>[...a,{name:"",priority:0,group:"SERVICE",parent_id:null,status:!0,children:[],created_at:C().format("YYYY-DD-MM HH:mm:ss"),updated_at:C().format("YYYY-DD-MM HH:mm:ss"),deleted_at:null,media:[]}])},v=(a,s)=>{O.open({callBack:()=>{i(l=>l.filter((b,p)=>p!==a)),s&&m({version:"v4"}).delete(`/tags/${s}`)}})},d=(a,s,l)=>{i(b=>{const p=[...b];return p[a]={...p[a],[s]:l},p})};return e.jsxs("div",{className:"card p-4",children:[e.jsx(A,{title:"Tag form"}),e.jsxs("form",{className:"discount-form mb-10 container",onSubmit:g,autoComplete:"off",children:[e.jsxs("div",{className:"col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tag icon"}),e.jsx(K,{types:D,value:c.original_url,onUpdated:a=>{r("media_id",a.model_id),r("original_url",a.original_url)}})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Trạng thái"}),e.jsx(y,{label:"",value:c.status,onChange:a=>r("status",a.target.checked)})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:x,value:c.priority,type:"number",className:"form-control",name:"priority"})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tên"}),e.jsx("input",{onChange:x,value:c.name,className:"form-control",name:"name"}),j.name&&f.name&&e.jsx("span",{className:"text-danger d-block mt-2",children:j.name})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Group"}),e.jsx(V,{sx:{m:1},size:"small",children:e.jsx(F,{labelId:"demo-select-small-label",id:"demo-select-small",value:c.group,onChange:x,name:"group",children:z.map(a=>e.jsx(P,{value:a,children:a},a))})})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-dark fw-bold fs-6",children:"Subtag"}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tag"}),e.jsx("th",{className:"min-w-140px",children:"Độ ưu tiên"}),e.jsx("th",{className:"min-w-140px",children:"Status"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:n==null?void 0:n.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("input",{value:a.name,onChange:l=>d(s,"name",l.target.value),className:"form-control"})})}),e.jsx("td",{children:e.jsx("input",{value:a.priority,onChange:l=>d(s,"priority",l.target.value),type:"number",className:"form-control"})}),e.jsx("td",{children:e.jsx(y,{label:"",value:a.status,onChange:l=>d(s,"status",l.target.checked)})}),e.jsx("td",{className:"text-end",children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semobold",children:R(a.created_at,"DD/MM/YYYY HH:mm")})})})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-end flex-shrink-0 tb-control",children:e.jsx(G,{permissions:["v4.tags.destroy"],children:e.jsx("button",{onClick:()=>v(s,a.id),"aria-label":"Xóa",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",type:"button",children:e.jsx(H,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})})})]},s))})]}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{onClick:o,type:"button",className:"btn btn-primary btn-sm",children:"Thêm subtag"})})]})})]}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{className:"btn btn-success",type:"submit",disabled:h.isLoading,children:h.isLoading?"Đang lưu...":"Lưu"})})]})]})};export{Z as default};
