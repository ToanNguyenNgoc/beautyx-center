import{ad as _,aE as g,V as b,ax as p,z as j,s as v,v as N,j as e,at as y,a8 as T,au as E,ay as z,aF as S,aG as C,Q as F,aD as I}from"./index-CzmKoHlB.js";import{T as m}from"./trendApi-PwmRLoL6.js";import{S as w}from"./index-B_8brmcQ.js";import{S as D}from"./index-BS0OLd9Y.js";import{F as x}from"./FileUpload-DlsSWbDR.js";import"./axios.instance-OVZfMgf7.js";import"./Chip-CPKVIjen.js";import"./Avatar-DB29V3e2.js";import"./discounts-DJL2REOx.js";import"./index-Q9bSjWuR.js";import"./usePostMedia-Cb7DMsAe.js";import"./mediaApi-DTFkxSOG.js";const P=(l,n)=>F({queryKey:[I.TrendId],queryFn:()=>m.getById(Number(l),{include:"organization|productables|discounts",append:"media_url|media_thumbnail_url"}),enabled:!!l,...n}),B=()=>{const l=_().id,{isBeautyxSite:n}=g(),r=l?"EDIT":"CREATE";P(l,{onSuccess:a=>{const t=a.context;t&&(i("title",t.title),i("content",t.content),i("media_url",t.media_url),i("media_thumbnail_url",t.media_thumbnail_url),i("organization_id",t.organization_id),i("organization",t.organization),i("discounts",t.discounts),i("status",t.status),i("priority",t.priority))}});const d=b({mutationFn:a=>r=="EDIT"?m.update(Number(l),a):m.post(a),onSuccess:()=>p.open({title:"Lưu thành công",type:"success"}),onError:()=>p.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"})}),{handleChange:c,handleSubmit:h,setFieldValue:i,values:s,errors:o,touched:u}=j({initialValues:{title:"",content:"",media_id:void 0,media_url:void 0,media_thumbnail_id:void 0,media_thumbnail_url:void 0,organization:null,discounts:[],status:!0,priority:0},validationSchema:v({title:N().trim().required("Vui lòng nhập nội dung")}),onSubmit:a=>{d.mutate({...a,discounts:a.discounts.map(t=>t.id)})}}),f=a=>{(a==null?void 0:a.id)!==s.organization_id&&(i("organization_id",a==null?void 0:a.id),i("organization",a),i("discounts",[]))};return e.jsx(y,{permissions:r=="EDIT"?["v1.trends.update"]:["v1.trends.store"],showEmpty:!0,children:e.jsxs("div",{className:"card p-4",children:[e.jsx(T,{title:"Trend form"}),e.jsxs("form",{className:"discount-form mb-10 container",autoComplete:"off",onSubmit:h,children:[e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Trạng thái"}),e.jsx(E,{label:"",value:s.status,onChange:a=>i("status",a.target.checked)})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:c,value:s.priority,type:"number",className:"form-control",name:"priority"})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Thumbnail"}),e.jsx(x,{style:{width:200,aspectRatio:9/16,height:"unset"},types:z,value:s.media_thumbnail_url,onUpdated:a=>{i("media_thumbnail_id",a.model_id),i("media_thumbnail_url",a.original_url)}})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Video"}),e.jsx(x,{style:{width:200,aspectRatio:9/16,height:"unset"},mediaType:"VIDEO",types:S,value:s.media_url,onUpdated:a=>{i("media_id",a.model_id),i("media_url",a.original_url)}})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tiêu đề"}),e.jsx("input",{onChange:c,value:s.title,className:"form-control",name:"title"}),o.title&&u.title&&e.jsx("span",{className:"text-danger d-block mt-2",children:o.title})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Nội dung"}),e.jsx("input",{onChange:c,value:s.content,className:"form-control",name:"content"}),o.content&&u.content&&e.jsx("span",{className:"text-danger d-block mt-2",children:o.content})]})]}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(w,{organization_id:s.organization_id,origin:s.organization,setOrigin:a=>f(a)})}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(D,{label:n?void 0:"Gắn dịch vụ GMUP",organization_id:s.organization_id,platform:n?void 0:C.GMUP,filterAll:!1,discounts:s.discounts,onChangeDiscounts:a=>i("discounts",a)})}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{className:"btn btn-success",type:"submit",disabled:d.isLoading,children:d.isLoading?"Đang lưu...":"Lưu"})})]})]})})};export{B as default};
