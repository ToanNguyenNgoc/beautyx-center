import{ad as f,aE as g,V as b,ax as u,z as j,s as v,v as N,j as e,at as y,a8 as T,au as z,az as E,aF as S,aG as F,Q as I,ay as C}from"./index-BuiS39ZH.js";import{T as r}from"./trendApi-DF3XcaFe.js";import{S as w}from"./index-Ul-anvHC.js";import{S as P}from"./index-CCUeMqv_.js";import{F as x}from"./FileUpload-4sQkN33v.js";import"./axios.instance-Dl_stjmW.js";import"./Chip-B5qCQMpp.js";import"./Avatar-ZghSeTi1.js";import"./discounts--DetIpQu.js";import"./index-DGoIgz2e.js";import"./usePostMedia-80tRsVQE.js";import"./mediaApi-DApCnjp1.js";const D=(n,l)=>I({queryKey:[C.TrendId],queryFn:()=>r.getById(Number(n),{include:"organization|productables|discounts",append:"media_url|media_thumbnail_url"}),enabled:!!n,...l}),B=()=>{const n=f().id,{isBeautyxSite:l}=g(),d=n?"EDIT":"CREATE";D(n,{onSuccess:a=>{const i=a.context;i&&(t("title",i.title),t("content",i.content),t("media_url",i.media_url),t("media_thumbnail_url",i.media_thumbnail_url),t("organization_id",i.organization_id),t("organization",i.organization),t("discounts",i.discounts),t("status",i.status))}});const p=b({mutationFn:a=>d=="EDIT"?r.update(Number(n),a):r.post(a),onSuccess:()=>u.open({title:"Lưu thành công",type:"success"}),onError:()=>u.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"})}),{handleChange:c,handleSubmit:h,setFieldValue:t,values:s,errors:o,touched:m}=j({initialValues:{title:"",content:"",media_id:void 0,media_url:void 0,media_thumbnail_id:void 0,media_thumbnail_url:void 0,organization:null,discounts:[],status:!0},validationSchema:v({title:N().trim().required("Vui lòng nhập nội dung")}),onSubmit:a=>{p.mutate({...a,discounts:a.discounts.map(i=>i.id)})}}),_=a=>{(a==null?void 0:a.id)!==s.organization_id&&(t("organization_id",a==null?void 0:a.id),t("organization",a),t("discounts",[]))};return e.jsx(y,{permissions:d=="EDIT"?["v1.trends.update"]:["v1.trends.store"],showEmpty:!0,children:e.jsxs("div",{className:"card p-4",children:[e.jsx(T,{title:"Trend form"}),e.jsxs("form",{className:"discount-form mb-10 container",autoComplete:"off",onSubmit:h,children:[e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Trạng thái"}),e.jsx(z,{label:"",value:s.status,onChange:a=>t("status",a.target.checked)})]})}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Thumbnail"}),e.jsx(x,{style:{width:200,aspectRatio:9/16,height:"unset"},types:E,value:s.media_thumbnail_url,onUpdated:a=>{t("media_thumbnail_id",a.model_id),t("media_thumbnail_url",a.original_url)}})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Video"}),e.jsx(x,{style:{width:200,aspectRatio:9/16,height:"unset"},mediaType:"VIDEO",types:S,value:s.media_url,onUpdated:a=>{t("media_id",a.model_id),t("media_url",a.original_url)}})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tiêu đề"}),e.jsx("input",{onChange:c,value:s.title,className:"form-control",name:"title"}),o.title&&m.title&&e.jsx("span",{className:"text-danger d-block mt-2",children:o.title})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Nội dung"}),e.jsx("input",{onChange:c,value:s.content,className:"form-control",name:"content"}),o.content&&m.content&&e.jsx("span",{className:"text-danger d-block mt-2",children:o.content})]})]}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(w,{organization_id:s.organization_id,origin:s.organization,setOrigin:a=>_(a)})}),e.jsx("div",{className:"col-12 d-flex gap-4 mt-6",children:e.jsx(P,{label:l?void 0:"Gắn dịch vụ GMUP",organization_id:s.organization_id,platform:l?void 0:F.GMUP,filterAll:!1,discounts:s.discounts,onChangeDiscounts:a=>t("discounts",a)})}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{className:"btn btn-success",type:"submit",disabled:!1,children:"Lưu"})})]})]})})};export{B as default};
