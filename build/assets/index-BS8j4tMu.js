import{e as x,a7 as g,bC as d,S as C,W as A,j as e,b1 as m,a8 as P,al as S,am as _,a9 as T,bG as p,bx as D,by as E,bz as b,a as Q,b2 as X,bL as q,K as v,cF as z,ah as h}from"./index-BHl1vF-Z.js";import{a as j}from"./adminApi-CWj4GUWV.js";import{u as y}from"./useGetRolesAndPermissions-Acynabr0.js";import{A as F}from"./Avatar-Ckuqs-6L.js";import{C as f}from"./Chip-DrXhVjId.js";function M(){const s=x(),i=g(),{hasEnabled:o}=y(),a=d.parse(s.search),{data:t,isLoading:l,refetch:c}=C({queryKey:[a],queryFn:()=>j.adminUsers({page:a.page,limit:15,"filter[keyword]":a["filter[keyword]"],include:"roles","filter[roles_count]":a["filter[roles_count]"]==="all"?void 0:!0,sort:"-created_at"}).then(n=>n.data),enabled:o("v1.admin.users.index")}),r=(t==null?void 0:t.context.data)||[],N=n=>{const u={...a,page:n};i({pathname:s.pathname,search:d.stringify(u)})},{mutate:w}=A({mutationFn:n=>j.adminUserDelete(n),onSuccess:()=>{p.open({title:"Xóa thành công",type:"success"}),c()},onError:()=>p.open({title:"Có lỗi xảy ra",type:"error"})}),k=n=>{z.open({message:"Xóa tài khoản",callBack:()=>w(n)})};return e.jsxs(m,{permissions:["v1.admin.users.index"],showEmpty:!0,children:[e.jsx(P,{element:e.jsx(m,{permissions:["v1.admin.users.store"],children:e.jsx(S,{onClick:()=>i("/pages/accounts-form"),variant:"contained",size:"large",children:"Tạo mới"})}),title:"Danh sách"}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsx("div",{className:"w-50",children:e.jsx(B,{})})}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Thông tin "}),e.jsx("th",{className:"min-w-140px",children:"Số điện thoại"}),e.jsx("th",{className:"min-w-140px",children:"Quyền"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-120px",children:"Trạng thái"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(n=>e.jsx(K,{item:n,onDeleteAccount:u=>k(u)},n.id))})]}),e.jsx(_,{loading:l}),e.jsx(T,{totalPage:(t==null?void 0:t.context.last_page)??1,onChangePage:N,defaultPage:a.page??1})]})})]})]})}const K=({item:s,onDeleteAccount:i=()=>null})=>{const o=g(),{hasEnabled:a}=y(),[t,l]=Q.useState(s.is_active===1),c=r=>{l(r),j.adminUserUpdate(s.id,{is_active:r}).then(()=>{p.open({title:"Cập nhật thành công",type:"success"})})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx(F,{src:s.avatar||s.fullname,alt:s.fullname})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold fs-6",children:s.fullname}),e.jsx("span",{className:"fw-semobold text-muted d-block fs-7",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("a",{href:`tel:${s.telephone}`,className:"text-dark fw-bold text-hover-primary d-block fs-6",children:s.telephone})}),e.jsx("td",{children:s.roles.length>0?s.roles.map(r=>e.jsx(f,{label:r.name,color:"success",size:"small",onDelete:a("v1.admin.users.update")?()=>console.log("OK"):void 0},r.id)):e.jsx(f,{size:"small",color:"primary",label:"Khách"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:X(s.created_at)})}),e.jsx(m,{permissions:["v1.admin.users.update"],children:e.jsx("td",{children:e.jsx(q,{label:"",value:t,onChange:r=>c(r.target.checked)})})}),e.jsxs("td",{className:"d-flex justify-content-end",children:[e.jsx(m,{permissions:["v1.admin.users.show","v1.admin.users.update"],children:e.jsx("button",{onClick:()=>o(`/pages/accounts-form/${s.id}`),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(v,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),e.jsx(m,{permissions:["v1.admin.users.destroy"],children:e.jsx("button",{onClick:()=>i(s.id),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(v,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})]},s.id)},B=()=>{const s=d.parse(x().search),i=g(),o=x(),a=l=>{const c=Object.assign(s,{"filter[keyword]":l,page:1});i({pathname:o.pathname,search:d.stringify(h.pickBy(c,h.identity))},{replace:!0})},t=l=>{const c=Object.assign(s,{"filter[roles_count]":l.target.value,page:1});i({pathname:o.pathname,search:d.stringify(h.pickBy(c,h.identity))},{replace:!0})};return e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"search w-75",children:e.jsx("input",{onChange:l=>a(l.target.value),type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm Tên, email, phone..."})}),e.jsx("div",{children:e.jsx(D,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(E,{labelId:"demo-select-small-label",id:"demo-select-small",value:s["filter[roles_count]"]??"true",onChange:t,children:[e.jsx(b,{value:"true",children:"Quản trị"}),e.jsx(b,{value:"all",children:e.jsx("em",{children:"Tất cả"})})]})})})]})};export{M as default};
