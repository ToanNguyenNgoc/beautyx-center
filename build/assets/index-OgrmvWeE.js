import{e as y,a8 as _,ar as p,Q as D,j as e,a9 as S,as as j,al as C,aa as A,a as g,aA as b,aB as N,bE as F,aC as w,bY as E,aD as v,V as R,au as T,at as P,L,K as Y,aF as u,cp as k,c0 as M,c1 as Q,c2 as B,cq as H,a7 as I,ax as X,aE as K}from"./index-B-8ZwVwN.js";import{u as O,A as U}from"./index-CofMJZIV.js";import{F as W}from"./index-CYPFytSd.js";import{L as z}from"./LoadingButton-CddcXNEg.js";import{A as V}from"./Avatar-Kn6OQjuO.js";function ne(){const s=y(),o=_(),t=p.parse(s.search),{data:n,isLoading:l}=D({queryKey:[K.CUSTOMER,t],queryFn:()=>k.customers({page:t.page,limit:15,platform:t.platform,sort:t.sort||"-created_at",from_date:t.from_date,to_date:t.to_date}),staleTime:0}),c=(n==null?void 0:n.data)||[],m=r=>{const d={...t,page:r};o({pathname:s.pathname,search:p.stringify(d)})};return e.jsxs(e.Fragment,{children:[e.jsx(S,{title:"Danh sách khách hàng"}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Customer Statistics"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:["Số lượng:",n==null?void 0:n.total," members"]})]})}),e.jsx(G,{query:t}),e.jsx("div",{className:"d-flex justify-content-end px-12",children:n&&e.jsx(J,{data:n,qr:t})}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Thông tin khách hàng"}),e.jsx("th",{className:"min-w-140px",children:"Số điện thoại"}),e.jsx("th",{className:"min-w-140px",children:"Nền tảng"}),e.jsx("th",{className:"min-w-120px",children:"Ngày đăng ký"}),e.jsx(j,{permissions:["v1.admin.users.update"],children:e.jsx("th",{className:"min-w-120px",children:"Trạng thái"})}),e.jsx(j,{permissions:["v1.admin.users.show","v1.admin.users.update"],children:e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})})]})}),e.jsx("tbody",{children:c.map(r=>e.jsx($,{item:r},r.id))})]}),e.jsx(C,{loading:l}),e.jsx(A,{totalPage:(n==null?void 0:n.last_page)??1,onChangePage:m,defaultPage:t.page??1})]})})]})]})}const $=({item:s})=>{const[o,t]=g.useState(s.is_active===1),n=l=>{t(l),I.Admin.adminUserUpdate(s.id,{is_active:l}).then(()=>{X.open({title:"Cập nhật thành công",type:"success"})})};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx(V,{src:s.avatar||s.fullname,alt:s.fullname})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold fs-6",children:s.fullname}),e.jsx("span",{className:"fw-semobold text-muted d-block fs-7",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("a",{href:`tel:${s.telephone}`,className:"text-dark fw-bold text-hover-primary d-block fs-6",children:s.telephone})}),e.jsx("td",{children:e.jsx(W,{platForm:s.platform})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:T(s.created_at)})}),e.jsx(j,{permissions:["v1.admin.users.update"],children:e.jsx("td",{children:e.jsx(P,{label:"",value:o,onChange:l=>n(l.target.checked)})})}),e.jsx(j,{permissions:["v1.admin.users.show","v1.admin.users.update"],children:e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-end flex-shrink-0",children:e.jsx(L,{to:`/pages/customers-form/${s.id}`,className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(Y,{path:"/media/icons/duotune/general/gen019.svg",className:"svg-icon-3"})})})})})]})},G=({query:s})=>{const o=y(),t=_(),n=[{sort:"-created_at",title:"Ngày đăng ký mới"},{sort:"created_at",title:"Ngày đăng ký cũ"}],[l,c]=g.useState({form:s.from_date,to:s.to_date}),m=a=>{const h={...s,page:1,platform:a.target.value!==""?a.target.value:""};t({pathname:o.pathname,search:p.stringify(u.pickBy(h,u.identity))})},r=a=>{const h={...s,sort:a.target.value,page:1};t({pathname:o.pathname,search:p.stringify(h)})},d=()=>{const a={...s,page:1,from_date:l.form,to_date:l.to};t({pathname:o.pathname,search:p.stringify(a)})},f=()=>{const a={...s,page:1,from_date:void 0,to_date:void 0};c({form:void 0,to:void 0}),t({pathname:o.pathname,search:p.stringify(u.pickBy(a,u.identity))})};return e.jsxs("div",{className:"d-flex justify-content-between filter-cnt",children:[e.jsxs("div",{children:[e.jsx("label",{className:"filter-row_label",children:"Tìm kiếm"}),e.jsx("input",{className:"form-control form-control-solid py-2 px-6",placeholder:"Tìm kiếm"})]}),e.jsxs("div",{className:"filter-right",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Nền tảng"}),e.jsx(b,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(N,{labelId:"demo-select-small-label",id:"demo-select-small",value:s.platform??"",onChange:m,children:[e.jsx(w,{value:"",children:e.jsx("em",{children:"Tất cả"})}),F.map(a=>e.jsx(w,{value:a,children:a},a))]})})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Sắp xếp theo"}),e.jsx(b,{sx:{m:1,minWidth:150},size:"small",children:e.jsx(N,{labelId:"demo-select-small-label",id:"demo-select-small",value:s.sort??n[0].sort,onChange:r,children:n.map(a=>e.jsx(w,{value:a.sort,children:a.title},a.sort))})})]})]}),e.jsx("div",{className:"filter-row_picker",children:e.jsx(E,{showBot:!0,init:!l.form||!l.to,startDate:l.form?new Date(l.form):new Date,endDate:l.to?new Date(l.to):new Date,label:"Thời gian đăng ký",onChange:a=>c({form:v(a.selection.startDate).format("YYYY-MM-DD HH:mm:ss"),to:v(a.selection.endDate).format("YYYY-MM-DD HH:mm:ss")}),onApply:d,onCancel:f})})]})]})},J=({data:s,qr:o})=>{const[t,n]=g.useState([]),{resultLoad:l,noti:c,onCloseNoti:m}=O(),[r,d]=g.useState(!1),{mutate:f,isLoading:a}=R({mutationFn:i=>k.customers({...o,page:i,limit:15}),onSuccess:i=>n(x=>[...x,...i.data])}),h=()=>{if(s.data.length===0)return;if(!o.from_date||!o.to_date)return l({message:"Vui lòng chọn khoảng thời gian",color:"warning"});if(H(o.from_date?new Date(o.from_date):new Date,o.to_date?new Date(o.to_date):new Date).length>31)return l({message:"Xuất danh sách tối đa trong 30 ngày",color:"warning"});d(!0);for(var x=1;x<=(s==null?void 0:s.last_page);x++)f(x)};return g.useEffect(()=>{r&&t.length>0&&t.length===(s==null?void 0:s.total)&&Z(t).then(()=>{l({message:"Xuất File thành công",color:"success"}),n([]),d(!1)}),t.length===(s==null?void 0:s.total)&&n([])},[t,s==null?void 0:s.total]),e.jsxs(e.Fragment,{children:[e.jsx(U,{severity:c.color,message:c.message,open:c.openAlert,close:m}),e.jsxs(z,{color:"success",size:"medium",variant:"contained",onClick:h,type:"button",loading:a,children:[e.jsx("i",{style:{marginRight:"4px",color:"var(--kt-white)"},className:"bi bi-download"}),"Xuất danh sách"]})]})},Z=s=>new Promise((o,t)=>{const n="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",l=".xlsx",m=[["#","ID","Họ và tên","Email","Số điện thoại","Nền tảng","Ngày đăng ký"],...s.map((i,x)=>[x+1,i.id,i.fullname,i.email,i.telephone,i.platform,i.created_at])],r=M.aoa_to_sheet(m),d=[{wch:5},{wch:10},{wch:35},{wch:25},{wch:25},{wch:25},{wch:25}];r["!cols"]=d;const a=Q({Sheets:{data:r},SheetNames:["data"]},{bookType:"xlsx",type:"array"}),h=new Blob([a],{type:n});B.saveAs(h,`ds_khach_hang_${v().format("DDHHmmss")}`+l),o(!0)});export{ne as default};
