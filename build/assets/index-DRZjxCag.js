import{e as E,a7 as T,bC as d,S as C,V as P,W as k,j as e,a8 as I,b1 as f,L as S,b2 as j,bD as L,bE as A,K as g,am as F,a9 as D,a as O,ah as c,bx as b,by as N,bF as M,bz as o,bG as Q,b6 as w}from"./index-BHl1vF-Z.js";import{F as V}from"./index-BS_oHEVL.js";import{a as i,P as Y}from"./platForm-CEzyLLuJ.js";import{d as _}from"./discounts-CUePuapv.js";/* empty css              */import{E as K}from"./export-code-CJM8pBnj.js";import"./LoadingButton-BU6aPnkN.js";function H(){const l=E(),r=T(),t=d.parse(l.search),{data:a,isLoading:m}=C({queryKey:[w.DISCOUNT_PAGE,t],queryFn:()=>_.getAll({page:(t==null?void 0:t.page)??1,limit:15,"filter[keyword]":t["filter[keyword]"],"filter[filter_all]":!0,"filter[platform]":t["filter[platform]"],"filter[discount_type]":t["filter[discount_type]"],sort:t.sort??"-created_at"})}),x=(a==null?void 0:a.data)??[],h=s=>{const n={...t,page:s};r({pathname:l.pathname,search:d.stringify(n)})},p=P(),{mutate:u}=k({mutationFn:s=>_.deleteById(s),onSuccess:()=>{p.invalidateQueries([w.DISCOUNT_PAGE,t])},onError:()=>Q.open({title:"Có lỗi xảy ra",type:"error"})});return e.jsxs(e.Fragment,{children:[e.jsx(I,{element:e.jsx(f,{permissions:["v1.discounts.store"],children:e.jsx(S,{to:{pathname:"/pages/discounts-form"},className:"btn btn-sm btn-primary",style:{marginLeft:12},children:"Tạo mới mã giảm giá"})}),title:"Danh sách Mã giảm giá"}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Mã giảm giá"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:["Số lượng : ",(a==null?void 0:a.total)??1]})]})}),e.jsx(R,{query:t}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tiêu đề"}),e.jsx("th",{className:"min-w-80px",children:"Ưu tiên"}),e.jsx("th",{className:"min-w-150px",children:"Hình thức giảm"}),e.jsx("th",{className:"min-w-150px",children:"Giá giảm"}),e.jsx("th",{className:"min-w-100px",children:"Từ ngày"}),e.jsx("th",{className:"min-w-100px",children:"Đến ngày"}),e.jsx("th",{className:"min-w-100px text-end",children:"Nền tảng"}),e.jsx("th",{className:"min-w-100px text-end",children:"Số lượng mã"}),e.jsx("th",{className:"min-w-150px text-end",children:"Sử dụng/1 khách"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:x.map((s,n)=>{var y,v;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx("img",{src:(v=(y=s.items[0])==null?void 0:y.productable)==null?void 0:v.image_url,alt:""})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary fs-6",children:s.title}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:j(s.created_at)})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark text-center fw-bold d-block mb-1 fs-7",children:s.priority})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx(L,{TYPE:s.discount_type})})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column w-100 me-2",children:[A(s.discount_value||0),s.discount_type==="PERCENT"?"%":"đ"]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:j(s.valid_from)})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:j(s.valid_util)})}),e.jsx("td",{children:e.jsx(V,{platForm:s.platform})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:s.total??"Không giới hạn"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted text-end fw-semobold text-muted d-block fs-7",children:s.limit??"Không giới hạn"})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-end flex-shrink-0 tb-control",children:[e.jsx(f,{permissions:["v1.discounts.update"],children:e.jsx("button",{onClick:()=>r(`/pages/discounts-form/${s.uuid}`,{state:s}),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),(s.platform==="SHOPEE"||s.platform==="VINID"||s.platform==="BEAUTYX"||s.platform===i.VIETTEL_MONEY||s.platform===i.LIVWELL||s.platform===i.TAPTAP)&&e.jsx("button",{className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",onClick:()=>r(`/pages/discounts/${s.uuid}`),children:e.jsx(g,{path:"/media/icons/duotune/general/gen019.svg",className:"svg-icon-3"})}),(s.platform==="SHOPEE"||s.platform==="VINID"||s.platform==="BEAUTYX"||s.platform===i.VIETTEL_MONEY||s.platform===i.LIVWELL||s.platform===i.TAPTAP)&&e.jsx(K,{title:"",size:"small",discount:s}),e.jsx(f,{permissions:["v1.discounts.destroy"],children:e.jsx("button",{onClick:()=>u(s.id),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})})]},n)})})]}),e.jsx(F,{loading:m}),e.jsx(D,{totalPage:(a==null?void 0:a.last_page)??1,onChangePage:h,defaultPage:(t==null?void 0:t.page)??1})]})})]})]})}const R=({query:l})=>{const r=[{sort:"-created_at",title:"Ngày tạo"},{sort:"-total",title:"Số lượng mã"},{sort:"-priority",title:"Độ ưu tiên"}],t=T(),a=E(),m=O.useCallback(c.debounce(s=>t(s.trim()===""?`${a.pathname}`:`${a.pathname}?filter[keyword]=${s}`,{replace:!0}),600),[]),x=s=>m(s.target.value),h=s=>{const n={...l,page:1,"filter[platform]":s.target.value!==""?s.target.value:""};t({pathname:a.pathname,search:d.stringify(c.pickBy(n,c.identity))})},p=s=>{const n={...l,page:1,"filter[discount_type]":s.target.value!==""?s.target.value:""};t({pathname:a.pathname,search:d.stringify(c.pickBy(n,c.identity))})},u=s=>{const n={...l,sort:s.target.value};t({pathname:a.pathname,search:d.stringify(n)})};return e.jsxs("div",{className:"d-flex justify-content-between filter-cnt",children:[e.jsxs("div",{children:[e.jsx("label",{className:"filter-row_label",children:"Tìm kiếm"}),e.jsx("input",{type:"text",onChange:x,className:"form-control form-control-solid py-2 px-6",placeholder:"Tiêu đề..."})]}),e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Hình thức giảm giá"}),e.jsx(b,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(N,{labelId:"demo-select-small-label",id:"demo-select-small",value:l["filter[discount_type]"]??"",onChange:p,children:[e.jsx(o,{value:"",children:e.jsx("em",{children:"Tất cả"})}),M.map(s=>e.jsx(o,{value:s.TYPE,children:s.title},s.id))]})})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Nền tảng"}),e.jsx(b,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(N,{labelId:"demo-select-small-label",id:"demo-select-small",value:l["filter[platform]"]??"",onChange:h,children:[e.jsx(o,{value:"",children:e.jsx("em",{children:"Tất cả"})}),Y.map(s=>e.jsx(o,{value:s,children:s},s))]})})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Sắp xếp theo"}),e.jsx(b,{sx:{m:1,minWidth:150},size:"small",children:e.jsx(N,{labelId:"demo-select-small-label",id:"demo-select-small",value:l.sort??r[0].sort,onChange:u,children:r.map(s=>e.jsx(o,{value:s.sort,children:s.title},s.sort))})})]})]})]})};export{H as default};
