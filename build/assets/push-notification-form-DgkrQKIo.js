import{ag as C,Q as k,a as v,j as e,bS as P,aB as b,aD as T,V as q,z as _,s as A,v as j,at as M,a8 as w,aA as E,c3 as I,c4 as d,aG as L,ap as N,an as R,c5 as D,c6 as F}from"./index-CzmKoHlB.js";import{u as G,A as z}from"./index-B8BO5zgp.js";import{S as B}from"./index-B_8brmcQ.js";import{S as Q}from"./index-BS0OLd9Y.js";import{p as V}from"./promotionApi-BAs_Q2-_.js";import{C as Y}from"./Chip-CPKVIjen.js";import{A as y}from"./Avatar-DB29V3e2.js";import{L as $}from"./LoadingButton-CQgDJbfP.js";import"./discounts-DJL2REOx.js";import"./index-Q9bSjWuR.js";const K={post:o=>C.post("/beautyx/notification",o).then(r=>r.data)},U=({required:o,value:r,onChange:m=()=>{}})=>{var u,x;const{data:a}=k({queryKey:[T.PROMOTION],queryFn:()=>V.getAll({limit:15,page:1})}),t=(u=a==null?void 0:a.data)==null?void 0:u.find(s=>s.id===Number(r)),n=v.useRef(null),h=s=>{n.current&&(s==="hide"&&n.current.classList.remove("org-search-show"),s==="show"&&n.current.classList.add("org-search-show"))};return window.addEventListener("click",()=>h("hide")),e.jsxs("div",{className:"col col-org",children:[e.jsx("label",{className:`${o?"required":""} form-label`,children:"Chọn chương trình khuyến mại"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),h("show")},className:"form-control form-control-solid",children:t?e.jsx(Y,{className:"m-1",color:"success",label:t.name,avatar:e.jsx(y,{alt:t.name,src:t.media_url||""}),onDelete:()=>m(void 0)}):"Gắn chương trình khuyến mại"}),e.jsx(P,{ref:n,sx:{boxShadow:3},className:"org-search",children:e.jsx("div",{onClick:s=>s.stopPropagation(),children:e.jsx("div",{className:"org-list",children:e.jsx("ul",{className:"list",children:(x=a==null?void 0:a.data)==null?void 0:x.map(s=>e.jsxs(b,{selected:s.id===Number(t==null?void 0:t.id),onClick:()=>m(s.id),children:[e.jsx(y,{style:{marginRight:"6px"},alt:s.name,src:String(s.media_url)}),e.jsx("div",{className:"col",children:e.jsx("p",{children:s.name})})]},s.id))})})})})]})};function ne(){const{resultLoad:o,noti:r,onCloseNoti:m}=G(),[a,t]=v.useState(),[n,h]=v.useState(),{mutate:u,isLoading:x}=q({mutationFn:i=>D()===F?R.postNotification(i):K.post(i),onSuccess:()=>o({message:"Push thông báo thành công",color:"success"}),onError:i=>{var f;const c=i;o({color:"error",message:`Có lỗi xảy ra. Mã lỗi ${(f=c==null?void 0:c.request)==null?void 0:f.status}`})}}),{values:s,errors:l,handleChange:p,handleSubmit:S,touched:g,setFieldValue:O}=_({initialValues:{title:"",description:"",type:"",link:"",payload_id:""},validationSchema:A({title:j().required("Nhập tiêu đền"),description:j().required("Nhập nội dung"),type:j().required("Chọn loại thông báo cho"),link:j().required("NHập đường dẫn")}),onSubmit:i=>{let c=i.payload_id;Number(i.type)===d.ORG.id&&a&&(c=String(a==null?void 0:a.id)),Number(i.type)===d.DISCOUNT.id&&n&&(c=n.uuid),u({...i,payload_id:c})}});return e.jsxs(M,{permissions:["v1.beautyx.notification.sendNotification"],showEmpty:!0,children:[e.jsx(w,{title:"Thông báo"}),e.jsx(z,{severity:r.color,message:r.message,open:r.openAlert,close:m}),e.jsx("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:e.jsxs("div",{className:"notification-cnt",children:[e.jsxs("form",{onSubmit:S,className:"form-left",children:[e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Tiêu đề"}),e.jsx("input",{value:s.title,onChange:p,type:"text",name:"title",className:"form-control form-control-solid mt-1 mb-4"}),l.title&&g.title&&e.jsx("span",{className:"text-danger",children:l.title})]}),e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Nội dung thông báo"}),e.jsx("input",{value:s.description,onChange:p,type:"text",name:"description",className:"form-control form-control-solid mt-1 mb-4"}),l.description&&g.description&&e.jsx("span",{className:"text-danger",children:l.description})]}),e.jsxs("div",{className:"column mb-4",children:[e.jsx("div",{className:"required form-label",children:"Thông báo cho"}),e.jsx(E,{size:"small",name:"type",value:s.type,onChange:p,children:I.map(i=>e.jsx(b,{value:String(i.id),children:i.title},i.id))}),l.type&&g.type&&e.jsx("span",{className:"text-danger",children:l.type})]}),e.jsxs(e.Fragment,{children:[Number(s.type)===d.ORG.id&&e.jsx("div",{className:"column",children:e.jsx(B,{organization_id:s.payload_id,origin:a,setOrigin:t})}),Number(s.type)===d.PROMOTION.id&&e.jsx("div",{className:"column",children:e.jsx(U,{value:s.payload_id,onChange:i=>O("payload_id",String(i))})}),Number(s.type)===d.DISCOUNT.id&&e.jsx("div",{className:"column",children:e.jsx(Q,{label:"Gắn deal giảm giá",onChangeDiscounts:i=>h(i[i.length-1]),filterAll:!1,platform:L.MOMO,discounts:n?[n]:[]})})]}),e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Đường dẫn"}),e.jsx("input",{value:s.link,onChange:p,type:"text",name:"link",className:"form-control form-control-solid mt-1 mb-4"}),l.link&&g.link&&e.jsx("span",{className:"text-danger",children:l.link})]}),e.jsx("div",{className:"d-flex justify-content-end mt-6",children:e.jsx($,{type:"submit",variant:"contained",color:"success",loading:x,children:"Push thông báo"})})]}),e.jsxs("div",{className:"preview-right",children:[e.jsx("span",{className:"title",children:"Giao diện thông báo"}),e.jsx("div",{className:"device-cnt",children:e.jsxs("div",{className:"device",children:[e.jsx("img",{className:"device-img",src:N.android,alt:""}),e.jsx("div",{className:"device-noti",children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:N.beautyxIcon,alt:""})}),e.jsxs("div",{className:"item-right",children:[e.jsx("p",{className:"item-right-title",children:s.title}),e.jsx("p",{className:"item-right-content",children:s.description})]})]})})]})}),e.jsx("div",{className:"device-cnt",children:e.jsxs("div",{className:"device",children:[e.jsx("img",{className:"device-img",src:N.iphone,alt:""}),e.jsx("div",{className:"device-noti",style:{marginTop:"50px"},children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:N.beautyxIcon,alt:""})}),e.jsxs("div",{className:"item-right",children:[e.jsx("p",{className:"item-right-title",children:s.title}),e.jsx("p",{className:"item-right-content",children:s.description})]})]})})]})})]})]})})]})}export{ne as default};
