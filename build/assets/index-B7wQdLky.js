import{e as _,a8 as C,ar as g,Q as F,j as e,a9 as A,bN as T,bM as S,al as I,aa as P,aA as k,ci as G,aB as E,aC as f,a as j,aF as u,ct as O,ab as R,as as v,at as N,bS as B,co as U,L as z,ad as Q,V as W,bR as y,aD as w,b_ as X,b$ as Y,c0 as q}from"./index-Cy0ECsl2.js";import{u as D,A as L}from"./index-C6-fCKLr.js";import{u as $}from"./useDebounce-OQ4ofxRu.js";import{u as H}from"./useGetGmupTags-BPtquD60.js";import{C as V}from"./Chip-C0m7jgAX.js";import{L as K}from"./LoadingButton-BnUDQfN1.js";function re(){var m;const t=_(),a=C(),{gmupTags:c}=H({limit:50,"filter[status]":!0}),n=$(g.parse(t.search),800),{data:l,isLoading:o}=F({queryKey:["ORG",n],queryFn:()=>y.getAll({page:n.page||1,limit:30,is_ecommerce:n.is_ecommerce||"",keyword:n.search,sort:"-created_at"}).then(r=>r.data.context)}),i=r=>{const x={...n,page:r};a({pathname:t.pathname,search:g.stringify(x)})};return e.jsxs(e.Fragment,{children:[e.jsx(A,{title:"Danh sách doanh nghiệp"}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Danh sách doanh nghiệp"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:[l==null?void 0:l.total," doanh nghiệp"]})]})}),e.jsx(J,{data:l}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted bg-light",children:[e.jsx("th",{className:"ps-4 min-w-300px rounded-start",children:"Thông tin"}),e.jsx("th",{className:"min-w-125px",children:"Liên lạc"}),e.jsx("th",{className:"min-w-100px",children:"Trạng thái TMDT"}),e.jsx("th",{className:"min-w-100px",children:"Trạng thái GMUP"}),e.jsx(T,{site:S.GMUP,children:e.jsx("th",{className:"min-w-300px",children:"Tag GMUP"})}),e.jsx("th",{className:"min-w-150px text-end rounded-end"})]})}),e.jsx("tbody",{children:(m=l==null?void 0:l.data)==null?void 0:m.map((r,x)=>e.jsx(Z,{org:r,gmupTags:c},x))})]}),e.jsx(I,{loading:o}),e.jsx(P,{totalPage:(l==null?void 0:l.last_page)??1,onChangePage:i,defaultPage:(n==null?void 0:n.page)??1})]})})]})]})}const Z=({org:t,gmupTags:a=[]})=>{var h,d;const c={is_momo_ecommerce_enable:t.is_momo_ecommerce_enable,is_gmup_enable:t.is_gmup_enable,gmup_tag_ids:(h=t==null?void 0:t.gmup_tags)==null?void 0:h.map(s=>s.id)},[n,l]=j.useState(c),{resultLoad:o,noti:i,onCloseNoti:m}=D(),r=(s,b)=>{l(M=>({...M,[s]:b})),y.updateECommerce(t.id,{[s]:b}).then(()=>{o({message:"Cập nhật thành công",color:"success"})}).catch(()=>{l(c),o({message:"Có lỗi xảy ra",color:"error"})})},x=s=>{l(b=>({...b,gmup_tag_ids:s})),p(s)},p=j.useCallback(u.debounce(s=>r("gmup_tag_ids",s),1e3),[]);return e.jsxs(e.Fragment,{children:[e.jsx(L,{severity:i.color,message:i.message,open:i.openAlert,close:m}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",style:{cursor:"pointer"},onClick:()=>O(t),children:[e.jsx("div",{className:"symbol symbol-50px me-5",children:e.jsx(R,{src:t.image_url})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary mb-1 fs-6",children:t.name}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:t.full_address})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-7",children:(d=t.telephone)==null?void 0:d.join(", ")})}),e.jsx("td",{children:e.jsx(v,{permissions:["v1.organizations.updateECommerce"],children:e.jsx(N,{label:"",value:n.is_momo_ecommerce_enable,onChange:s=>r("is_momo_ecommerce_enable",s.target.checked)})})}),e.jsx("td",{children:e.jsx(v,{permissions:["v1.organizations.updateECommerce"],children:e.jsx(N,{label:"",value:n.is_gmup_enable,onChange:s=>r("is_gmup_enable",s.target.checked)})})}),e.jsx(T,{site:S.GMUP,children:e.jsx("td",{children:e.jsx(k,{sx:{m:1,minWidth:120},size:"small",children:e.jsx(E,{multiple:!0,value:n.gmup_tag_ids,onChange:s=>x(s.target.value),input:e.jsx(U,{id:"select-multiple-chip",label:"Chip"}),renderValue:()=>e.jsx(B,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.filter(s=>n.gmup_tag_ids.includes(s.id)).map(s=>e.jsx(V,{label:s.name},s.id))}),children:a.map(s=>e.jsx(f,{value:s.id,children:s.name},s.id))})})})}),e.jsx("td",{className:"text-end",children:e.jsx(z,{to:{pathname:Q.ORGANIZATIONS_DETAIL(t.id)+"/services"},className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",children:e.jsx("i",{className:"bi bi-eye fs-4"})})})]})]})},J=({data:t})=>{const a=g.parse(_().search),c=C(),n=_(),l=i=>{const m={...a,page:"",is_ecommerce:i.target.value};c({pathname:n.pathname,search:g.stringify(u.pickBy(m,u.identity))},{replace:!0})},o=i=>{const m=Object.assign(a,{search:i});c({pathname:n.pathname,search:g.stringify(u.pickBy(m,u.identity))},{replace:!0})};return e.jsxs("div",{className:"card-body filter-cnt",children:[e.jsx("div",{className:"search",children:e.jsx("input",{onChange:i=>o(i.target.value),type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm MC"})}),e.jsxs("div",{className:"filter",children:[e.jsx("div",{className:"filter-item",children:e.jsxs(k,{style:{width:"100%"},size:"small",children:[e.jsx(G,{id:"demo-select-small-label",children:"Trạng thái TMDT"}),e.jsxs(E,{labelId:"demo-select-small-label",id:"demo-select-small",label:"Trạng thái TMDT",value:a.is_ecommerce||"",onChange:l,children:[e.jsx(f,{value:"",children:"Tất cả"}),e.jsx(f,{value:"true",children:"Đang mở"}),e.jsx(f,{value:"false",children:"Đang đóng"})]})]})}),e.jsx("div",{className:"filter-item",children:t&&e.jsx(ee,{query:a,data:t})})]})]})},ee=({query:t,data:a})=>{const[c,n]=j.useState([]),{resultLoad:l,noti:o,onCloseNoti:i}=D(),[m,r]=j.useState(!1),{mutate:x,isLoading:p}=W({mutationFn:d=>y.getAll({page:d,is_ecommerce:t.is_ecommerce||"",sort:"-created_at",limit:30}).then(s=>s.data.context),onSuccess:d=>n(s=>[...s,...d.data])}),h=()=>{r(!0);for(var d=1;d<=(a==null?void 0:a.last_page);d++)x(d)};return j.useEffect(()=>{m&&c.length>0&&c.length===(a==null?void 0:a.total)&&se(c).then(()=>{l({message:"Xuất File thành công",color:"success"}),n([]),r(!1)}),c.length===(a==null?void 0:a.total)&&n([])},[c,a==null?void 0:a.total]),e.jsxs(e.Fragment,{children:[e.jsx(L,{severity:o.color,message:o.message,open:o.openAlert,close:i}),e.jsx(K,{onClick:h,loading:p,color:"success",variant:"contained",size:"medium",children:"Xuất DS"})]})},se=t=>new Promise(a=>{const c="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",n=".xlsx",o=[["#","ID","Tên MC","Link gian hàng","Subdomain","Trạng thái","Ngày tạo"],...t.map((h,d)=>[d+1,h.id,h.name,`https://beautyx.vn/cua-hang/${h.subdomain}`,h.subdomain,h.is_momo_ecommerce_enable?"Đang mở":"Đang tắt",w(h.created_at).format("DD/MM/YYYY")])],i=X.aoa_to_sheet(o),m=[{wch:5},{wch:10},{wch:75},{wch:45},{wch:25},{wch:25},{wch:25}];i["!cols"]=m;const x=Y({Sheets:{data:i},SheetNames:["data"]},{bookType:"xlsx",type:"array"}),p=new Blob([x],{type:c});q.saveAs(p,`ds_mc_${w().format("DDHHmmss")}`+n),a(!0)});export{re as default};
