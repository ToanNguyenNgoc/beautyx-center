import{t as A,j as e,S as _,a as b,W as j,b1 as h,a8 as F,al as C,am as k,a9 as P,bG as p,a7 as S,b2 as q,bL as E,K as g,cF as L,B as T,v as V,bJ as D,w as y,a0 as X,b6 as w}from"./index-BHl1vF-Z.js";import{a as u}from"./adminApi-CWj4GUWV.js";import{u as K}from"./usePostMedia-CUHIh1c9.js";import{u as R}from"./useGetRolesAndPermissions-Acynabr0.js";import{u as $}from"./useQueryParams-B4GAaOZZ.js";import{A as B}from"./Avatar-Ckuqs-6L.js";import{L as M}from"./LoadingButton-BU6aPnkN.js";import"./mediaApi-BVlMDnWK.js";const Q="_container_iupxa_1",z={container:Q},G=a=>{const{id:i="media",size:d=36,onChangeFile:l=()=>null,options:c,icon:r=A("/media/icons/duotune/files/fil005.svg"),...m}=a;return e.jsxs("div",{style:{width:"fit-content"},children:[e.jsx("input",{type:"file",id:i,hidden:!0,onChange:s=>{s.target.files&&l(s.target.files)},...c}),e.jsx("label",{htmlFor:i,style:{width:d},...m,className:`${z.container} ${a.className}`,children:typeof r=="string"?e.jsx("img",{style:{width:"75%",aspectRatio:"1/1",objectFit:"cover"},src:r,alt:""}):r})]})},ae=()=>{const{hasEnabled:a}=R(),{query:i,handleQueryString:d}=$(),{data:l,isLoading:c,refetch:r}=_({queryKey:[w.BrandApps,i],queryFn:()=>u.getBrandApps(Object.assign(i,{sort:"-created_at",append:"media_url"})),enabled:a("v1.brand_apps.index")}),m=(l==null?void 0:l.context.data)||[],[s,t]=b.useState(),{mutate:x}=j({mutationFn:o=>u.deleteBrandApp(o),onSuccess:()=>{p.open({title:"Xóa thành công",type:"success"}),r()},onError:()=>p.open({title:"Có lỗi xảy ra",type:"error"})}),n=o=>{L.open({message:"Xóa tài app thương hiệu ?",callBack:()=>x(o)})};return e.jsxs(h,{permissions:["v1.brand_apps.index"],showEmpty:!0,children:[e.jsx(F,{element:e.jsx(h,{permissions:["v1.brand_apps.store"],children:e.jsx(C,{variant:"contained",size:"large",onClick:()=>t(0),children:"Tạo mới"})}),title:"Danh sách App thương hiệu"}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tên app"}),e.jsx("th",{className:"min-w-140px",children:"Bundle"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-120px",children:"Trạng thái"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(o=>e.jsx(U,{item:o,onClickEdit:()=>t(o.id),onDelete:()=>n(o.id)},o.id))})]}),e.jsx(k,{loading:c}),e.jsx(P,{totalPage:(l==null?void 0:l.context.last_page)??1,onChangePage:o=>d("page",o),defaultPage:i.page})]})})}),e.jsx(I,{brandAppId:s,onClose:()=>t(void 0),refetch:r})]})},U=({item:a,onDelete:i=()=>null,onClickEdit:d=()=>null})=>{const l=S(),[c,r]=b.useState(a.status),{mutate:m}=j({mutationFn:t=>u.putBrandApp(a.id,{status:t}),onSuccess:()=>p.open({title:"Lưu thành công",type:"success"}),onError:()=>{p.open({title:"Có lỗi xảy ra",type:"error"}),r(a.status)}}),s=async t=>{r(t),m(t)};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx(B,{src:a.media_url||"",alt:a.name})}),e.jsx("div",{className:"d-flex justify-content-start flex-column",children:e.jsx("span",{className:"text-dark fw-bold fs-6",children:a.name})})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block fs-6",children:a.bundle_id})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:q(a.created_at)})}),e.jsx("td",{children:e.jsx(E,{value:c,label:"",onChange:t=>s(t.target.checked)})}),e.jsxs("td",{className:"d-flex justify-content-end",children:[e.jsx("button",{onClick:()=>l(`/pages/brand-apps/${a.bundle_id}/ios`),"aria-label":"Phiên bản",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/files/fil013.svg",className:"svg-icon-3"})}),e.jsx(h,{permissions:["v1.brand_apps.show","v1.brand_apps.update"],children:e.jsx("button",{onClick:d,"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),e.jsx(h,{permissions:["v1.brand_apps.destroy"],children:e.jsx("button",{onClick:i,"aria-label":"Xóa",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(g,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})]},a.id)},I=b.memo(({brandAppId:a,onClose:i=()=>null,refetch:d=()=>null})=>{const l=a&&a!==0?"put":"post",{mutate:c,isLoading:r}=j({mutationFn:n=>l==="post"?u.postBrandApp(n):u.putBrandApp(Number(a),n),onSuccess:()=>{p.open({title:"Lưu thành công",type:"success"}),d(),i()},onError:()=>p.open({title:"Có lỗi xảy ra",type:"error"})}),{handlePostMedia:m}=K(),s=T({initialValues:{name:"",status:!0,bundle_id:"",media_id:void 0,media_url:null},validationSchema:V({name:y().required("Nhập tên app thương hiệu"),bundle_id:y().required("Nhập Bundle ID"),media_id:D().required("Upload app icon")}),onSubmit(n){c(l==="post"?n:{...n,media_id:(t==null?void 0:t.context.media_url)===n.media_url?void 0:n.media_id,bundle_id:(t==null?void 0:t.context.bundle_id)===n.bundle_id?void 0:n.name})}}),{data:t}=_({queryKey:[w.BrandApps,a],queryFn:()=>u.getBrandApp(Number(a)),enabled:l==="put",onSuccess:n=>{n.context&&(s.setValues(n.context),n.context.media.length>0&&s.setFieldValue("media_id",n.context.media[0].model_id))}}),x=n=>{m({e:{target:{files:[n]}},callBack(f){var v,N;s.setFieldValue("media_id",(v=f[0])==null?void 0:v.model_id),s.setFieldValue("media_url",(N=f[0])==null?void 0:N.original_url)},version:"myspa",resetOriginalResult:!0})};return e.jsx(X,{open:a!==void 0,onClose:()=>{i(),s.resetForm()},children:e.jsx("div",{className:"card p-5",style:{width:"65vw"},children:e.jsxs("form",{onSubmit:s.handleSubmit,noValidate:!0,className:"form",children:[e.jsxs("div",{className:"row mb-6",children:[e.jsx("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"App icon"}),e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-lg-12 fv-row",children:[e.jsxs("div",{className:"d-flex flex-column align-items-center",style:{width:"fit-content"},children:[e.jsx(B,{src:s.values.media_url||"",sx:{width:84,height:84}}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{onChangeFile:n=>x(n[0])})})]}),s.touched.media_id&&s.errors.media_id&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:s.errors.media_id})})]})})})]}),e.jsxs("div",{className:"row mb-6",children:[e.jsx("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"Tên app thương hiệu"}),e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-lg-12 fv-row",children:[e.jsx("input",{type:"text",className:"form-control form-control-lg form-control-solid mb-3 mb-lg-0",placeholder:"Tên app thương hiệu",...s.getFieldProps("name")}),s.touched.name&&s.errors.name&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:s.errors.name})})]})})})]}),e.jsxs("div",{className:"row mb-6",children:[e.jsx("label",{className:"col-lg-4 col-form-label required fw-bold fs-6",children:"Bundle ID"}),e.jsx("div",{className:"col-lg-8",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-lg-12 fv-row",children:[e.jsx("input",{type:"text",className:"form-control form-control-lg form-control-solid mb-3 mb-lg-0",placeholder:"Bundle ID",...s.getFieldProps("bundle_id")}),s.touched.bundle_id&&s.errors.bundle_id&&e.jsx("div",{className:"fv-plugins-message-container",children:e.jsx("div",{className:"fv-help-block",children:s.errors.bundle_id})})]})})})]}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(M,{loading:r,size:"large",color:"success",type:"submit",variant:"contained",children:"Lưu"})})]})})})});export{ae as default};
