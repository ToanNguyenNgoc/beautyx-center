import{a as f,V as F,aF as _,j as a,bR as z,bS as E,an as I,aC as L,a7 as O}from"./index-B-8ZwVwN.js";import{F as P}from"./index-CYPFytSd.js";import{A as u}from"./Avatar-Kn6OQjuO.js";const D=({label:p="Gắn deal giảm giá",required:j=!1,discounts:s=[],onChangeDiscounts:o,filterAll:v=!0,platform:b="",organization_id:N})=>{var g,x;const i=f.useRef(null),d=e=>{i.current&&(e==="hide"&&i.current.classList.remove("org-search-show"),e==="show"&&(i.current.classList.add("org-search-show"),m("")))};window.addEventListener("click",()=>d("hide"));const{mutate:m,isLoading:S,data:c}=F({mutationFn:e=>O.Discount.get({"filter[keyword]":e,sort:"-created_at","filter[filter_all]":v,"filter[platform]":b,"filter[organization_id]":N})}),w=f.useCallback(_.debounce(e=>m(e),600),[]),k=e=>w(e.target.value),h=e=>{o&&(s.findIndex(r=>r.id===e.id)<0?o([...s,e]):o(s.filter(r=>r.id!==e.id)))};return a.jsxs("div",{className:"col col-org",children:[a.jsxs("label",{className:`${j?"required":""} form-label`,children:[p," (Số lượng: ",s.length,")"]}),a.jsx("div",{onClick:e=>{e.stopPropagation(),d("show")},className:"form-control form-control-solid",children:s.length>0?s.map((e,n)=>{var r,l,t;return a.jsx(z,{variant:"filled",className:"m-1",color:"success",label:e.title+" ["+e.platform+"]",avatar:a.jsx(u,{alt:e.title,src:((r=e==null?void 0:e.items)==null?void 0:r.length)>0?(t=(l=e==null?void 0:e.items[0])==null?void 0:l.productable)==null?void 0:t.image_url:e.title}),onDelete:()=>h(e)},n)}):"Gắn dịch vụ"}),a.jsx(E,{ref:i,sx:{boxShadow:3},className:"org-search",children:a.jsxs("div",{onClick:e=>e.stopPropagation(),children:[a.jsx("input",{autoFocus:!0,onChange:k,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm deal..."}),S&&a.jsx(I,{size:16}),a.jsx("div",{className:"org-list",children:a.jsx("ul",{className:"list",children:(x=(g=c==null?void 0:c.context)==null?void 0:g.data)==null?void 0:x.map((e,n)=>{var l,t;let r=e.title;return e.items.length>0?r=(l=e.items[0].productable)==null?void 0:l.image_url:e.organizations.length>0&&(r=e.organizations[0].image_url),a.jsxs(L,{selected:s.map(C=>C.id).includes(e.id),onClick:()=>h(e),children:[a.jsx(u,{alt:e.title,src:r}),a.jsxs("div",{className:"column item-content",children:[a.jsxs("div",{className:"title",children:[e.title,a.jsx(P,{platForm:e.platform})]}),a.jsx("div",{children:e.organizations.length>0&&a.jsx("span",{children:(t=e.organizations[0])==null?void 0:t.name})})]})]},n)})})})]})})]})};export{D as S};
