import{aE as k,e as A,a7 as S,as as h,Q as L,U as F,V as O,a as p,j as e,a8 as B,at as N,L as D,bL as C,av as y,bM as M,bN as U,K as v,aG as o,am as Y,a9 as Q,ah as m,aA as w,aB as T,bO as G,aC as x,bI as R,ax as V,ay as P}from"./index-BuiS39ZH.js";import{F as K}from"./index-DGoIgz2e.js";import{A as X}from"./axios.instance-Dl_stjmW.js";import{d as I}from"./discounts--DetIpQu.js";/* empty css              */import{E as W}from"./export-code-B-EFS65z.js";import"./LoadingButton-rOVndUJg.js";function te(){const{rootSite:n,isBeautyxSite:i}=k(),d=A(),r=S(),a=h.parse(d.search),{data:l,isLoading:u}=L({queryKey:[P.DISCOUNT_PAGE,a],queryFn:()=>I.getAll({page:(a==null?void 0:a.page)??1,limit:15,"filter[keyword]":a["filter[keyword]"],"filter[filter_all]":!0,"filter[platform]":i?a["filter[platform]"]:o.GMUP,"filter[discount_type]":a["filter[discount_type]"],sort:a.sort??"-created_at"})}),f=(l==null?void 0:l.data)??[],g=s=>{const b={...a,page:s};r({pathname:d.pathname,search:h.stringify(b)})},j=F(),{mutate:t}=O({mutationFn:s=>I.deleteById(s),onSuccess:()=>{j.invalidateQueries([P.DISCOUNT_PAGE,a])},onError:()=>V.open({title:"Có lỗi xảy ra",type:"error"})}),c=async()=>{X({version:"v4"}).get("/tags")};return p.useEffect(()=>{c()},[]),e.jsxs(e.Fragment,{children:[e.jsx(B,{element:e.jsx(N,{permissions:["v1.discounts.store"],children:e.jsx(D,{to:{pathname:"/pages/discounts-form"},className:"btn btn-sm btn-primary",style:{marginLeft:12},children:n==C.BEAUTYX?"Tạo mới mã giảm giá":"Tạo mới"})}),title:"Danh sách"}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:n==C.BEAUTYX?"Mã giảm giá":"Dịch vụ GMUP"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:["Số lượng : ",(l==null?void 0:l.total)??1]})]})}),e.jsx($,{query:a}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tiêu đề"}),e.jsx("th",{className:"min-w-80px",children:"Ưu tiên"}),e.jsx("th",{className:"min-w-150px",children:i?"Giá giảm":"Giá bán"}),e.jsx("th",{className:"min-w-100px",children:"Từ ngày"}),e.jsx("th",{className:"min-w-100px",children:"Đến ngày"}),i&&e.jsxs(p.Fragment,{children:[e.jsx("th",{className:"min-w-150px",children:"Hình thức giảm"}),e.jsx("th",{className:"min-w-100px text-end",children:"Nền tảng"}),e.jsx("th",{className:"min-w-100px text-end",children:"Số lượng mã"}),e.jsx("th",{className:"min-w-150px text-end",children:"Sử dụng/1 khách"})]}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:f.map((s,b)=>{var E,_;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"symbol symbol-45px me-5",children:e.jsx("img",{src:(_=(E=s.items[0])==null?void 0:E.productable)==null?void 0:_.image_url,alt:""})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary fs-6",children:s.title}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:y(s.created_at)})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark text-center fw-bold d-block mb-1 fs-7",children:s.priority})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex flex-column w-100 me-2",children:[M(s.discount_value||0),s.discount_type==="PERCENT"?"%":"đ"]})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:y(s.valid_from)})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:y(s.valid_util)})}),i&&e.jsxs(p.Fragment,{children:[e.jsx("td",{children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx(U,{TYPE:s.discount_type})})}),e.jsx("td",{children:e.jsx(K,{platForm:s.platform})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:s.total??"Không giới hạn"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted text-end fw-semobold text-muted d-block fs-7",children:s.limit??"Không giới hạn"})})]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex justify-content-end flex-shrink-0 tb-control",children:[e.jsx(N,{permissions:["v1.discounts.update"],children:e.jsx("button",{onClick:()=>r(`/pages/discounts-form/${s.uuid}`,{state:s}),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(v,{path:"/media/icons/duotune/art/art005.svg",className:"svg-icon-3"})})}),(s.platform==="SHOPEE"||s.platform==="VINID"||s.platform==="BEAUTYX"||s.platform===o.VIETTEL_MONEY||s.platform===o.LIVWELL||s.platform===o.TAPTAP)&&e.jsx("button",{className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",onClick:()=>r(`/pages/discounts/${s.uuid}`),children:e.jsx(v,{path:"/media/icons/duotune/general/gen019.svg",className:"svg-icon-3"})}),(s.platform==="SHOPEE"||s.platform==="VINID"||s.platform==="BEAUTYX"||s.platform===o.VIETTEL_MONEY||s.platform===o.LIVWELL||s.platform===o.TAPTAP)&&e.jsx(W,{title:"",size:"small",discount:s}),e.jsx(N,{permissions:["v1.discounts.destroy"],children:e.jsx("button",{onClick:()=>t(s.id),"aria-label":"Xem chi tiết",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",children:e.jsx(v,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]})})]},b)})})]}),e.jsx(Y,{loading:u}),e.jsx(Q,{totalPage:(l==null?void 0:l.last_page)??1,onChangePage:g,defaultPage:(a==null?void 0:a.page)??1})]})})]})]})}const $=({query:n})=>{const{isBeautyxSite:i}=k();let d=[{sort:"-created_at",title:"Ngày tạo"},{sort:"-total",title:"Số lượng mã"},{sort:"-priority",title:"Độ ưu tiên"}];i||(d=[{sort:"-created_at",title:"Ngày tạo"}]);const r=S(),a=A(),l=p.useCallback(m.debounce(t=>r(t.trim()===""?`${a.pathname}`:`${a.pathname}?filter[keyword]=${t}`,{replace:!0}),600),[]),u=t=>l(t.target.value),f=t=>{const c={...n,page:1,"filter[platform]":t.target.value!==""?t.target.value:""};r({pathname:a.pathname,search:h.stringify(m.pickBy(c,m.identity))})},g=t=>{const c={...n,page:1,"filter[discount_type]":t.target.value!==""?t.target.value:""};r({pathname:a.pathname,search:h.stringify(m.pickBy(c,m.identity))})},j=t=>{const c={...n,sort:t.target.value};r({pathname:a.pathname,search:h.stringify(c)})};return e.jsxs("div",{className:"d-flex justify-content-between filter-cnt",children:[e.jsxs("div",{children:[e.jsx("label",{className:"filter-row_label",children:"Tìm kiếm"}),e.jsx("input",{type:"text",onChange:u,className:"form-control form-control-solid py-2 px-6",placeholder:"Tiêu đề..."})]}),e.jsxs("div",{className:"filter-row",children:[i&&e.jsxs(p.Fragment,{children:[e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Type"}),e.jsx(w,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(T,{labelId:"demo-select-small-label",id:"demo-select-small",value:n["filter[discount_type]"]??"",onChange:g,children:[e.jsx(x,{value:"",children:e.jsx("em",{children:"Tất cả"})}),G.map(t=>e.jsx(x,{value:t.TYPE,children:t.title},t.id))]})})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Nền tảng"}),e.jsx(w,{sx:{m:1,minWidth:150},size:"small",children:e.jsxs(T,{labelId:"demo-select-small-label",id:"demo-select-small",value:n["filter[platform]"]??"",onChange:f,children:[e.jsx(x,{value:"",children:e.jsx("em",{children:"Tất cả"})}),R.map(t=>e.jsx(x,{value:t,children:t},t))]})})]})]}),e.jsxs("div",{className:"filter-row_platform",children:[e.jsx("label",{className:"filter-row_label",children:"Sắp xếp theo"}),e.jsx(w,{sx:{m:1,minWidth:150},size:"small",children:e.jsx(T,{labelId:"demo-select-small-label",id:"demo-select-small",value:n.sort??d[0].sort,onChange:j,children:d.map(t=>e.jsx(x,{value:t.sort,children:t.title},t.sort))})})]})]})]})};export{te as default};
