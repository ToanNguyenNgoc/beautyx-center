import{a as f,V as k,ah as _,j as r,bR as z,ao as F,aC as A}from"./index-BuiS39ZH.js";import{d as E}from"./discounts--DetIpQu.js";import{F as I}from"./index-DGoIgz2e.js";import{C as L}from"./Chip-B5qCQMpp.js";import{A as u}from"./Avatar-ZghSeTi1.js";const M=({label:x="Gắn deal giảm giá",required:p=!1,discounts:s=[],onChangeDiscounts:n,filterAll:j=!0,platform:v="",organization_id:b})=>{var g;const i=f.useRef(null),d=e=>{i.current&&(e==="hide"&&i.current.classList.remove("org-search-show"),e==="show"&&(i.current.classList.add("org-search-show"),m("")))};window.addEventListener("click",()=>d("hide"));const{mutate:m,isLoading:N,data:c}=k({mutationFn:e=>E.getAll({"filter[keyword]":e,sort:"-created_at","filter[filter_all]":j,"filter[platform]":v,"filter[organization_id]":b})}),w=f.useCallback(_.debounce(e=>m(e),600),[]),C=e=>w(e.target.value),h=e=>{n&&(s.findIndex(a=>a.id===e.id)<0?n([...s,e]):n(s.filter(a=>a.id!==e.id)))};return r.jsxs("div",{className:"col col-org",children:[r.jsxs("label",{className:`${p?"required":""} form-label`,children:[x," (Số lượng: ",s.length,")"]}),r.jsx("div",{onClick:e=>{e.stopPropagation(),d("show")},className:"form-control form-control-solid",children:s.length>0?s.map((e,o)=>{var a,l,t;return r.jsx(L,{variant:"filled",className:"m-1",color:"success",label:e.title+" ["+e.platform+"]",avatar:r.jsx(u,{alt:e.title,src:((a=e==null?void 0:e.items)==null?void 0:a.length)>0?(t=(l=e==null?void 0:e.items[0])==null?void 0:l.productable)==null?void 0:t.image_url:e.title}),onDelete:()=>h(e)},o)}):"Gắn dịch vụ"}),r.jsx(z,{ref:i,sx:{boxShadow:3},className:"org-search",children:r.jsxs("div",{onClick:e=>e.stopPropagation(),children:[r.jsx("input",{autoFocus:!0,onChange:C,type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm deal..."}),N&&r.jsx(F,{size:16}),r.jsx("div",{className:"org-list",children:r.jsx("ul",{className:"list",children:(g=c==null?void 0:c.data)==null?void 0:g.map((e,o)=>{var l,t;let a=e.title;return e.items.length>0?a=(l=e.items[0].productable)==null?void 0:l.image_url:e.organizations.length>0&&(a=e.organizations[0].image_url),r.jsxs(A,{selected:s.map(S=>S.id).includes(e.id),onClick:()=>h(e),children:[r.jsx(u,{alt:e.title,src:a}),r.jsxs("div",{className:"column item-content",children:[r.jsxs("div",{className:"title",children:[e.title,r.jsx(I,{platForm:e.platform})]}),r.jsx("div",{children:e.organizations.length>0&&r.jsx("span",{children:(t=e.organizations[0])==null?void 0:t.name})})]})]},o)})})})]})})]})};export{M as S};
