import{ad as w,a as C,V as S,ax as j,z as T,s as E,v as Y,j as e,a8 as I,az as k,au as b,aA as A,aB as D,aC as F,av as M,at as V,K as R,Q as G,aw as H,aD as f,ay as L}from"./index-BuiS39ZH.js";import{A as r}from"./axios.instance-Dl_stjmW.js";import{F as P}from"./FileUpload-4sQkN33v.js";import"./usePostMedia-80tRsVQE.js";import"./mediaApi-DApCnjp1.js";const q=["ORGANIZATION","SERVICE"],$=(n,m)=>G({queryKey:[L.GmupTagId,n],queryFn:()=>r({version:"v4"}).get(`/tags/${n}`,{params:{include:"media|children|children.media"}}).then(i=>i.data),enabled:!!n,...m}),U=()=>{const n=w().id,m=n?"EDIT":"CREATE",[c,i]=C.useState([]),u=S({mutationFn:async a=>{const s=m=="CREATE"?await r({version:"v4"}).post("/tags",a).then(t=>t.data):await r({version:"v4"}).put(`/tags/${n}`,a).then(t=>t.data);return s.context.id&&await Promise.all(c.map(async t=>{t.id?r({version:"v4"}).put(`/tags/${t.id}`,Object.assign(t,{parent_id:s.context.id})):r({version:"v4"}).post("/tags",Object.assign(t,{parent_id:s.context.id}))})),s},onSuccess:()=>j.open({title:"Lưu thành công",type:"success"}),onError:()=>j.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"})});$(n,{onSuccess:a=>{const s=a.context;s&&(l("name",s.name),l("group",s.group),l("priority",s.priority),l("status",s.status),i(s.children),s.media.length>0&&(l("media_id",s.media[0].model_id),l("original_url",s.media[0].original_url)))}});const{handleChange:x,handleSubmit:v,setFieldValue:l,values:o,errors:p,touched:N}=T({initialValues:{name:"",group:"",parent_id:"",priority:"",media_id:null,original_url:"",status:!0},validationSchema:E({name:Y().trim().required("Vui lòng nhập nội dung")}),onSubmit:a=>{u.mutate(a)}}),y=()=>{i(a=>[...a,{name:"",priority:0,group:"SERVICE",parent_id:null,status:!0,children:[],created_at:f().format("YYYY-DD-MM HH:mm:ss"),updated_at:f().format("YYYY-DD-MM HH:mm:ss"),deleted_at:null,media:[]}])},_=(a,s)=>{H.open({callBack:()=>{i(t=>t.filter((g,d)=>d!==a)),s&&r({version:"v4"}).delete(`/tags/${s}`)}})},h=(a,s,t)=>{i(g=>{const d=[...g];return d[a]={...d[a],[s]:t},d})};return e.jsxs("div",{className:"card p-4",children:[e.jsx(I,{title:"Tag form"}),e.jsxs("form",{className:"discount-form mb-10 container",onSubmit:v,autoComplete:"off",children:[e.jsxs("div",{className:"col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tag icon"}),e.jsx(P,{types:k,value:o.original_url,onUpdated:a=>{l("media_id",a.model_id),l("original_url",a.original_url)}})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Trạng thái"}),e.jsx(b,{label:"",value:o.status,onChange:a=>l("status",a.target.checked)})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Độ ưu tiên"}),e.jsx("input",{onChange:x,value:o.priority,type:"number",className:"form-control",name:"priority"})]})]}),e.jsxs("div",{className:"col-12 d-flex gap-4 mt-6",children:[e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Tên"}),e.jsx("input",{onChange:x,value:o.name,className:"form-control",name:"name"}),p.name&&N.name&&e.jsx("span",{className:"text-danger d-block mt-2",children:p.name})]}),e.jsxs("div",{className:"wrap-item col-6 d-flex flex-column",children:[e.jsx("label",{className:"form-label",children:"Group"}),e.jsx(A,{sx:{m:1},size:"small",children:e.jsx(D,{labelId:"demo-select-small-label",id:"demo-select-small",value:o.group,onChange:x,name:"group",children:q.map(a=>e.jsx(F,{value:a,children:a},a))})})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-dark fw-bold fs-6",children:"Subtag"}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-150px",children:"Tag"}),e.jsx("th",{className:"min-w-140px",children:"Độ ưu tiên"}),e.jsx("th",{className:"min-w-140px",children:"Status"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:c==null?void 0:c.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("input",{value:a.name,onChange:t=>h(s,"name",t.target.value),className:"form-control"})})}),e.jsx("td",{children:e.jsx("input",{value:a.priority,onChange:t=>h(s,"priority",t.target.value),type:"number",className:"form-control"})}),e.jsx("td",{children:e.jsx(b,{label:"",value:a.status,onChange:t=>h(s,"status",t.target.checked)})}),e.jsx("td",{className:"text-end",children:e.jsx("div",{className:"d-flex flex-column w-100 me-2",children:e.jsx("div",{className:"d-flex flex-stack mb-2",children:e.jsx("span",{className:"text-muted me-2 fs-7 fw-semobold",children:M(a.created_at,"DD/MM/YYYY HH:mm")})})})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-end flex-shrink-0 tb-control",children:e.jsx(V,{permissions:["v4.tags.destroy"],children:e.jsx("button",{onClick:()=>_(s,a.id),"aria-label":"Xóa",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1",type:"button",children:e.jsx(R,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})})})]},s))})]}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{onClick:y,type:"button",className:"btn btn-primary btn-sm",children:"Thêm subtag"})})]})})]}),e.jsx("div",{className:"d-flex flex-end gap-4 mt-10",children:e.jsx("button",{className:"btn btn-success",type:"submit",disabled:u.isLoading,children:u.isLoading?"Đang lưu...":"Lưu"})})]})]})};export{U as default};
