import{ag as C,S as k,a as v,j as e,bI as P,bz as y,b6 as T,W as q,B as _,v as A,w as j,b1 as w,a8 as I,by as M,bW as E,bX as d,ap as N,an as L,bY as R,bZ as F}from"./index-BHl1vF-Z.js";import{a as D}from"./platForm-CEzyLLuJ.js";import{u as G,A as Y}from"./index-CqMaASZ6.js";import{S as z}from"./index-DIRRKTFG.js";import{S as B}from"./index-DrxsfY44.js";import{p as $}from"./promotionApi-CrtS6sYc.js";import{C as K}from"./Chip-DrXhVjId.js";import{A as b}from"./Avatar-Ckuqs-6L.js";import{L as Q}from"./LoadingButton-BU6aPnkN.js";import"./discounts-CUePuapv.js";import"./index-BS_oHEVL.js";const U={post:o=>C.post("/beautyx/notification",o).then(r=>r.data)},V=({required:o,value:r,onChange:m=()=>{}})=>{var u,p;const{data:a}=k({queryKey:[T.PROMOTION],queryFn:()=>$.getAll({limit:15,page:1})}),t=(u=a==null?void 0:a.data)==null?void 0:u.find(s=>s.id===Number(r)),n=v.useRef(null),h=s=>{n.current&&(s==="hide"&&n.current.classList.remove("org-search-show"),s==="show"&&n.current.classList.add("org-search-show"))};return window.addEventListener("click",()=>h("hide")),e.jsxs("div",{className:"col col-org",children:[e.jsx("label",{className:`${o?"required":""} form-label`,children:"Chọn chương trình khuyến mại"}),e.jsx("div",{onClick:s=>{s.stopPropagation(),h("show")},className:"form-control form-control-solid",children:t?e.jsx(K,{className:"m-1",color:"success",label:t.name,avatar:e.jsx(b,{alt:t.name,src:t.media_url||""}),onDelete:()=>m(void 0)}):"Gắn chương trình khuyến mại"}),e.jsx(P,{ref:n,sx:{boxShadow:3},className:"org-search",children:e.jsx("div",{onClick:s=>s.stopPropagation(),children:e.jsx("div",{className:"org-list",children:e.jsx("ul",{className:"list",children:(p=a==null?void 0:a.data)==null?void 0:p.map(s=>e.jsxs(y,{selected:s.id===Number(t==null?void 0:t.id),onClick:()=>m(s.id),children:[e.jsx(b,{style:{marginRight:"6px"},alt:s.name,src:String(s.media_url)}),e.jsx("div",{className:"col",children:e.jsx("p",{children:s.name})})]},s.id))})})})})]})};function le(){const{resultLoad:o,noti:r,onCloseNoti:m}=G(),[a,t]=v.useState(),[n,h]=v.useState(),{mutate:u,isLoading:p}=q({mutationFn:i=>R()===F?L.postNotification(i):U.post(i),onSuccess:()=>o({message:"Push thông báo thành công",color:"success"}),onError:i=>{var f;const c=i;o({color:"error",message:`Có lỗi xảy ra. Mã lỗi ${(f=c==null?void 0:c.request)==null?void 0:f.status}`})}}),{values:s,errors:l,handleChange:x,handleSubmit:S,touched:g,setFieldValue:O}=_({initialValues:{title:"",description:"",type:"",link:"",payload_id:""},validationSchema:A({title:j().required("Nhập tiêu đền"),description:j().required("Nhập nội dung"),type:j().required("Chọn loại thông báo cho"),link:j().required("NHập đường dẫn")}),onSubmit:i=>{let c=i.payload_id;Number(i.type)===d.ORG.id&&a&&(c=String(a==null?void 0:a.id)),Number(i.type)===d.DISCOUNT.id&&n&&(c=n.uuid),u({...i,payload_id:c})}});return e.jsxs(w,{permissions:["v1.beautyx.notification.sendNotification"],showEmpty:!0,children:[e.jsx(I,{title:"Thông báo"}),e.jsx(Y,{severity:r.color,message:r.message,open:r.openAlert,close:m}),e.jsx("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:e.jsxs("div",{className:"notification-cnt",children:[e.jsxs("form",{onSubmit:S,className:"form-left",children:[e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Tiêu đề"}),e.jsx("input",{value:s.title,onChange:x,type:"text",name:"title",className:"form-control form-control-solid mt-1 mb-4"}),l.title&&g.title&&e.jsx("span",{className:"text-danger",children:l.title})]}),e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Nội dung thông báo"}),e.jsx("input",{value:s.description,onChange:x,type:"text",name:"description",className:"form-control form-control-solid mt-1 mb-4"}),l.description&&g.description&&e.jsx("span",{className:"text-danger",children:l.description})]}),e.jsxs("div",{className:"column mb-4",children:[e.jsx("div",{className:"required form-label",children:"Thông báo cho"}),e.jsx(M,{size:"small",name:"type",value:s.type,onChange:x,children:E.map(i=>e.jsx(y,{value:String(i.id),children:i.title},i.id))}),l.type&&g.type&&e.jsx("span",{className:"text-danger",children:l.type})]}),e.jsxs(e.Fragment,{children:[Number(s.type)===d.ORG.id&&e.jsx("div",{className:"column",children:e.jsx(z,{organization_id:s.payload_id,origin:a,setOrigin:t})}),Number(s.type)===d.PROMOTION.id&&e.jsx("div",{className:"column",children:e.jsx(V,{value:s.payload_id,onChange:i=>O("payload_id",String(i))})}),Number(s.type)===d.DISCOUNT.id&&e.jsx("div",{className:"column",children:e.jsx(B,{label:"Gắn deal giảm giá",onChangeDiscounts:i=>h(i[i.length-1]),filterAll:!1,platform:D.MOMO,discounts:n?[n]:[]})})]}),e.jsxs("div",{className:"column",children:[e.jsx("div",{className:"required form-label",children:"Đường dẫn"}),e.jsx("input",{value:s.link,onChange:x,type:"text",name:"link",className:"form-control form-control-solid mt-1 mb-4"}),l.link&&g.link&&e.jsx("span",{className:"text-danger",children:l.link})]}),e.jsx("div",{className:"d-flex justify-content-end mt-6",children:e.jsx(Q,{type:"submit",variant:"contained",color:"success",loading:p,children:"Push thông báo"})})]}),e.jsxs("div",{className:"preview-right",children:[e.jsx("span",{className:"title",children:"Giao diện thông báo"}),e.jsx("div",{className:"device-cnt",children:e.jsxs("div",{className:"device",children:[e.jsx("img",{className:"device-img",src:N.android,alt:""}),e.jsx("div",{className:"device-noti",children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:N.beautyxIcon,alt:""})}),e.jsxs("div",{className:"item-right",children:[e.jsx("p",{className:"item-right-title",children:s.title}),e.jsx("p",{className:"item-right-content",children:s.description})]})]})})]})}),e.jsx("div",{className:"device-cnt",children:e.jsxs("div",{className:"device",children:[e.jsx("img",{className:"device-img",src:N.iphone,alt:""}),e.jsx("div",{className:"device-noti",style:{marginTop:"50px"},children:e.jsxs("div",{className:"item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:N.beautyxIcon,alt:""})}),e.jsxs("div",{className:"item-right",children:[e.jsx("p",{className:"item-right-title",children:s.title}),e.jsx("p",{className:"item-right-content",children:s.description})]})]})})]})})]})]})})]})}export{le as default};
