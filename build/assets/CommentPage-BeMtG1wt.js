import{Q as v,aE as w,j as e,at as y,a8 as _,am as k,a9 as C,a as $,au as b,av as P,K as z,ax as g,bZ as j}from"./index-B7MYsrm1.js";import{A as N}from"./axios.instance-cwQkMhBD.js";import{u as f}from"./useDebounce-DqY-k8Se.js";import{u as A}from"./useQueryParams-BiNmewcg.js";function D(s,i){var d;const a=v({queryKey:[w.Comments,s],queryFn:()=>N().get("/admin/comments",{params:s}).then(t=>t.data),retry:!1,...i}),l=((d=a.data)==null?void 0:d.context.data)||[];return{...a,comments:l}}const x="https://beautyx.vn",Y=()=>{const{query:s,handleQueryString:i}=A(),a=f(s["filter[user]"]||"",800),l=f(s["filter[body]"]||"",800),{comments:d,data:t,isLoading:h}=D({include:"organization|rate",append:"media_url|productable",sort:"-created_at",limit:15,page:s.page,"filter[user]":a,"filter[body]":l});return e.jsxs(y,{permissions:["v1.admin.comments.index"],showEmpty:!0,children:[e.jsx(_,{title:"Danh sách phản hồi"}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-8",children:e.jsx(I,{query:s,handleQueryString:i})}),e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Phản hồi"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:[t==null?void 0:t.context.total," phản hồi"]})]})}),e.jsx("div",{className:"card-body py-3",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted",children:[e.jsx("th",{className:"min-w-50px",children:"Id"}),e.jsx("th",{className:"min-w-140px",children:"Khách hàng"}),e.jsx("th",{className:"min-w-150px",children:"Nội dung bình luận"}),e.jsx("th",{className:"min-w-120px",children:"Doanh nghiệp"}),e.jsx("th",{className:"min-w-120px",children:"Dịch vụ / Sản phầm"}),e.jsx("th",{className:"min-w-100px",children:"Hiển thị"}),e.jsx("th",{className:"min-w-120px",children:"Hiển thị hình ảnh"}),e.jsx("th",{className:"min-w-120px",children:"Đánh giá"}),e.jsx("th",{className:"min-w-120px",children:"Ngày tạo"}),e.jsx("th",{className:"min-w-120px",children:"Link"}),e.jsx("th",{className:"min-w-100px text-end",children:"Actions"})]})}),e.jsx("tbody",{children:d.map(n=>e.jsx(E,{comment:n},n.id))})]})})}),e.jsx(k,{loading:h}),e.jsx("div",{className:"mt-5",children:e.jsx(C,{totalPage:(t==null?void 0:t.context.last_page)||1,onChangePage:n=>i("page",n),defaultPage:s.page})})]})]})},E=({comment:s})=>{var t,h,n,m,p;const[i,a]=$.useState({status:s.status,has_media:s.has_media}),l=(r,o)=>{a(c=>({...c,[r]:o})),N().put(`/admin/comments/${s.id}`,{[r]:o}).then(()=>g.open({title:"Lưu thành công",type:"success"})).catch(()=>{g.open({title:"Có lỗi xảy ra. Vui lòng thử lại",type:"error"}),a(c=>({...c,[r]:s[r]}))})},d=()=>{var r,o,c,u;if(console.log(s),!!((r=s.organization)!=null&&r.id))switch(s.commentable_type){case"App\\Models\\CI\\Organization":window.open(`${x}/cua-hang/${(o=s.organization)==null?void 0:o.subdomain}`,"_blank");break;case"App\\Models\\CI\\Service":if(!((c=s.productable)!=null&&c.id))return;window.open(`${x}/dich-vu/${s.productable.id}_${s.organization_id}-${j(s.productable.service_name)}#cmt`,"_blank");break;case"App\\Models\\Order":if(!((u=s.productable)!=null&&u.id))return;window.open(`${x}/dich-vu/${s.productable.id}_${s.organization_id}-${j(s.productable.service_name)}#cmt`,"_blank");break}};return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:"text-dark fw-bold text-hover-primary fs-6",children:["# - ",s.id]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-6",children:(t=s.user)==null?void 0:t.fullname})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-6",children:s.body})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-6",children:(h=s.organization)==null?void 0:h.name})}),e.jsx("td",{className:"text-dark fw-bold text-hover-primary fs-6",children:(n=s.productable)==null?void 0:n.service_name}),e.jsx("td",{children:e.jsx(b,{value:i.status,onChange:r=>l("status",r.target.checked),label:""})}),e.jsx("td",{children:e.jsx(b,{value:i.has_media,onChange:r=>l("has_media",r.target.checked),label:""})}),e.jsx("td",{children:((m=s.rate)==null?void 0:m.point)&&`${(p=s.rate)==null?void 0:p.point} ⭐`}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-6",children:P(s.created_at,"DD/MM/YYYY HH:mm")})}),e.jsx("td",{children:e.jsx("span",{onClick:d,className:"badge badge-light-success",children:"Link"})}),e.jsx("td",{className:"text-end",children:e.jsx("a",{href:"#",className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",children:e.jsx(z,{path:"/media/icons/duotune/general/gen027.svg",className:"svg-icon-3"})})})]},s.id)},I=({query:s,handleQueryString:i})=>e.jsx("div",{children:e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("input",{defaultValue:s["filter[user]"]||"",value:s["filter[user]"],onChange:a=>i("filter[user]",a.target.value),className:"form-control form-control-solid",placeholder:"Tìm kiếm tên khách hàng..."}),e.jsx("input",{defaultValue:s["filter[body]"]||"",value:s["filter[body]"],onChange:a=>i("filter[body]",a.target.value),className:"form-control form-control-solid",placeholder:"Tìm kiếm nội dung bình luận..."})]})});export{Y as default};
