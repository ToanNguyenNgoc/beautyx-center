import{cf as v,a7 as b,ad as w,V as y,z as C,s as S,v as t,Q as q,aI as V,j as e,at as _,a8 as F,aB as E,aC as k,cn as T,ax as m}from"./index-BlvkBlq-.js";import{u as I}from"./useGetRoles-C3xjUdDS.js";import{a as d}from"./adminApi-eUYF2dd1.js";import{X as u}from"./index-BsWODKM8.js";import"./roleAndPermissionApi-MJ614ifr.js";import"./LoadingButton-DGqjgf5H.js";function M(r,o,s){return{fontWeight:o.includes(r)?s.typography.fontWeightMedium:s.typography.fontWeightRegular}}const Q=()=>{const{hasEnabled:r}=v(),o=b(),s=w(),{mutate:c,isLoading:h}=y({mutationFn:a=>s!=null&&s.id?d.adminUserUpdate(Number(s.id),a):d.adminUserCreate(a),onSuccess:()=>{m.open({title:"Cập nhật thành công !",type:"success"}),setTimeout(()=>o(-1),800)},onError:()=>m.open({title:"Có lỗi xảy ra",type:"error"})}),l=C({initialValues:{email:"",password:"",fullname:"",telephone:"",roles_id:[]},validationSchema:S({fullname:t().required("Nhập họ và tên"),email:t().required("Vui lòng nhập Email").email("Vui nhập đúng định dạng Email"),password:s!=null&&s.id?t().nullable(!0):t().required("Vui lòng nhập mật khẩu"),telephone:s!=null&&s.id?t().nullable(!0):t().required("Vui lòng nhập điện thoại")}),onSubmit:a=>N(a)}),{refetch:p,isRefetching:x,data:n}=q({queryKey:[],queryFn:()=>d.adminUser(Number(s.id)).then(a=>a.data),enabled:!!(s.id&&r("v1.admin.users.index")),onSuccess:a=>{l.setFieldValue("fullname",a.context.fullname||""),l.setFieldValue("email",a.context.email||""),l.setFieldValue("telephone",a.context.telephone||""),l.setFieldValue("roles_id",a.context.roles.map(i=>String(i.id)))}}),{roles:f}=I(),g=V(),j=a=>{const{target:{value:i}}=a;l.setFieldValue("roles_id",i)},N=a=>{c({fullname:a.fullname,email:(n==null?void 0:n.context.email)!==a.email?a.email:void 0,telephone:(n==null?void 0:n.context.telephone)!==a.telephone?a.telephone:void 0,password:s!=null&&s.id?void 0:a.password,roles_id:a.roles_id.map(i=>Number(i))})};return e.jsxs(_,{permissions:s!=null&&s.id?["v1.admin.users.index","v1.admin.users.update"]:["v1.admin.users.store"],showEmpty:!0,children:[e.jsx(F,{title:s!=null&&s.id?"Cập nhật":"Tạo mới"}),e.jsx("div",{className:"card",children:e.jsxs("form",{className:"card-body py-3",onSubmit:l.handleSubmit,autoComplete:"off",children:[e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item w-100 p-2",children:[e.jsx("label",{className:"required form-label",children:"Tên"}),e.jsx("input",{value:l.values.fullname,onChange:l.handleChange,name:"fullname",type:"text",className:"form-control form-control-solid",placeholder:"Tên"}),l.errors.fullname&&l.touched.fullname&&e.jsx("span",{className:"text-danger",children:l.errors.fullname})]}),e.jsxs("div",{className:"wrap-item w-100 p-2",children:[e.jsx("label",{className:"required form-label",children:"Mật khẩu"}),e.jsx("input",{value:l.values.password,onChange:l.handleChange,name:"password",type:"text",className:"form-control form-control-solid",placeholder:"Mật khẩu",disabled:!!(s!=null&&s.id)}),l.errors.password&&l.touched.password&&e.jsx("span",{className:"text-danger",children:l.errors.password})]})]}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("label",{className:"required form-label",children:"Email"}),e.jsx("input",{value:l.values.email,onChange:l.handleChange,name:"email",type:"text",className:"form-control form-control-solid"}),l.errors.email&&l.touched.email&&e.jsx("span",{className:"text-danger",children:l.errors.email})]}),e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("label",{className:"required form-label",children:"Số điện thoại"}),e.jsx("input",{value:l.values.telephone,onChange:l.handleChange,name:"telephone",disabled:!!(s!=null&&s.id),type:"text",className:"form-control form-control-solid",placeholder:"Số điện thoại"}),l.errors.telephone&&l.touched.telephone&&e.jsx("span",{className:"text-danger",children:l.errors.telephone})]})]}),e.jsx("div",{className:"flex-row-sp input-wrap",style:{display:"none"},children:e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("p",{className:"required form-label",children:"Quyền"}),e.jsx(E,{size:"small",labelId:"demo-multiple-name-label",id:"demo-multiple-name",multiple:!0,value:l.values.roles_id,onChange:j,input:e.jsx(T,{label:"Name"}),style:{width:"100%",maxWidth:"100%"},children:f.map(a=>e.jsx(k,{value:String(a.id),style:M(a.name,l.values.roles_id,g),children:a.name},a.id))}),l.errors.roles_id&&l.touched.roles_id&&e.jsx("span",{className:"text-danger",children:l.errors.roles_id})]})}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(u,{type:"button",title:"Khôi phục",onClick:p,loading:x}),e.jsx(u,{color:"success",type:"submit",title:"Lưu",loading:h})]})]})})]})};export{Q as default};
