import{cg as v,a8 as b,ae as w,V as y,z as C,s as S,v as i,Q as q,aJ as V,j as e,as as _,a9 as F,aB as E,aC as k,co as A,ax as m,a7 as d}from"./index-Cy0ECsl2.js";import{u as T}from"./useGetRoles-C5IIu1Qz.js";import{X as u}from"./index-PhhhSF2P.js";import"./roleAndPermissionApi-r4aFHIJS.js";import"./LoadingButton-BnUDQfN1.js";function M(r,o,l){return{fontWeight:o.includes(r)?l.typography.fontWeightMedium:l.typography.fontWeightRegular}}const L=()=>{const{hasEnabled:r}=v(),o=b(),l=w(),{mutate:c,isLoading:h}=y({mutationFn:a=>l!=null&&l.id?d.Admin.adminUserUpdate(Number(l.id),a):d.Admin.adminUserCreate(a),onSuccess:()=>{m.open({title:"Cập nhật thành công !",type:"success"}),setTimeout(()=>o(-1),800)},onError:()=>m.open({title:"Có lỗi xảy ra",type:"error"})}),s=C({initialValues:{email:"",password:"",fullname:"",telephone:"",roles_id:[]},validationSchema:S({fullname:i().required("Nhập họ và tên"),email:i().required("Vui lòng nhập Email").email("Vui nhập đúng định dạng Email"),password:l!=null&&l.id?i().nullable(!0):i().required("Vui lòng nhập mật khẩu"),telephone:l!=null&&l.id?i().nullable(!0):i().required("Vui lòng nhập điện thoại")}),onSubmit:a=>N(a)}),{refetch:p,isRefetching:x,data:n}=q({queryKey:[],queryFn:()=>d.Admin.adminUser(Number(l.id)).then(a=>a.data),enabled:!!(l.id&&r("v1.admin.users.index")),onSuccess:a=>{s.setFieldValue("fullname",a.context.fullname||""),s.setFieldValue("email",a.context.email||""),s.setFieldValue("telephone",a.context.telephone||""),s.setFieldValue("roles_id",a.context.roles.map(t=>String(t.id)))}}),{roles:f}=T(),g=V(),j=a=>{const{target:{value:t}}=a;s.setFieldValue("roles_id",t)},N=a=>{c({fullname:a.fullname,email:(n==null?void 0:n.context.email)!==a.email?a.email:void 0,telephone:(n==null?void 0:n.context.telephone)!==a.telephone?a.telephone:void 0,password:l!=null&&l.id?void 0:a.password,roles_id:a.roles_id.map(t=>Number(t))})};return e.jsxs(_,{permissions:l!=null&&l.id?["v1.admin.users.index","v1.admin.users.update"]:["v1.admin.users.store"],showEmpty:!0,children:[e.jsx(F,{title:l!=null&&l.id?"Cập nhật":"Tạo mới"}),e.jsx("div",{className:"card",children:e.jsxs("form",{className:"card-body py-3",onSubmit:s.handleSubmit,autoComplete:"off",children:[e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item w-100 p-2",children:[e.jsx("label",{className:"required form-label",children:"Tên"}),e.jsx("input",{value:s.values.fullname,onChange:s.handleChange,name:"fullname",type:"text",className:"form-control form-control-solid",placeholder:"Tên"}),s.errors.fullname&&s.touched.fullname&&e.jsx("span",{className:"text-danger",children:s.errors.fullname})]}),e.jsxs("div",{className:"wrap-item w-100 p-2",children:[e.jsx("label",{className:"required form-label",children:"Mật khẩu"}),e.jsx("input",{value:s.values.password,onChange:s.handleChange,name:"password",type:"text",className:"form-control form-control-solid",placeholder:"Mật khẩu",disabled:!!(l!=null&&l.id)}),s.errors.password&&s.touched.password&&e.jsx("span",{className:"text-danger",children:s.errors.password})]})]}),e.jsxs("div",{className:"flex-row-sp input-wrap",children:[e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("label",{className:"required form-label",children:"Email"}),e.jsx("input",{value:s.values.email,onChange:s.handleChange,name:"email",type:"text",className:"form-control form-control-solid"}),s.errors.email&&s.touched.email&&e.jsx("span",{className:"text-danger",children:s.errors.email})]}),e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("label",{className:"required form-label",children:"Số điện thoại"}),e.jsx("input",{value:s.values.telephone,onChange:s.handleChange,name:"telephone",disabled:!!(l!=null&&l.id),type:"text",className:"form-control form-control-solid",placeholder:"Số điện thoại"}),s.errors.telephone&&s.touched.telephone&&e.jsx("span",{className:"text-danger",children:s.errors.telephone})]})]}),e.jsx("div",{className:"flex-row-sp input-wrap",style:{display:"none"},children:e.jsxs("div",{className:"wrap-item w-50 p-2",children:[e.jsx("p",{className:"required form-label",children:"Quyền"}),e.jsx(E,{size:"small",labelId:"demo-multiple-name-label",id:"demo-multiple-name",multiple:!0,value:s.values.roles_id,onChange:j,input:e.jsx(A,{label:"Name"}),style:{width:"100%",maxWidth:"100%"},children:f.map(a=>e.jsx(k,{value:String(a.id),style:M(a.name,s.values.roles_id,g),children:a.name},a.id))}),s.errors.roles_id&&s.touched.roles_id&&e.jsx("span",{className:"text-danger",children:s.errors.roles_id})]})}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(u,{type:"button",title:"Khôi phục",onClick:p,loading:x}),e.jsx(u,{color:"success",type:"submit",title:"Lưu",loading:h})]})]})})]})};export{L as default};
