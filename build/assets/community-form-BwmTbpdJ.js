import{W as h,B as p,j as e,a8 as x,ao as f,ar as v,aq as j,a as d}from"./index-BHl1vF-Z.js";import{u as b,A as N}from"./index-CqMaASZ6.js";import{S as _}from"./index-DIRRKTFG.js";import{c as z}from"./style-_LNsiqAP.js";import{u as C}from"./usePostMedia-CUHIh1c9.js";import{S as y}from"./select-service-BR9ayGpm.js";import{C as F}from"./Chip-DrXhVjId.js";import{T as S}from"./Tooltip-DUVNpGRQ.js";import{L as T}from"./LoadingButton-BU6aPnkN.js";import"./Avatar-Ckuqs-6L.js";import"./mediaApi-BVlMDnWK.js";/* empty css              */import"./Popper-CWiJo06z.js";const W=()=>{var m;const{handlePostMedia:n}=C(),{resultLoad:t,noti:r,onCloseNoti:a}=b(),{mutate:l,isLoading:u}=h({mutationFn:i=>z.post(i),onSuccess:()=>{t({message:"Đăng bài thành công",color:"success"})},onError:()=>{t({message:"Đăng bài thất bại",color:"error"})}}),s=p({initialValues:{content:"",organization:void 0,media:[],services:[]},onSubmit:i=>{var o;l({content:i.content,organization_id:(o=i.organization)==null?void 0:o.id,media_ids:i.media.map(c=>c.model_id),service_ids:i.services.map(c=>c.id),status:1,tag_id:2})}}),g=i=>{n({e:i,callBack:o=>{s.setFieldValue("media",[...o,...s.values.media])}})};return e.jsxs(e.Fragment,{children:[e.jsx(N,{open:r.openAlert,close:a,message:r.message,severity:r.color}),e.jsx(x,{title:"Tạo mới bài viết"}),e.jsx("div",{className:"d-flex flex-column-fluid",id:"kt_post",children:e.jsx("div",{className:"form-cnt",children:e.jsxs("form",{onSubmit:s.handleSubmit,autoComplete:"off",className:"form",children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"required form-label",children:"Nội dung bài viết"}),e.jsx(k,{name:"content",value:s.values.content,onChange:s.handleChange})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"required form-label",children:"Ảnh/video"}),e.jsx("div",{className:"grid-images my-1",children:s.values.media.map(i=>e.jsxs("div",{className:"item-image",children:[i.model_type==="video/mp4"?e.jsx("video",{controls:!0,children:e.jsx("source",{src:i.original_url})}):e.jsx("img",{src:i.original_url,alt:""}),i.model_id>0?e.jsx(F,{color:"error",variant:"filled",onDelete:()=>s.setFieldValue("media",s.values.media.filter(o=>o.model_id!==i.model_id))}):e.jsx("div",{className:"item-image-load d-flex justify-content-center align-items-center",children:e.jsx(f,{size:26})})]},i.model_id))}),e.jsxs("div",{children:[e.jsx("input",{hidden:!0,id:"media",onChange:g,type:"file",accept:`${v}, ${j}`,multiple:!0}),e.jsx(S,{title:"Tải lên ảnh/video",placement:"top",children:e.jsx("label",{htmlFor:"media",className:"btn btn-icon btn-success btn-upload",children:e.jsx("i",{className:"bi bi-file-earmark-plus-fill"})})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(_,{required:!0,setOrigin:i=>{s.setFieldValue("organization",i),s.setFieldValue("services",[])},origin:s.values.organization,organization_id:(m=s.values.organization)==null?void 0:m.id})}),e.jsx("div",{className:"mt-4",children:e.jsx(y,{orgsChoose:s.values.organization?[s.values.organization]:[],values:s.values.services,onChangeService:i=>s.setFieldValue("services",i)})}),e.jsx("div",{className:"d-flex justify-content-end mt-3",children:e.jsx(T,{loading:u,type:"submit",variant:"contained",color:"success",size:"large",children:"Tạo mới bài viết"})})]})})})]})},k=({name:n="",value:t="",onChange:r=()=>{}})=>{const a=d.useRef(null),l=()=>{a.current&&(a.current.style.height="auto",t.length>0&&(a.current.style.height=a.current.scrollHeight+"px"))};return d.useEffect(l,[t.length]),e.jsx("textarea",{ref:a,className:"form-control form-control-solid",name:n,value:t,onChange:r,placeholder:"Nội dung của bài viết",autoFocus:!0})};export{W as default};
