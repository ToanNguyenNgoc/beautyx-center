import{ad as V,a as g,V as q,an as c,z as P,Q as L,j as e,a8 as M,ao as z,ap as p,aq as R,ar as O}from"./index-CzmKoHlB.js";import{u as A,A as E}from"./index-B8BO5zgp.js";import{u as x}from"./usePostMedia-Cb7DMsAe.js";import{S as H}from"./index-B_8brmcQ.js";import{S as w}from"./select-service-BrcNVLEA.js";import{L as v}from"./LoadingButton-CQgDJbfP.js";import"./mediaApi-DTFkxSOG.js";import"./Chip-CPKVIjen.js";import"./Avatar-DB29V3e2.js";/* empty css              */function X(){var h;const l=V(),{resultLoad:n,noti:o,onCloseNoti:j}=A(),{handlePostMedia:b}=x(),[r,f]=g.useState(),[m,u]=g.useState([]),{handlePostMedia:N,isLoading:_}=x(),{mutate:y,isLoading:C}=q({mutationFn:i=>l.id?c.putTrend(l.id,i):c.postTrend(i),onSuccess:()=>l.id?n({message:"Cập nhật thành công"}):n({message:"Tạo mới thành công"}),onError:i=>{var t;const a=i;n({color:"error",message:`Có lỗi xảy ra. Mã lỗi ${(t=a==null?void 0:a.request)==null?void 0:t.status}`})}}),s=P({initialValues:{media_url:"",image_thumb:"",title:"",content:"",trend_url:""},onSubmit:i=>{y({...i,organization_id:r==null?void 0:r.id,services:m.map(a=>a.id)})}}),{refetch:S,isRefetching:F,data:d}=L({queryKey:["TREND",l.id],queryFn:()=>c.trend(l.id),enabled:!!l.id,onSuccess:i=>{const a=i.context,t=a.services;u(t),s.setFieldValue("media_url",a.media_url),s.setFieldValue("image_thumb",a.image_thumb),s.setFieldValue("title",a.title),s.setFieldValue("content",a.content),s.setFieldValue("trend_url",a.trend_url)}}),T=i=>{N({e:i,callBack:a=>{var t;return s.setFieldValue("media_url",(t=a[0])==null?void 0:t.original_url)},version:"api.beautyx",resetOriginalResult:!0})},k=i=>{b({e:i,callBack:a=>{var t;return s.setFieldValue("image_thumb",(t=a[0])==null?void 0:t.original_url)},version:"api.beautyx",resetOriginalResult:!0})};return e.jsxs(e.Fragment,{children:[e.jsx(E,{severity:o.color,message:o.message,open:o.openAlert,close:j}),e.jsx(M,{title:l.id?"Thay đổi nội dung":"Thêm mới"}),e.jsx("div",{className:"container",children:e.jsxs("form",{onSubmit:s.handleSubmit,className:"trend-form",children:[e.jsxs("div",{className:"video d-flex justify-content-between",children:[e.jsxs("div",{className:"video-left",children:[e.jsx("div",{className:"required form-label",children:"Video"}),e.jsxs("div",{className:"drag-video",children:[_&&e.jsxs("div",{className:"drag-video-load",children:["Đang tải video lên...",e.jsx(z,{})]}),s.values.media_url===""?e.jsx("img",{src:p.imgPlaceHolder,alt:""}):e.jsx("video",{controls:!0,children:e.jsx("source",{src:s.values.media_url})})]}),e.jsxs("div",{className:"input-video",children:[e.jsx("input",{onChange:T,hidden:!0,type:"file",accept:R,id:"video"}),e.jsx("label",{htmlFor:"video",className:"btn btn-primary btn-up-img",children:e.jsx("i",{className:"bi bi-arrow-bar-up"})}),e.jsx("input",{onChange:s.handleChange,name:"media_url",value:s.values.media_url,type:"text",className:"form-control form-control-solid mt-4",placeholder:"Hoặc video url..."})]})]}),e.jsxs("div",{className:"video-right",children:[e.jsx("div",{className:"required form-label",children:"Image thumbnail"}),e.jsx("div",{className:"drag-image",children:e.jsx("img",{src:s.values.image_thumb||p.imgPlaceHolder,alt:""})}),e.jsxs("div",{className:"input-img",children:[e.jsx("input",{onChange:k,hidden:!0,type:"file",accept:O,id:"up-img"}),e.jsx("label",{htmlFor:"up-img",className:"btn btn-primary btn-up-img",children:e.jsx("i",{className:"bi bi-arrow-bar-up"})}),e.jsx("input",{onChange:s.handleChange,value:s.values.image_thumb,name:"image_thumb",type:"text",className:"form-control form-control-solid mt-4",placeholder:"Hoặc image url..."})]})]})]}),e.jsxs("div",{className:"col mt-4",children:[e.jsx("div",{className:"required form-label",children:"Tiêu đề"}),e.jsx("input",{type:"text",onChange:s.handleChange,value:s.values.title,name:"title",className:"form-control form-control-solid",placeholder:"Tiêu đề"})]}),e.jsxs("div",{className:"col mt-4",children:[e.jsx("div",{className:"required form-label",children:"Nội dung"}),e.jsx("input",{type:"text",onChange:s.handleChange,value:s.values.content,name:"content",className:"form-control form-control-solid",placeholder:"Nội dung"})]}),e.jsxs("div",{className:"col mt-4",children:[e.jsx("div",{className:"required form-label",children:"Link tiktok"}),e.jsx("input",{type:"text",onChange:s.handleChange,value:s.values.trend_url,name:"trend_url",className:"form-control form-control-solid",placeholder:"Link tiktok"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(H,{organization_id:(h=d==null?void 0:d.context)==null?void 0:h.organization_id,origin:r,setOrigin:f}),e.jsx("div",{className:"mt-4",children:e.jsx(w,{orgsChoose:r?[r]:[],values:m,setValues:u})})]}),e.jsxs("div",{className:"d-flex justify-content-end mt-8",children:[l.id&&e.jsx(v,{style:{marginRight:"8px"},onClick:()=>S(),loading:F,type:"button",variant:"contained",color:"primary",size:"large",children:"Khôi phục"}),e.jsx(v,{loading:C,type:"submit",variant:"contained",color:"success",size:"large",children:l.id?"Lưu thay đổi":"Tạo mới"})]})]})})]})}export{X as default};
