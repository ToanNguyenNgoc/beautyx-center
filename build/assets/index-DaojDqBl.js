import{aS as k,aT as A,a as u,aU as I,aK as F,aP as _,j as e,aW as R,aX as E,aZ as L,cr as Y,bm as q,a0 as V,bO as G,ak as D,e as y,a8 as O,ar as j,Q as K,a9 as Z,bI as U,bH as B,al as J,aa as ee,aA as W,cj as se,aB as $,aC as v,aF as f,cs as te,ab as ae,as as S,at as M,cq as ne,L as oe,ad as ie,V as le,bN as C,aD as P,b$ as re,c0 as ce,c1 as de}from"./index-CPKrhu4T.js";import{u as H,A as z}from"./index-BWaZoOLi.js";import{u as me}from"./useDebounce-C7fSdW3a.js";import{u as he}from"./useGetGmupTags-BR_enaHZ.js";import{I as pe}from"./icons-CP_FTeSN.js";import{T as ue}from"./TextField-BXDqEXHW.js";import{D as xe}from"./DialogActions-Dc_hlUSE.js";import{C as ge}from"./Chip-DMkwgItY.js";import{T as fe}from"./Tooltip-zfDBKfKe.js";import{L as je}from"./LoadingButton-f0CPeQHi.js";import"./Popper-DnwBTeSW.js";function be(s){return k("MuiDialogContent",s)}A("MuiDialogContent",["root","dividers"]);function ve(s){return k("MuiDialogTitle",s)}const _e=A("MuiDialogTitle",["root"]),ye=["className","dividers"],Ce=s=>{const{classes:t,dividers:n}=s;return L({root:["root",n&&"dividers"]},be,t)},Ne=R("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[t.root,n.dividers&&t.dividers]}})(({theme:s,ownerState:t})=>_({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},t.dividers?{padding:"16px 24px",borderTop:`1px solid ${(s.vars||s).palette.divider}`,borderBottom:`1px solid ${(s.vars||s).palette.divider}`}:{[`.${_e.root} + &`]:{paddingTop:0}})),Te=u.forwardRef(function(t,n){const a=I({props:t,name:"MuiDialogContent"}),{className:o,dividers:l=!1}=a,r=F(a,ye),c=_({},a,{dividers:l}),d=Ce(c);return e.jsx(Ne,_({className:E(d.root,o),ownerState:c,ref:n},r))}),we=["className","id"],De=s=>{const{classes:t}=s;return L({root:["root"]},ve,t)},Se=R(q,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(s,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),Me=u.forwardRef(function(t,n){const a=I({props:t,name:"MuiDialogTitle"}),{className:o,id:l}=a,r=F(a,we),c=a,d=De(c),{titleId:h=l}=u.useContext(Y);return e.jsx(Se,_({component:"h2",className:E(d.root,o),ownerState:c,ref:n,variant:"h6",id:l??h},r))}),Pe=({open:s,prompt:t,onChange:n,onClose:a,onSubmit:o})=>e.jsxs(V,{open:s,onClose:a,maxWidth:!1,PaperProps:{sx:{width:500,borderRadius:2}},children:[e.jsx(Me,{sx:{fontFamily:"Arial, Helvetica, sans-serif",fontWeight:700},children:"Tạo nội dung AI"}),e.jsxs(Te,{dividers:!0,children:[e.jsx(G,{sx:{fontFamily:"Arial, Helvetica, sans-serif",mb:1,color:"text.secondary"},children:"Nhập mô tả (prompt) bạn muốn tạo:"}),e.jsx(ue,{autoFocus:!0,fullWidth:!0,multiline:!0,minRows:3,value:t,onChange:l=>n(l.target.value),placeholder:"Ví dụ: Tạo mô tả dịch vụ nổi bật cho chiến dịch GMUP...",InputProps:{sx:{fontFamily:"Arial, Helvetica, sans-serif"}},InputLabelProps:{sx:{fontFamily:"Arial, Helvetica, sans-serif"}}})]}),e.jsxs(xe,{sx:{px:3,py:2},children:[e.jsx(D,{onClick:a,variant:"outlined",children:"Đóng"}),e.jsx(D,{variant:"contained",onClick:o,disabled:!t.trim(),children:"Tạo"})]})]});function Qe(){var c;const s=y(),t=O(),{gmupTags:n}=he({limit:50,"filter[status]":!0}),a=me(j.parse(s.search),800),{data:o,isLoading:l}=K({queryKey:["ORG",a],queryFn:()=>C.getAll({page:a.page||1,limit:30,is_ecommerce:a.is_ecommerce||"",keyword:a.search,sort:"-created_at"}).then(d=>d.data.context)}),r=d=>{const h={...a,page:d};t({pathname:s.pathname,search:j.stringify(h)})};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Danh sách doanh nghiệp"}),e.jsxs("div",{className:"card mb-5 mb-xl-8",children:[e.jsx("div",{className:"card-header border-0 pt-5",children:e.jsxs("h3",{className:"card-title align-items-start flex-column",children:[e.jsx("span",{className:"card-label fw-bold fs-3 mb-1",children:"Danh sách doanh nghiệp"}),e.jsxs("span",{className:"text-muted mt-1 fw-semobold fs-7",children:[o==null?void 0:o.total," doanh nghiệp"]})]})}),e.jsx(Ae,{data:o}),e.jsx("div",{className:"card-body py-3",children:e.jsxs("div",{className:"table-responsive",children:[e.jsxs("table",{className:"table align-middle gs-0 gy-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"fw-bold text-muted bg-light",children:[e.jsx("th",{className:"ps-4 min-w-300px rounded-start",children:"Thông tin"}),e.jsx("th",{className:"min-w-125px",children:"Liên lạc"}),e.jsx("th",{className:"min-w-100px",children:"Trạng thái TMDT"}),e.jsx("th",{className:"min-w-100px",children:"Trạng thái GMUP"}),e.jsx(U,{site:B.GMUP,children:e.jsx("th",{className:"min-w-300px",children:"Tag GMUP"})}),e.jsx("th",{className:"min-w-150px text-end rounded-end"})]})}),e.jsx("tbody",{children:(c=o==null?void 0:o.data)==null?void 0:c.map((d,h)=>e.jsx(ke,{org:d,gmupTags:n},h))})]}),e.jsx(J,{loading:l}),e.jsx(ee,{totalPage:(o==null?void 0:o.last_page)??1,onChangePage:r,defaultPage:(a==null?void 0:a.page)??1})]})})]})]})}const ke=({org:s,gmupTags:t=[]})=>{var T,w;const n={is_momo_ecommerce_enable:s.is_momo_ecommerce_enable,is_gmup_enable:s.is_gmup_enable,gmup_tag_ids:(T=s==null?void 0:s.gmup_tags)==null?void 0:T.map(i=>i.id)};console.log(s);const[a,o]=u.useState(n),{resultLoad:l,noti:r,onCloseNoti:c}=H(),d=(i,b)=>{o(X=>({...X,[i]:b})),C.updateECommerce(s.id,{[i]:b}).then(()=>{l({message:"Cập nhật thành công",color:"success"})}).catch(()=>{o(n),l({message:"Có lỗi xảy ra",color:"error"})})},h=i=>{o(b=>({...b,gmup_tag_ids:i})),g(i)},g=u.useCallback(f.debounce(i=>d("gmup_tag_ids",i),1e3),[]),[p,m]=u.useState(!1),[x,N]=u.useState(""),Q=()=>m(!0);return e.jsxs(e.Fragment,{children:[e.jsx(z,{severity:r.color,message:r.message,open:r.openAlert,close:c}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",style:{cursor:"pointer"},onClick:()=>te(s),children:[e.jsx("div",{className:"symbol symbol-50px me-5",children:e.jsx(ae,{src:s.image_url})}),e.jsxs("div",{className:"d-flex justify-content-start flex-column",children:[e.jsx("span",{className:"text-dark fw-bold text-hover-primary mb-1 fs-6",children:s.name}),e.jsx("span",{className:"text-muted fw-semobold text-muted d-block fs-7",children:s.full_address})]})]})}),e.jsx("td",{children:e.jsx("span",{className:"text-dark fw-bold text-hover-primary d-block mb-1 fs-7",children:(w=s.telephone)==null?void 0:w.join(", ")})}),e.jsx("td",{children:e.jsx(S,{permissions:["v1.organizations.updateECommerce"],children:e.jsx(M,{label:"",value:a.is_momo_ecommerce_enable,onChange:i=>d("is_momo_ecommerce_enable",i.target.checked)})})}),e.jsx("td",{children:e.jsx(S,{permissions:["v1.organizations.updateECommerce"],children:e.jsx(M,{label:"",value:a.is_gmup_enable,onChange:i=>d("is_gmup_enable",i.target.checked)})})}),e.jsx(U,{site:B.GMUP,children:e.jsx("td",{children:e.jsx(W,{sx:{m:1,minWidth:120},size:"small",children:e.jsx($,{multiple:!0,value:a.gmup_tag_ids,onChange:i=>h(i.target.value),input:e.jsx(ne,{id:"select-multiple-chip",label:"Chip"}),renderValue:()=>e.jsx(G,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.filter(i=>a.gmup_tag_ids.includes(i.id)).map(i=>e.jsx(ge,{label:i.name},i.id))}),children:t.map(i=>e.jsx(v,{value:i.id,children:i.name},i.id))})})})}),e.jsxs("td",{className:"text-end",children:[a.is_gmup_enable&&e.jsx(fe,{title:"AI Generator",children:e.jsx("button",{className:"icon_ai btn btn-icon btn-bg-light btn-active-color-primary btn-sm",onClick:Q,children:e.jsx("img",{src:pe.bling,alt:""})})}),e.jsx(oe,{to:{pathname:ie.ORGANIZATIONS_DETAIL(s.id)+"/services"},className:"btn btn-icon btn-bg-light btn-active-color-primary btn-sm",children:e.jsx("i",{className:"bi bi-eye fs-4"})}),e.jsx(Pe,{open:p,prompt:x,onChange:N,onClose:()=>{m(!1),N("")},onSubmit:()=>{console.log("Prompt:",x),m(!1)}})]})]})]})},Ae=({data:s})=>{const t=j.parse(y().search),n=O(),a=y(),o=r=>{const c={...t,page:"",is_ecommerce:r.target.value};n({pathname:a.pathname,search:j.stringify(f.pickBy(c,f.identity))},{replace:!0})},l=r=>{const c=Object.assign(t,{search:r});n({pathname:a.pathname,search:j.stringify(f.pickBy(c,f.identity))},{replace:!0})};return e.jsxs("div",{className:"card-body filter-cnt",children:[e.jsx("div",{className:"search",children:e.jsx("input",{onChange:r=>l(r.target.value),type:"text",className:"form-control form-control-solid",placeholder:"Tìm kiếm MC"})}),e.jsxs("div",{className:"filter",children:[e.jsx("div",{className:"filter-item",children:e.jsxs(W,{style:{width:"100%"},size:"small",children:[e.jsx(se,{id:"demo-select-small-label",children:"Trạng thái TMDT"}),e.jsxs($,{labelId:"demo-select-small-label",id:"demo-select-small",label:"Trạng thái TMDT",value:t.is_ecommerce||"",onChange:o,children:[e.jsx(v,{value:"",children:"Tất cả"}),e.jsx(v,{value:"true",children:"Đang mở"}),e.jsx(v,{value:"false",children:"Đang đóng"})]})]})}),e.jsx("div",{className:"filter-item",children:s&&e.jsx(Ie,{query:t,data:s})})]})]})},Ie=({query:s,data:t})=>{const[n,a]=u.useState([]),{resultLoad:o,noti:l,onCloseNoti:r}=H(),[c,d]=u.useState(!1),{mutate:h,isLoading:g}=le({mutationFn:m=>C.getAll({page:m,is_ecommerce:s.is_ecommerce||"",sort:"-created_at",limit:30}).then(x=>x.data.context),onSuccess:m=>a(x=>[...x,...m.data])}),p=()=>{d(!0);for(var m=1;m<=(t==null?void 0:t.last_page);m++)h(m)};return u.useEffect(()=>{c&&n.length>0&&n.length===(t==null?void 0:t.total)&&Fe(n).then(()=>{o({message:"Xuất File thành công",color:"success"}),a([]),d(!1)}),n.length===(t==null?void 0:t.total)&&a([])},[n,t==null?void 0:t.total]),e.jsxs(e.Fragment,{children:[e.jsx(z,{severity:l.color,message:l.message,open:l.openAlert,close:r}),e.jsx(je,{onClick:p,loading:g,color:"success",variant:"contained",size:"medium",children:"Xuất DS"})]})},Fe=s=>new Promise(t=>{const n="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8",a=".xlsx",l=[["#","ID","Tên MC","Link gian hàng","Subdomain","Trạng thái","Ngày tạo"],...s.map((p,m)=>[m+1,p.id,p.name,`https://beautyx.vn/cua-hang/${p.subdomain}`,p.subdomain,p.is_momo_ecommerce_enable?"Đang mở":"Đang tắt",P(p.created_at).format("DD/MM/YYYY")])],r=re.aoa_to_sheet(l),c=[{wch:5},{wch:10},{wch:75},{wch:45},{wch:25},{wch:25},{wch:25}];r["!cols"]=c;const h=ce({Sheets:{data:r},SheetNames:["data"]},{bookType:"xlsx",type:"array"}),g=new Blob([h],{type:n});de.saveAs(g,`ds_mc_${P().format("DDHHmmss")}`+a),t(!0)});export{Qe as default};
