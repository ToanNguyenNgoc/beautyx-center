"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[104],{65104:(e,l,i)=>{i.r(l),i.d(l,{ExportCode:()=>b,default:()=>I});i(9951);var a=i(83521),s=i(96446),t=i(88988),n=i(65043),o=i(63516),r=i(73033),d=i(95434),c=i(86178),u=i.n(c),m=i(82907),v=i(73589),p=i(72812),h=i(42807),g=i(3717),x=i(86971),f=i(93104),j=i(72450),_=i(11238),N=i(70579);const b=e=>{let{discount:l,title:i=" Xu\u1ea5t m\xe3 gi\u1ea3m gi\xe1",size:a="medium"}=e;const[s,t]=(0,n.useState)(1),[o,r]=(0,n.useState)([]),{mutate:d,data:c,isLoading:u}=(0,m.useMutation)({mutationKey:["GET_CODE",l.uuid],mutationFn:e=>v.x4.getCodeIsCampaign({uuid:l.uuid,page:e.page,limit:30}),onSuccess(e){const l=e.data;r((e=>[...e,...l])),t(Math.ceil(e.total/30))}});return(0,n.useEffect)((()=>{if(s>1)for(var e=2;e<=s;e++)d({page:e})}),[s]),(0,n.useEffect)((()=>{o.length===(null===c||void 0===c?void 0:c.total)&&y({file_name:(0,h.Yv)(l.title),codes:o})}),[o,null===c||void 0===c?void 0:c.total]),(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(p.A,{color:"success",size:a,variant:"contained",onClick:()=>{r([]),t(1),d({page:1})},type:"button",loading:u,children:[(0,N.jsx)("i",{style:{marginRight:"4px",color:"var(--kt-white)"},className:"bi bi-download"}),i]})})},y=e=>{let{file_name:l,codes:i}=e;const a=[["STT","Danh s\xe1ch m\xe3","Tr\u1ea1ng th\xe1i s\u1eed d\u1ee5ng"],...i.map(((e,l)=>[l+1,e.coupon_code,"1"===e.status?"Ch\u01b0a s\u1eed d\u1ee5ng":"\u0110\xe3 s\u1eed d\u1ee5ng"]))],s=_.Wp.aoa_to_sheet(a);s["!cols"]=[{wch:8},{wch:35},{wch:25}];const t={Sheets:{data:s},SheetNames:["data"]},n=_.M9(t,{bookType:"xlsx",type:"array"}),o=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});j.saveAs(o,`Ma_giam_gia_${l}_${u()().format("DDHHmmss")}.xlsx`)};const w=function(e){var l,i,c;const j=u()().format("MMDDss"),{discount:_,isForm:y}=e,{resultLoad:w,onCloseNoti:D,noti:C}=(0,g.JX)(),I=(0,x.Zp)(),[T,E]=(0,n.useState)(null!==(l=null===_||void 0===_?void 0:_.is_campaign)&&void 0!==l&&l),[k,V]=(0,n.useState)("EDIT"===y?null===_||void 0===_?void 0:_.items.map((e=>e.productable)):[]),{mutate:S,isLoading:Y}=(0,m.useMutation)({mutationFn:e=>_?v.x4.putDiscount(_.id,e):v.x4.postDiscount(e),onSuccess:e=>{w({message:_?"C\u1eadp nh\u1eadt th\xe0nh c\xf4ng":"T\u1ea1o th\xe0nh c\xf4ng",color:"success"}),setTimeout((()=>I(-1)),2e3)},onError:(e,l,i)=>{w({message:"C\xf3 l\u1ed7i x\u1ea3y ra",color:"error"})}}),F=(0,o.Wx)({initialValues:{priority:"EDIT"===y?null===_||void 0===_?void 0:_.priority:0,coupon_code:"EDIT"===y?null===_||void 0===_?void 0:_.coupon_code:"",title:"EDIT"===y?null===_||void 0===_?void 0:_.title:"",description:"EDIT"===y?null===_||void 0===_?void 0:_.description:"",platform:"EDIT"===y&&null!==_&&void 0!==_&&_.platform?null===_||void 0===_||null===(i=_.platform)||void 0===i||null===(c=i.split("|"))||void 0===c?void 0:c.filter(Boolean):[],discount_type:"EDIT"===y?null===_||void 0===_?void 0:_.discount_type:"",discount_unit:"EDIT"===y?null===_||void 0===_?void 0:_.discount_unit:"",discount_value:"EDIT"===y?null===_||void 0===_?void 0:_.discount_value:"",organizations:"EDIT"===y?null===_||void 0===_?void 0:_.organizations:[],total:"EDIT"===y&&null!==_&&void 0!==_&&_.total?null===_||void 0===_?void 0:_.total:"",valid_from:"EDIT"===y&&null!==_&&void 0!==_&&_.valid_from?null===_||void 0===_?void 0:_.valid_from:u()().format("YYYY-MM-DD HH:mm:ss"),valid_util:"EDIT"===y&&null!==_&&void 0!==_&&_.valid_util?null===_||void 0===_?void 0:_.valid_util:u()().format("YYYY-MM-DD HH:mm:ss"),minimum_order_value:"EDIT"===y&&null!==_&&void 0!==_&&_.maximum_discount_value?null===_||void 0===_?void 0:_.maximum_discount_value:"",limit:"EDIT"===y&&null!==_&&void 0!==_&&_.limit?null===_||void 0===_?void 0:_.limit:""},validationSchema:r.Ik({coupon_code:r.Yj().required("Vui l\xf2ng nh\u1eadp M\xe3 gi\u1ea3m gi\xe1"),title:r.Yj().required("Vui l\xf2ng nh\u1eadp t\xean ch\u01b0\u01a1ng tr\xecnh khuy\u1ebfn m\u1ea1i"),description:r.Yj().required("Vui l\xf2ng nh\u1eadp m\xf4 t\u1ea3 ch\u01b0\u01a1ng tr\xecnh khuy\u1ebfn m\u1ea1i"),discount_type:r.Yj().required("Vui l\xf2ng ch\u1ecdn h\xecnh th\u1ee9c gi\u1ea3m gi\xe1"),discount_unit:r.Yj().required("Vui l\xf2ng ch\u1ecdn lo\u1ea1i gi\u1ea3m gi\xe1 "),discount_value:r.Yj().required("Vui l\xf2ng nh\u1eadp gi\xe1 tr\u1ecb gi\u1ea3m"),platform:r.YO().min(1,"Vui l\xf2ng ch\u1ecdn n\u1ec1n t\u1ea3ng \xe1p d\u1ee5ng"),organizations:r.YO().min(1,"Vui l\xf2ng ch\u1ecdn Doanh nghi\u1ec7p"),total:T?r.ai().min(0,"S\u1ed1 l\u01b0\u1ee3ng m\xe3 t\u1ed1i \u0111a 2000 m\xe3").max(2e3,"S\u1ed1 l\u01b0\u1ee3ng m\xe3 t\u1ed1i \u0111a 2000 m\xe3").required("Vui l\xf2ng nh\u1eadp s\u1ed1 l\u01b0\u1ee3ng m\xe3"):r.Yj()}),onSubmit:e=>{var l,i;const a=e,s={...a,organizations:null===(l=e.organizations)||void 0===l?void 0:l.map((e=>e.id))[0],items:k.map((e=>e.id)),platform:null!==(i=a.platform[0])&&void 0!==i?i:"MOMO",is_campaign:T?1:0,limit:Number(e.limit)};k.length>0&&S(s)}}),A=Math.min.apply(null,k.map((e=>null===e||void 0===e?void 0:e.price)));let M=0;var z;return k.length>0&&(M=null===k||void 0===k||null===(z=k.map((e=>null===e||void 0===e?void 0:e.price)))||void 0===z?void 0:z.reduce(((e,l)=>e+l))),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(d.ce,{severity:C.color,message:C.message,open:C.openAlert,close:D}),(0,N.jsxs)("form",{className:"discount-form",onSubmit:F.handleSubmit,autoComplete:"off",children:[(0,N.jsx)("div",{className:"flex-row-sp align-items-center input-wrap",children:(0,N.jsx)("div",{className:"wrap-item",children:(0,N.jsx)(d.Xg,{value:T,onChange:e=>E(e.target.checked),label:"Is campaign (\xc1p d\u1ee5ng m\xe3 gi\u1ea3m gi\xe1 Shopee, VinId)"})})}),(0,N.jsx)("div",{className:"flex-row-sp input-wrap",children:(0,N.jsxs)("div",{className:"wrap-item",children:[(0,N.jsx)("label",{className:"form-label",children:"\u0110\u1ed9 \u01b0u ti\xean"}),(0,N.jsx)("input",{onChange:F.handleChange,value:F.values.priority,name:"priority",type:"number",className:"form-control form-control-solid",placeholder:"\u0110\u1ed9 \u01b0u ti\xean"})]})}),(0,N.jsxs)("div",{className:"flex-row-sp input-wrap",children:[(0,N.jsxs)("div",{className:"wrap-item",children:["ADD"===y?(0,N.jsxs)("label",{className:"required form-label",children:["M\xe3 gi\u1ea3m gi\xe1 (org subdomain + ",j,")"]}):(0,N.jsx)("label",{className:"required form-label",children:"M\xe3 gi\u1ea3m gi\xe1"}),(0,N.jsx)("input",{onChange:F.handleChange,value:F.values.coupon_code,name:"coupon_code",type:"text",className:"form-control form-control-solid",placeholder:`Example:ORG${j}`}),F.errors.coupon_code&&F.touched.coupon_code&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.coupon_code})]}),(0,N.jsxs)("div",{className:"wrap-item",children:[(0,N.jsx)("label",{className:"required form-label",children:"T\xean"}),(0,N.jsx)("input",{onChange:F.handleChange,value:F.values.title,name:"title",type:"text",className:"form-control form-control-solid",placeholder:"Ch\u01b0\u01a1ng tr\xecnh khuy\u1ebfn m\u1ea1i"}),F.errors.title&&F.touched.title&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.title})]})]}),(0,N.jsxs)("div",{className:"input-wrap",children:[(0,N.jsx)("label",{className:"required form-label",children:"M\xf4 t\u1ea3"}),(0,N.jsx)("input",{onChange:F.handleChange,value:F.values.description,name:"description",type:"text",className:"form-control form-control-solid",placeholder:"M\xf4 t\u1ea3 ch\u01b0\u01a1ng tr\xecnh khuy\u1ebfn m\u1ea1i"}),F.errors.description&&F.touched.description&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.description})]}),(0,N.jsxs)("div",{className:"flex-col input-wrap",children:[(0,N.jsx)("label",{className:"required form-label",children:"\xc1p d\u1ee5ng cho n\u1ec1n t\u1ea3ng"}),(0,N.jsx)(a.A,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:F.values.platform,onChange:F.handleChange,name:"platform",renderValue:e=>(0,N.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:null===e||void 0===e?void 0:e.map((e=>(0,N.jsx)(d._8,{platForm:e},e)))}),children:h.Te.map((e=>(0,N.jsx)(t.A,{value:e,children:e},e)))}),F.errors.platform&&F.touched.platform&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.platform})]}),(0,N.jsxs)("div",{className:"flex-col input-wrap",children:[(0,N.jsx)(d.tk,{label:"Doanh nghi\u1ec7p \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng",origins:F.values.organizations,onChangeOrigin:e=>{V([]),F.setFieldValue("organizations",e)}}),F.errors.organizations&&F.touched.organizations&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.organizations})]}),(0,N.jsx)("div",{className:"flex-col input-wrap",children:(0,N.jsx)(f.w,{values:k,setValues:V,orgsChoose:F.values.organizations})}),(0,N.jsxs)("div",{className:"flex-row-sp input-wrap",children:[(0,N.jsxs)("div",{className:"flex-col wrap-item wrap-item-col-4",children:[(0,N.jsx)("label",{className:"required form-label",children:"H\xecnh th\u1ee9c gi\u1ea3m gi\xe1 "}),(0,N.jsx)(a.A,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:F.values.discount_type,onChange:F.handleChange,name:"discount_type",children:h.uI.map((e=>(0,N.jsx)(t.A,{value:e.TYPE,children:e.title},e.id)))}),F.errors.discount_type&&F.touched.discount_type&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.discount_type})]}),(0,N.jsxs)("div",{className:"flex-col wrap-item wrap-item-col-4",children:[(0,N.jsx)("label",{className:"required form-label",children:"Gi\u1ea3m gi\xe1 theo"}),(0,N.jsx)(a.A,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:F.values.discount_unit,onChange:e=>{F.setFieldValue("discount_value",""),F.setFieldValue("discount_unit",e.target.value)},name:"discount_unit",children:h.Fc.map((e=>(0,N.jsx)(t.A,{value:e.TYPE,children:e.title},e.id)))}),F.errors.discount_unit&&F.touched.discount_unit&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.discount_unit})]}),(0,N.jsxs)("div",{className:"wrap-item wrap-item-col-4",children:[(0,N.jsxs)("label",{className:"required form-label",children:[F.values.discount_type===h.b.FINAL_PRICE?"Gi\u1ea3m gi\xe1 c\xf2n":"Gi\xe1 tr\u1ecb gi\u1ea3m gi\xe1",F.values.discount_unit===h.zZ.PERCENT&&"(%)",F.values.discount_unit===h.zZ.PRICE&&"(VN\u0110)"]}),(0,N.jsx)("input",{onChange:e=>{F.values.discount_unit===h.zZ.PERCENT?(parseInt(e.target.value)<100||""===e.target.value)&&F.setFieldValue("discount_value",e.target.value):F.values.discount_unit===h.zZ.PRICE&&(F.values.discount_type===h.b.PRODUCTS&&(parseInt(e.target.value)<A||""===e.target.value)&&F.setFieldValue("discount_value",e.target.value),F.values.discount_type===h.b.SUB_TOTAL&&(parseInt(e.target.value)<M||""===e.target.value)&&F.setFieldValue("discount_value",e.target.value),F.values.discount_type===h.b.FINAL_PRICE&&(parseInt(e.target.value)<A||""===e.target.value)&&F.setFieldValue("discount_value",e.target.value))},value:F.values.discount_value,name:"discount_value",type:"text",className:"form-control form-control-solid",placeholder:F.values.discount_unit===h.zZ.PRICE?`Gi\xe1 tr\u1ecb gi\u1ea3m t\u1ed1i \u0111a ${(0,h.$g)(F.values.discount_type===h.b.SUB_TOTAL?M:A)}\u0111`:"Gi\u1ea3m gi\xe1"}),F.errors.discount_value&&F.touched.discount_value&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.discount_value})]})]}),(0,N.jsx)("div",{className:"flex-row-sp input-wrap",children:(0,N.jsxs)("div",{className:"wrap-item wrap-item-col-4",children:[(0,N.jsx)("label",{className:"form-label",children:"Gi\xe1 tr\u1ecb \u0111\u01a1n h\xe0ng t\u1ed1i thi\u1ec3u"}),(0,N.jsx)("input",{onChange:e=>{F.values.discount_type===h.b.SUB_TOTAL&&""===F.values.discount_value&&F.setFieldValue("minimum_order_value",e.target.value)},value:F.values.minimum_order_value,name:"minimum_order_value",disabled:F.values.discount_type===h.b.PRODUCTS,type:"text",className:"form-control form-control-solid",placeholder:"Gi\xe1 \xe1p d\u1ee5ng"})]})}),(0,N.jsxs)("div",{className:"flex-row-sp input-wrap",children:[(0,N.jsxs)("div",{className:"wrap-item wrap-item-col-4",children:[(0,N.jsx)("label",{className:(T?"required":"")+" form-label",children:"S\u1ed1 l\u01b0\u1ee3ng"}),(0,N.jsx)("input",{value:F.values.total,onChange:e=>{(e.target.value>0||""===e.target.value)&&(F.setFieldValue("total",e.target.value),F.setFieldValue("limit",""))},name:"total",type:"text",className:"form-control form-control-solid",placeholder:""}),F.errors.total&&F.touched.total&&(0,N.jsx)("span",{className:"text-danger",children:F.errors.total})]}),(0,N.jsxs)("div",{className:"wrap-item wrap-item-col-4",children:[(0,N.jsx)("label",{className:"form-label",children:"L\u01b0\u1ee3t s\u1eed d\u1ee5ng m\u1ed7i kh\xe1ch h\xe0ng "}),(0,N.jsx)("input",{value:F.values.limit,onChange:e=>{const l=parseInt(`${F.values.total}`);return""===F.values.total||"number"===typeof l&&parseInt(e.target.value)<l||""===e.target.value?F.setFieldValue("limit",e.target.value):void 0},name:"limit",type:"number",className:"form-control form-control-solid",placeholder:""})]}),(0,N.jsx)("div",{className:"wrap-item wrap-item-col-4",children:(0,N.jsx)(d.oG,{minDate:new Date,startDate:new Date(F.values.valid_from),endDate:new Date(F.values.valid_util),onChange:e=>{F.setFieldValue("valid_from",u()(e.selection.startDate).format("YYYY-MM-DD HH:mm:ss")),F.setFieldValue("valid_util",u()(e.selection.endDate).format("YYYY-MM-DD HH:mm:ss"))}})})]}),(0,N.jsxs)("div",{className:"input-form__bot",children:[(0,N.jsx)(p.A,{loading:Y,type:"submit",variant:"contained",size:"large",color:"success",children:"L\u01b0u thay \u0111\u1ed5i"}),_&&(_.platform===h.Jv.SHOPEE||_.platform===h.Jv.VINID)&&(0,N.jsx)(b,{discount:_})]})]})]})};var D=i(6171),C=i(93511);const I=function(){const e=(0,x.zy)(),{METHOD:l}=(0,g.CZ)(),i=(0,x.g)();let a="ADD";i&&i.id&&(a="EDIT");const{data:s,refetch:t,isLoading:n}=(0,m.useQuery)({queryKey:[[D.Eo.DISCOUNT,i.id]],queryFn:()=>v.x4.getDiscountDetail({id:i.id}),enabled:!!i.id}),o=(null===s||void 0===s?void 0:s.context)||e.state;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(C.A,{title:null!==i&&void 0!==i&&i.id?"Ch\u1ec9nh th\xf4ng tin gi\u1ea3m gi\xe1":"T\u1ea1o m\u1edbi m\xe3 gi\u1ea3m gi\xe1"}),(0,N.jsx)("div",{className:"post d-flex flex-column-fluid",id:"kt_post",children:(0,N.jsxs)("div",{className:"container",children:[n&&(0,N.jsx)(d.kJ,{}),("ADD"===a||o)&&(0,N.jsx)(w,{isForm:a,discount:o,onRestoreFormEdit:t})]})})]})}},93104:(e,l,i)=>{i.d(l,{w:()=>u});var a=i(65043),s=(i(9951),i(43845)),t=i(81045),n=i(81637),o=i(93911),r=i(53536),d=i(42807),c=i(70579);const u=e=>{var l,i;let{orgsChoose:u=[],values:m=[],setValues:v,onChangeService:p}=e;const h=(0,a.useRef)(null),g=m.map((e=>e.id)),[x,f]=(0,a.useState)({data:[],load:!1}),j=e=>{var l,i,a,s;if(u.length>0&&"show"===e)return null===(a=h.current)||void 0===a||null===(s=a.classList)||void 0===s?void 0:s.add("box-services-show");if("hide"===e)return null===(l=h.current)||void 0===l||null===(i=l.classList)||void 0===i?void 0:i.remove("box-services-show")};window.addEventListener("click",(()=>j("hide")));const _=(0,a.useCallback)((0,r.debounce)(((e,l)=>{f({data:[],load:!0}),(async(e,l)=>{let i=[];for(var a of l){var s;const l=await o.A.getServicesByOrg({keyword:e,org_id:null===(s=a)||void 0===s?void 0:s.id}),t={services:null===l||void 0===l?void 0:l.data.context.data,org:a};i.push(t)}f({data:i,load:!1})})(e,l)}),1500),[]),N=null!==(l=null===(i=x.data)||void 0===i?void 0:i.map((e=>e.services)).flat())&&void 0!==l?l:[],b=e=>{if(p){const l=m.findIndex((l=>l.id===e.id));p(l<0?[...m,e]:m.filter((l=>l.id!==e.id)))}else v&&v((l=>l.findIndex((l=>l.id===e.id))<0?l=[...l,e]:l.filter((l=>l.id!==e.id))))};return(0,c.jsxs)("div",{className:"select-services",children:[(0,c.jsx)("label",{className:"required form-label",children:"S\u1ea3n ph\u1ea9m \xe1p d\u1ee5ng"}),(0,c.jsx)("div",{onClick:e=>{e.stopPropagation(),j("show")},className:"form-control form-control-solid ser-selected",children:m.map((e=>(0,c.jsx)(s.A,{label:`${e.service_name} | Gi\xe1 g\u1ed1c: ${(0,d.$g)(e.price)}`,onDelete:()=>b(e),size:"medium",color:"primary",avatar:(0,c.jsx)(t.A,{src:e.image_url})},e.id)))}),(0,c.jsxs)("div",{onClick:e=>e.stopPropagation(),ref:h,className:"box-services",children:[(0,c.jsxs)("div",{className:"box-service-input",children:[x.load&&(0,c.jsx)(n.A,{size:16}),(0,c.jsx)("input",{onChange:e=>{u&&u.length>0&&_(e.target.value,u)},type:"text",className:"form-control form-control-solid",placeholder:"T\xecm ki\u1ebfm d\u1ecbch v\u1ee5..."})]}),(0,c.jsx)("div",{className:"services-list",children:(0,c.jsx)("ul",{children:N.filter(Boolean).map(((e,l)=>(0,c.jsx)("li",{children:(0,c.jsxs)("div",{style:g.includes(e.id)?{backgroundColor:"var(--kt-gray-200)"}:{},onClick:()=>b(e),className:"service-item",children:[(0,c.jsx)("div",{className:"image",children:(0,c.jsx)("img",{src:e.image_url,onError:e=>(0,d.pG)(e),alt:""})}),(0,c.jsxs)("div",{className:"service-detail",children:[(0,c.jsx)("p",{className:"service-name",children:e.service_name}),(0,c.jsx)("p",{className:"service-price",children:(0,d.$g)(e.price)})]})]})},l)))})})]})]})}},93511:(e,l,i)=>{i.d(l,{A:()=>s});i(65043);var a=i(70579);const s=function(e){const{title:l,element:i}=e;return(0,a.jsx)("div",{className:"toolbar",id:"kt_toolbar",children:(0,a.jsxs)("div",{id:"kt_toolbar_container",className:"container-fluid d-flex flex-stack",children:[(0,a.jsx)("h1",{className:"d-flex align-items-center text-dark fw-bolder my-1 fs-3",children:l}),i]})})}},9951:()=>{}}]);
//# sourceMappingURL=104.1f47f2bf.chunk.js.map